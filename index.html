<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è®°è´¦æœ¬</title>
    <!-- å¼•å…¥SheetJSåº“ç”¨äºå¯¼å‡ºXLSX -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <!-- å¼•å…¥Chart.jsç”¨äºå›¾è¡¨ç»˜åˆ¶ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary: #FF8DC7;
            --secondary: #A3D8FF;
            --accent: #FFD59E;
            --light: #FFF5E4;
            --text: #5A5A5A;
            --success: #A8E6CF;
            --danger: #FFAAA5;
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 16px;
            --touch-size: 44px;
        }
        
        body {
            background: linear-gradient(135deg, #FFD6E7 0%, #C1E3FF 100%);
            color: var(--text);
            line-height: 1.5;
            padding: 12px;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px 15px;
            border-radius: var(--radius);
            background: var(--card-bg);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        h1 i {
            color: var(--accent);
            font-size: 1.6rem;
        }
        
        .summary-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 2px dashed var(--secondary);
            backdrop-filter: blur(10px);
        }
        
        .summary-card h2 {
            font-size: 1rem;
            margin-bottom: 8px;
            opacity: 0.9;
            color: var(--primary);
        }
        
        .summary-card .amount {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-section, .records-section, .analysis-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .form-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--secondary);
        }
        
        .records-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--accent);
        }
        
        .analysis-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: #A8E6CF;
        }
        
        .section-title {
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 16px;
            padding-bottom: 10px;
            border-bottom: 2px dotted var(--secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title i {
            color: var(--accent);
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.95rem;
        }
        
        label i {
            color: var(--primary);
            width: 18px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #E8E8E8;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
            -webkit-appearance: none;
            appearance: none;
            min-height: var(--touch-size);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 141, 199, 0.2);
        }
        
        .btn {
            padding: 14px 16px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: var(--touch-size);
            touch-action: manipulation;
            user-select: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #FF6BAE);
            color: white;
            box-shadow: 0 3px 8px rgba(255, 107, 174, 0.3);
        }
        
        .btn-primary:active {
            transform: translateY(2px);
            box-shadow: 0 1px 4px rgba(255, 107, 174, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #7ED9A3);
            color: white;
            box-shadow: 0 3px 8px rgba(168, 230, 207, 0.3);
        }
        
        .btn-success:active {
            transform: translateY(2px);
            box-shadow: 0 1px 4px rgba(168, 230, 207, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #FF8A80);
            color: white;
            box-shadow: 0 3px 8px rgba(255, 170, 165, 0.3);
        }
        
        .btn-danger:active {
            transform: translateY(2px);
            box-shadow: 0 1px 4px rgba(255, 170, 165, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #E8E8E8, #D0D0D0);
            color: var(--text);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
        }
        
        .btn-secondary:active {
            transform: translateY(2px);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }
        
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .buttons .btn {
            width: 100%;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
            font-size: 0.9rem;
            min-width: 600px; /* ç¡®ä¿åœ¨å°å±å¹•ä¸Šå¯ä»¥æ°´å¹³æ»šåŠ¨ */
        }
        
        th, td {
            padding: 12px 10px;
            text-align: left;
            border-bottom: 1px solid #F0F0F0;
        }
        
        th {
            background-color: rgba(163, 216, 255, 0.2);
            font-weight: 600;
            color: var(--primary);
            font-size: 0.9rem;
        }
        
        tr:hover {
            background-color: rgba(255, 213, 158, 0.1);
        }
        
        .income {
            color: #2E8B57;
            font-weight: 500;
        }
        
        .expense {
            color: #FF6B6B;
            font-weight: 500;
        }
        
        .actions {
            display: flex;
            gap: 5px;
        }
        
        .actions .btn {
            padding: 8px 10px;
            font-size: 0.85rem;
            border-radius: 8px;
            min-height: 36px;
        }
        
        .project-management {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dotted var(--secondary);
        }
        
        .project-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        
        .project-item {
            background: white;
            border-radius: 12px;
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #F0F0F0;
            flex: 1 0 calc(50% - 8px);
            max-width: calc(50% - 8px);
        }
        
        .project-item.income {
            border-left: 4px solid var(--success);
        }
        
        .project-item.expense {
            border-left: 4px solid var(--danger);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            padding: 15px;
        }
        
        .modal-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            position: relative;
            border: 2px solid var(--primary);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .modal-title {
            font-size: 1.2rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .close {
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text);
            transition: all 0.3s;
            padding: 5px;
            min-width: 36px;
            min-height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close:active {
            color: var(--primary);
            transform: scale(0.95);
        }
        
        .search-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            border: 2px dashed var(--accent);
        }
        
        .search-row {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .search-group {
            width: 100%;
        }
        
        .search-results-info {
            margin-top: 10px;
            font-size: 0.85rem;
            color: var(--text);
            padding: 10px;
            background: rgba(255, 213, 158, 0.2);
            border-radius: 10px;
            text-align: center;
        }
        
        .record-count {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            margin: 0 3px;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            
            .container {
                max-width: 1200px;
            }
            
            .content {
                flex-direction: row;
            }
            
            .form-section, .records-section, .analysis-section {
                flex: 1;
                min-width: 300px;
            }
            
            .buttons {
                flex-direction: row;
            }
            
            .buttons .btn {
                width: auto;
            }
            
            .search-row {
                flex-direction: row;
            }
            
            .search-group {
                flex: 1;
                min-width: 200px;
            }
            
            .project-item {
                flex: 1 0 calc(33.333% - 8px);
                max-width: calc(33.333% - 8px);
            }
            
            table {
                min-width: auto;
                font-size: 1rem;
            }
        }
        
        .floating-elements {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }
        
        .floating-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.4rem;
            color: white;
            touch-action: manipulation;
        }
        
        .floating-btn.primary {
            background: var(--primary);
        }
        
        .floating-btn.success {
            background: var(--success);
        }
        
        .floating-btn:active {
            transform: scale(0.95);
        }
        
        .empty-state {
            text-align: center;
            padding: 30px 15px;
            color: var(--text);
        }
        
        .empty-state i {
            font-size: 3rem;
            color: var(--secondary);
            margin-bottom: 16px;
        }
        
        .empty-state p {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }
        
        .type-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 6px;
        }
        
        .type-income {
            background: var(--success);
        }
        
        .type-expense {
            background: var(--danger);
        }
        
        .emoji {
            font-size: 1.1rem;
            margin-right: 4px;
        }
        
        /* åˆ†é¡µæ ·å¼ */
        .pagination {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 16px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }
        
        .pagination-info {
            font-size: 0.85rem;
            color: var(--text);
            text-align: center;
        }
        
        .pagination-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .pagination-btn {
            padding: 10px 14px;
            border: none;
            border-radius: 8px;
            background: var(--secondary);
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            min-height: 40px;
            min-width: 40px;
            touch-action: manipulation;
        }
        
        .pagination-btn:active:not(:disabled) {
            background: var(--primary);
            color: white;
            transform: translateY(2px);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-size-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .page-size-selector select {
            width: auto;
            padding: 8px 12px;
            min-height: 40px;
        }
        
        /* å¤šé€‰ä¸‹æ‹‰æ¡†æ ·å¼ */
        .multiselect-container {
            position: relative;
        }
        
        .multiselect-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: white;
            border: 2px solid #E8E8E8;
            border-radius: 12px;
            margin-top: 5px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .multiselect-dropdown.active {
            display: block;
        }
        
        .multiselect-search {
            padding: 10px;
            border-bottom: 1px solid #E8E8E8;
        }
        
        .multiselect-search input {
            padding: 10px 12px;
            border-radius: 8px;
            min-height: 40px;
        }
        
        .multiselect-options {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .multiselect-option {
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
            min-height: 44px;
        }
        
        .multiselect-option:active {
            background: rgba(163, 216, 255, 0.2);
        }
        
        .multiselect-option.selected {
            background: rgba(255, 141, 199, 0.2);
        }
        
        .multiselect-selected {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }
        
        .selected-tag {
            background: var(--primary);
            color: white;
            padding: 6px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
            max-width: 100%;
        }
        
        .selected-tag .remove {
            cursor: pointer;
            font-weight: bold;
            padding: 2px;
        }
        
        .multiselect-input {
            cursor: pointer;
            position: relative;
            padding: 14px 16px;
            border: 2px solid #E8E8E8;
            border-radius: 12px;
            background: white;
            min-height: var(--touch-size);
            display: flex;
            align-items: center;
        }
        
        .multiselect-input::after {
            content: "â–¼";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text);
            pointer-events: none;
        }
        
        /* å¯¼å…¥åŠŸèƒ½æ ·å¼ */
        .import-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dotted var(--secondary);
        }
        
        .import-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        @media (min-width: 480px) {
            .import-actions {
                flex-direction: row;
            }
        }
        
        .import-preview {
            margin-top: 16px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #E8E8E8;
            border-radius: 12px;
            padding: 12px;
            background: white;
        }
        
        .import-preview table {
            margin-top: 0;
            font-size: 0.85rem;
        }
        
        .import-preview th, .import-preview td {
            padding: 8px 10px;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: block;
            width: 100%;
        }
        
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-label {
            display: block;
            padding: 14px 16px;
            border: 2px dashed var(--secondary);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(163, 216, 255, 0.1);
            min-height: var(--touch-size);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .file-input-label:active {
            background: rgba(163, 216, 255, 0.2);
            border-color: var(--primary);
        }
        
        .file-input-label i {
            color: var(--primary);
        }
        
        /* è¡¨æ ¼å®¹å™¨ï¼Œç”¨äºåœ¨æ‰‹æœºä¸Šå®ç°æ°´å¹³æ»šåŠ¨ */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 0 -20px;
            padding: 0 20px;
            width: calc(100% + 40px);
        }
        
        /* ç§»åŠ¨ç«¯èœå•åˆ‡æ¢ */
        .mobile-tabs {
            display: none;
        }
        
        @media (max-width: 767px) {
            .mobile-tabs {
                display: flex;
                background: var(--card-bg);
                border-radius: var(--radius);
                margin-bottom: 16px;
                overflow: hidden;
                box-shadow: var(--shadow);
            }
            
            .mobile-tab {
                flex: 1;
                padding: 14px 10px;
                text-align: center;
                font-weight: 500;
                color: var(--text);
                cursor: pointer;
                transition: all 0.3s;
                border-bottom: 3px solid transparent;
                position: relative;
                -webkit-tap-highlight-color: transparent;
                user-select: none;
            }
            
            .mobile-tab.active {
                color: var(--primary);
                border-bottom-color: var(--primary);
                background: rgba(255, 141, 199, 0.1);
            }
            
            .mobile-tab.active::after {
                content: '';
                position: absolute;
                bottom: -3px;
                left: 50%;
                transform: translateX(-50%);
                width: 0;
                height: 0;
                border-left: 8px solid transparent;
                border-right: 8px solid transparent;
                border-top: 8px solid var(--primary);
            }
            
            .mobile-tab.touching {
                background: rgba(255, 141, 199, 0.15) !important;
                transition: none !important;
            }
            
            .mobile-tab.clicked {
                background: rgba(255, 141, 199, 0.2) !important;
                transform: scale(0.98);
            }
            
            .form-section, .records-section, .analysis-section {
                display: none;
            }
            
            .form-section.active, .records-section.active, .analysis-section.active {
                display: block;
            }
            
            /* è°ƒæ•´å®¹å™¨åº•éƒ¨paddingï¼Œé¿å…å†…å®¹è¢«åº•éƒ¨æ é®æŒ¡ */
            .container {
                padding-bottom: 20px; /* å‡å°‘åº•éƒ¨padding */
            }
            
            /* éšè—æ¡Œé¢ç‰ˆæµ®åŠ¨æŒ‰é’® */
            .floating-elements {
                display: none;
            }
        }
        
        /* è¾“å…¥æ¡†å ä½ç¬¦æ ·å¼ */
        ::placeholder {
            color: #aaa;
            opacity: 1;
        }
        
        /* è‡ªå®šä¹‰é€‰æ‹©æ¡†ç®­å¤´ */
        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%235A5A5A' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
            padding-right: 40px;
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 141, 199, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 141, 199, 0.7);
        }
        
        /* æ—¥æœŸé€‰æ‹©å™¨æ ·å¼ */
        input[type="date"]::-webkit-calendar-picker-indicator {
            padding: 5px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        /* å¿«é€Ÿæ“ä½œèœå• */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 16px;
            flex-wrap: wrap;
        }
        
        .quick-action-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 10px;
            background: white;
            border: 1px solid #E8E8E8;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        .quick-action-btn:active {
            background: rgba(255, 141, 199, 0.1);
            border-color: var(--primary);
            transform: translateY(2px);
        }
        
        .quick-action-btn i {
            font-size: 1.4rem;
            color: var(--primary);
        }
        
        .quick-action-btn span {
            font-size: 0.9rem;
            color: var(--text);
        }
        
        /* å›¾è¡¨å®¹å™¨æ ·å¼ */
        .chart-container {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid #F0F0F0;
            position: relative;
        }
        
        .chart-title {
            font-size: 1rem;
            color: var(--primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chart-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .chart-control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chart-control-group label {
            font-size: 0.9rem;
            margin-bottom: 0;
        }
        
        .chart-control-group select {
            padding: 8px 12px;
            min-height: 36px;
            width: auto;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .no-data-message {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-style: italic;
        }
        
        .chart-summary {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding: 10px;
            background: rgba(163, 216, 255, 0.1);
            border-radius: 10px;
            font-size: 0.9rem;
        }
        
        .chart-summary-item {
            text-align: center;
            flex: 1;
        }
        
        .chart-summary-value {
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        @media (min-width: 992px) {
            .analysis-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* ç§»åŠ¨ç«¯æ—¥æœŸé€‰æ‹©å™¨ä¼˜åŒ– */
        @media (max-width: 767px) {
            input[type="date"] {
                font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */
            }
            
            .chart-controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .chart-control-group {
                width: 100%;
            }
            
            .chart-control-group select {
                width: 100%;
            }
            
            .chart-wrapper {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-piggy-bank"></i> è®°è´¦æœ¬</h1>
            <p>è½»æ¾è®°å½•æ¯ä¸€ç¬”æ”¶æ”¯ï¼Œè®©è´¢åŠ¡ç®¡ç†å˜å¾—ç®€å•åˆæœ‰è¶£</p>
        </header>
        
        <div class="summary-card">
            <h2><i class="fas fa-wallet"></i> å½“å‰ä½™é¢</h2>
            <div class="amount" id="totalAmount">Â¥0.00</div>
        </div>
        
        <!-- ç§»åŠ¨ç«¯æ ‡ç­¾åˆ‡æ¢ -->
        <div class="mobile-tabs">
            <div class="mobile-tab active" data-tab="form"><i class="fas fa-plus-circle"></i> è®°è´¦</div>
            <div class="mobile-tab" data-tab="records"><i class="fas fa-list-alt"></i> è®°å½•</div>
            <div class="mobile-tab" data-tab="analysis"><i class="fas fa-chart-line"></i> åˆ†æ</div>
            <div class="mobile-tab" data-tab="projects"><i class="fas fa-tags"></i> é¡¹ç›®</div>
        </div>
        
        <div class="content">
            <div class="form-section active" id="formTab">
                <h2 class="section-title"><i class="fas fa-plus-circle"></i> æ·»åŠ æ–°è®°å½•</h2>
                <form id="accountForm">
                    <div class="form-group">
                        <label for="date"><i class="fas fa-calendar-alt"></i> æ—¥æœŸ</label>
                        <input type="date" id="date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="type"><i class="fas fa-exchange-alt"></i> ç±»å‹</label>
                        <select id="type" required>
                            <option value="expense">æ”¯å‡º ğŸ’¸</option>
                            <option value="income">æ”¶å…¥ ğŸ’°</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="project"><i class="fas fa-tags"></i> é¡¹ç›®</label>
                        <select id="project" required>
                            <!-- åŠ¨æ€å¡«å…… -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="amount"><i class="fas fa-coins"></i> é‡‘é¢</label>
                        <input type="number" id="amount" step="0.01" min="0" placeholder="è¯·è¾“å…¥é‡‘é¢" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="note"><i class="fas fa-sticky-note"></i> å¤‡æ³¨</label>
                        <textarea id="note" rows="3" placeholder="æ·»åŠ å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰"></textarea>
                    </div>
                    
                    <div class="buttons">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> æ·»åŠ è®°å½•</button>
                        <button type="button" class="btn btn-secondary" id="resetBtn"><i class="fas fa-redo"></i> é‡ç½®</button>
                    </div>
                </form>
                
                <!-- å¿«é€Ÿæ“ä½œ -->
                <div class="quick-actions">
                    <div class="quick-action-btn" id="quickIncomeBtn">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>å¿«é€Ÿæ”¶å…¥</span>
                    </div>
                    <div class="quick-action-btn" id="quickExpenseBtn">
                        <i class="fas fa-shopping-cart"></i>
                        <span>å¿«é€Ÿæ”¯å‡º</span>
                    </div>
                    <div class="quick-action-btn" id="quickFoodBtn">
                        <i class="fas fa-utensils"></i>
                        <span>é¤é¥®æ¶ˆè´¹</span>
                    </div>
                </div>
                
                <div class="import-section">
                    <h3 class="section-title"><i class="fas fa-file-import"></i> å¯¼å…¥è®°å½•</h3>
                    <div class="file-input-wrapper">
                        <input type="file" id="importFile" accept=".xlsx, .xls, .csv">
                        <label for="importFile" class="file-input-label">
                            <i class="fas fa-upload"></i> é€‰æ‹©Excel/CSVæ–‡ä»¶å¯¼å…¥
                        </label>
                    </div>
                    <div class="import-actions">
                        <button class="btn btn-success" id="downloadTemplateBtn"><i class="fas fa-download"></i> ä¸‹è½½æ¨¡æ¿</button>
                        <button class="btn btn-primary" id="importBtn" disabled><i class="fas fa-file-import"></i> å¯¼å…¥æ•°æ®</button>
                    </div>
                    <div class="import-preview" id="importPreview" style="display: none;">
                        <h4>å¯¼å…¥é¢„è§ˆ (å‰5æ¡è®°å½•)</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>æ—¥æœŸ</th>
                                    <th>ç±»å‹</th>
                                    <th>é¡¹ç›®</th>
                                    <th>é‡‘é¢</th>
                                    <th>å¤‡æ³¨</th>
                                </tr>
                            </thead>
                            <tbody id="importPreviewBody">
                                <!-- åŠ¨æ€å¡«å…… -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="records-section" id="recordsTab">
                <h2 class="section-title"><i class="fas fa-list-alt"></i> è´¦æœ¬è®°å½•</h2>
                
                <div class="search-section">
                    <h3><i class="fas fa-search"></i> æŸ¥è¯¢è®°å½•</h3>
                    <div class="search-row">
                        <div class="search-group">
                            <label for="startDate"><i class="fas fa-calendar"></i> å¼€å§‹æ—¥æœŸ</label>
                            <input type="date" id="startDate">
                        </div>
                        <div class="search-group">
                            <label for="endDate"><i class="fas fa-calendar"></i> ç»“æŸæ—¥æœŸ</label>
                            <input type="date" id="endDate">
                        </div>
                        <div class="search-group">
                            <label for="searchProject"><i class="fas fa-filter"></i> é¡¹ç›®ç­›é€‰</label>
                            <div class="multiselect-container">
                                <div class="multiselect-input" id="multiselectInput">
                                    é€‰æ‹©é¡¹ç›®...
                                </div>
                                <div class="multiselect-dropdown" id="multiselectDropdown">
                                    <div class="multiselect-search">
                                        <input type="text" id="multiselectSearch" placeholder="æœç´¢é¡¹ç›®...">
                                    </div>
                                    <div class="multiselect-options" id="multiselectOptions">
                                        <!-- åŠ¨æ€å¡«å…… -->
                                    </div>
                                </div>
                                <div class="multiselect-selected" id="multiselectSelected">
                                    <!-- åŠ¨æ€å¡«å…… -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="buttons">
                        <button class="btn btn-primary" id="searchBtn"><i class="fas fa-search"></i> æŸ¥è¯¢</button>
                        <button class="btn btn-secondary" id="resetSearchBtn"><i class="fas fa-times"></i> é‡ç½®æŸ¥è¯¢</button>
                    </div>
                    <div class="search-results-info" id="searchResultsInfo">
                        æ˜¾ç¤ºå…¨éƒ¨è®°å½•
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-success" id="exportBtn"><i class="fas fa-file-export"></i> å¯¼å‡ºæ•°æ®(XLSX)</button>
                    <button class="btn btn-danger" id="clearBtn"><i class="fas fa-trash"></i> æ¸…ç©ºè®°å½•</button>
                </div>
                
                <div class="table-container">
                    <table id="recordsTable">
                        <thead>
                            <tr>
                                <th>æ—¥æœŸ</th>
                                <th>ç±»å‹</th>
                                <th>é¡¹ç›®</th>
                                <th>é‡‘é¢</th>
                                <th>å¤‡æ³¨</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- åŠ¨æ€å¡«å…… -->
                        </tbody>
                    </table>
                </div>
                
                <!-- åˆ†é¡µæ§ä»¶ -->
                <div class="pagination">
                    <div class="pagination-info" id="paginationInfo">
                        ç¬¬ 1 é¡µï¼Œå…± 1 é¡µï¼Œæ¯é¡µ 10 æ¡è®°å½•
                    </div>
                    <div class="pagination-controls">
                        <div class="page-size-selector">
                            <span>æ¯é¡µæ˜¾ç¤º:</span>
                            <select id="pageSize">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                                <option value="200">200</option>
                            </select>
                        </div>
                        <button class="pagination-btn" id="firstPageBtn" disabled>é¦–é¡µ</button>
                        <button class="pagination-btn" id="prevPageBtn" disabled>ä¸Šä¸€é¡µ</button>
                        <span id="currentPageIndicator">1</span>
                        <button class="pagination-btn" id="nextPageBtn" disabled>ä¸‹ä¸€é¡µ</button>
                        <button class="pagination-btn" id="lastPageBtn" disabled>æœ«é¡µ</button>
                    </div>
                </div>
            </div>
            
            <!-- åˆ†æéƒ¨åˆ† -->
            <div class="analysis-section" id="analysisTab">
                <h2 class="section-title"><i class="fas fa-chart-line"></i> æ”¶æ”¯åˆ†æ</h2>
                
                <div class="search-section">
                    <h3><i class="fas fa-calendar-alt"></i> åˆ†ææ—¶é—´èŒƒå›´</h3>
                    <div class="search-row">
                        <div class="search-group">
                            <label for="analysisStartDate"><i class="fas fa-calendar"></i> å¼€å§‹æ—¥æœŸ</label>
                            <input type="date" id="analysisStartDate">
                        </div>
                        <div class="search-group">
                            <label for="analysisEndDate"><i class="fas fa-calendar"></i> ç»“æŸæ—¥æœŸ</label>
                            <input type="date" id="analysisEndDate">
                        </div>
                    </div>
                    <div class="buttons">
                        <button class="btn btn-primary" id="updateAnalysisBtn"><i class="fas fa-sync-alt"></i> æ›´æ–°åˆ†æ</button>
                        <button class="btn btn-secondary" id="resetAnalysisBtn"><i class="fas fa-times"></i> é‡ç½®æ—¶é—´</button>
                    </div>
                </div>
                
                <div class="analysis-grid">
                    <!-- æ”¯å‡ºå„é¡¹ç›®å æ¯”å›¾ -->
                    <div class="chart-container">
                        <div class="chart-title"><i class="fas fa-chart-pie"></i> æ”¯å‡ºé¡¹ç›®å æ¯”</div>
                        <div class="chart-controls">
                            <div class="chart-control-group">
                                <label>åˆ†ç»„æ–¹å¼:</label>
                                <select id="expenseGroupBy">
                                    <option value="project">æŒ‰é¡¹ç›®</option>
                                    <option value="month">æŒ‰æœˆ</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="expensePieChart"></canvas>
                            <div class="no-data-message" id="noExpenseData" style="display: none;">æš‚æ— æ”¯å‡ºæ•°æ®</div>
                        </div>
                        <div class="chart-summary" id="expenseSummary" style="display: none;">
                            <div class="chart-summary-item">
                                <div>æ€»æ”¯å‡º</div>
                                <div class="chart-summary-value" id="totalExpenseAmount">Â¥0.00</div>
                            </div>
                            <div class="chart-summary-item">
                                <div>é¡¹ç›®æ•°é‡</div>
                                <div class="chart-summary-value" id="expenseProjectCount">0</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ”¯å‡ºè¶‹åŠ¿åˆ†å¸ƒå›¾ -->
                    <div class="chart-container">
                        <div class="chart-title"><i class="fas fa-chart-line"></i> æ”¯å‡ºè¶‹åŠ¿</div>
                        <div class="chart-controls">
                            <div class="chart-control-group">
                                <label>é¡¹ç›®:</label>
                                <select id="expenseTrendProject">
                                    <option value="all">å…¨éƒ¨é¡¹ç›®</option>
                                    <!-- åŠ¨æ€å¡«å…… -->
                                </select>
                            </div>
                            <div class="chart-control-group">
                                <label>åˆ†ç»„:</label>
                                <select id="expenseTrendGroup">
                                    <option value="day">æŒ‰æ—¥</option>
                                    <option value="week">æŒ‰å‘¨</option>
                                    <option value="month">æŒ‰æœˆ</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="expenseTrendChart"></canvas>
                            <div class="no-data-message" id="noExpenseTrendData" style="display: none;">æš‚æ— æ”¯å‡ºè¶‹åŠ¿æ•°æ®</div>
                        </div>
                        <div class="chart-summary" id="expenseTrendSummary" style="display: none;">
                            <div class="chart-summary-item">
                                <div>å¹³å‡æ”¯å‡º</div>
                                <div class="chart-summary-value" id="avgExpenseAmount">Â¥0.00</div>
                            </div>
                            <div class="chart-summary-item">
                                <div>æœ€å¤§æ”¯å‡º</div>
                                <div class="chart-summary-value" id="maxExpenseAmount">Â¥0.00</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ”¶å…¥è¶‹åŠ¿åˆ†å¸ƒå›¾ -->
                    <div class="chart-container">
                        <div class="chart-title"><i class="fas fa-chart-line"></i> æ”¶å…¥è¶‹åŠ¿</div>
                        <div class="chart-controls">
                            <div class="chart-control-group">
                                <label>é¡¹ç›®:</label>
                                <select id="incomeTrendProject">
                                    <option value="all">å…¨éƒ¨é¡¹ç›®</option>
                                    <!-- åŠ¨æ€å¡«å…… -->
                                </select>
                            </div>
                            <div class="chart-control-group">
                                <label>åˆ†ç»„:</label>
                                <select id="incomeTrendGroup">
                                    <option value="day">æŒ‰æ—¥</option>
                                    <option value="week">æŒ‰å‘¨</option>
                                    <option value="month">æŒ‰æœˆ</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="incomeTrendChart"></canvas>
                            <div class="no-data-message" id="noIncomeTrendData" style="display: none;">æš‚æ— æ”¶å…¥è¶‹åŠ¿æ•°æ®</div>
                        </div>
                        <div class="chart-summary" id="incomeTrendSummary" style="display: none;">
                            <div class="chart-summary-item">
                                <div>å¹³å‡æ”¶å…¥</div>
                                <div class="chart-summary-value" id="avgIncomeAmount">Â¥0.00</div>
                            </div>
                            <div class="chart-summary-item">
                                <div>æœ€å¤§æ”¶å…¥</div>
                                <div class="chart-summary-value" id="maxIncomeAmount">Â¥0.00</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ”¶æ”¯å¯¹æ¯”è¶‹åŠ¿å›¾ -->
                    <div class="chart-container">
                        <div class="chart-title"><i class="fas fa-balance-scale"></i> æ”¶æ”¯å¯¹æ¯”è¶‹åŠ¿</div>
                        <div class="chart-controls">
                            <div class="chart-control-group">
                                <label>åˆ†ç»„:</label>
                                <select id="balanceTrendGroup">
                                    <option value="day">æŒ‰æ—¥</option>
                                    <option value="week">æŒ‰å‘¨</option>
                                    <option value="month">æŒ‰æœˆ</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="balanceTrendChart"></canvas>
                            <div class="no-data-message" id="noBalanceTrendData" style="display: none;">æš‚æ— æ”¶æ”¯å¯¹æ¯”æ•°æ®</div>
                        </div>
                        <div class="chart-summary" id="balanceTrendSummary" style="display: none;">
                            <div class="chart-summary-item">
                                <div>æ€»æ”¶å…¥</div>
                                <div class="chart-summary-value" id="totalIncomeAmount">Â¥0.00</div>
                            </div>
                            <div class="chart-summary-item">
                                <div>æ€»æ”¯å‡º</div>
                                <div class="chart-summary-value" id="totalExpenseTrendAmount">Â¥0.00</div>
                            </div>
                            <div class="chart-summary-item">
                                <div>å‡€æ”¶å…¥</div>
                                <div class="chart-summary-value" id="netIncomeAmount">Â¥0.00</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- é¡¹ç›®ç®¡ç†éƒ¨åˆ†ï¼ˆç§»åŠ¨ç«¯ä¸“å±ï¼‰ -->
            <div class="form-section" id="projectsTab">
                <h2 class="section-title"><i class="fas fa-tags"></i> é¡¹ç›®ç®¡ç†</h2>
                
                <div class="project-management">
                    <button class="btn btn-success" id="addProjectBtn"><i class="fas fa-plus"></i> æ·»åŠ é¡¹ç›®</button>
                    
                    <div class="project-list" id="projectList">
                        <!-- åŠ¨æ€å¡«å…… -->
                    </div>
                </div>
                
                <div class="quick-actions">
                    <div class="quick-action-btn" id="addIncomeProjectBtn">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>æ·»åŠ æ”¶å…¥é¡¹ç›®</span>
                    </div>
                    <div class="quick-action-btn" id="addExpenseProjectBtn">
                        <i class="fas fa-shopping-cart"></i>
                        <span>æ·»åŠ æ”¯å‡ºé¡¹ç›®</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- é¡¹ç›®ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-edit"></i> æ·»åŠ /ç¼–è¾‘é¡¹ç›®</h3>
                <span class="close">&times;</span>
            </div>
            <form id="projectForm">
                <div class="form-group">
                    <label for="projectName"><i class="fas fa-tag"></i> é¡¹ç›®åç§°</label>
                    <input type="text" id="projectName" required>
                </div>
                
                <div class="form-group">
                    <label for="projectType"><i class="fas fa-exchange-alt"></i> é¡¹ç›®ç±»å‹</label>
                    <select id="projectType" required>
                        <option value="expense">æ”¯å‡ºé¡¹ç›® ğŸ’¸</option>
                        <option value="income">æ”¶å…¥é¡¹ç›® ğŸ’°</option>
                    </select>
                </div>
                
                <div class="buttons">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> ä¿å­˜</button>
                    <button type="button" class="btn btn-secondary" id="cancelProjectBtn"><i class="fas fa-times"></i> å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æµ®åŠ¨æŒ‰é’®ï¼ˆæ¡Œé¢ç«¯ï¼‰ -->
    <div class="floating-elements">
        <div class="floating-btn primary" id="quickAddBtn" title="å¿«é€Ÿæ·»åŠ è®°å½•">
            <i class="fas fa-plus"></i>
        </div>
        <div class="floating-btn success" id="quickExportBtn" title="å¿«é€Ÿå¯¼å‡º">
            <i class="fas fa-file-export"></i>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–é»˜è®¤é¡¹ç›®å’Œè´¦æœ¬æ•°æ®
        let projects = [
            { id: 1, name: "å·¥èµ„", type: "income", emoji: "ğŸ’°" },
            { id: 2, name: "å‡ºå·®", type: "income", emoji: "ğŸ’¼" },
            { id: 3, name: "æœ¬é‡‘", type: "income", emoji: "ğŸ’°" },
            { id: 4, name: "åƒé¥­", type: "expense", emoji: "ğŸ”" },
            { id: 5, name: "æ—¥ç”¨å“", type: "expense", emoji: "ğŸ§´" },
            { id: 6, name: "åŒ–å¦†å“", type: "expense", emoji: "ğŸ’„" },
            { id: 7, name: "è¡£æœ", type: "expense", emoji: "ğŸ‘•" },
            { id: 8, name: "å® ç‰©", type: "expense", emoji: "ğŸ¶" },
            { id: 9, name: "è¯è´¹", type: "expense", emoji: "ğŸ“±" },
            { id: 10, name: "MaMa", type: "expense", emoji: "ğŸ‘©" },
            { id: 11, name: "é€šå‹¤", type: "expense", emoji: "ğŸš‡" },
            { id: 12, name: "æˆ¿ç§Ÿ", type: "expense", emoji: "ğŸ " },
            { id: 13, name: "æ°´è´¹", type: "expense", emoji: "ğŸ’§" },
            { id: 14, name: "ç”µè´¹", type: "expense", emoji: "âš¡" },
            { id: 15, name: "ç‡ƒæ°”è´¹", type: "expense", emoji: "ğŸ”¥" },
            { id: 16, name: "ç”µåŠ¨è½¦", type: "expense", emoji: "ğŸ›µ" },
            { id: 17, name: "æ—…æ¸¸", type: "expense", emoji: "âœˆï¸" },
            { id: 18, name: "ç”µå­è´è¶", type: "expense", emoji: "ğŸ®" },
            { id: 19, name: "å¨±ä¹", type: "expense", emoji: "ğŸ¬" },
            { id: 20, name: "åŒ»è¯", type: "expense", emoji: "ğŸ’Š" },
            { id: 21, name: "ç¤¼ç‰©", type: "expense", emoji: "ğŸ" },
            { id: 22, name: "é¥°å“", type: "expense", emoji: "ğŸ’" },
            { id: 23, name: "è®¾å¤‡", type: "expense", emoji: "ğŸ’»" }
        ];

        let records = [];
        let editingProjectId = null;
        let currentFilter = {
            startDate: null,
            endDate: null,
            projects: []
        };
        
        // åˆ†æç›¸å…³å˜é‡
        let analysisFilter = {
            startDate: null,
            endDate: null
        };
        
        // å›¾è¡¨å®ä¾‹
        let expensePieChart = null;
        let expenseTrendChart = null;
        let incomeTrendChart = null;
        let balanceTrendChart = null;
        
        // åˆ†é¡µç›¸å…³å˜é‡
        let currentPage = 1;
        let pageSize = 10;
        let totalPages = 1;
        
        // å¯¼å…¥ç›¸å…³å˜é‡
        let importData = [];
        
        // ç§»åŠ¨ç«¯å½“å‰æ ‡ç­¾
        let currentMobileTab = 'form';
        
        // è§¦æ‘¸ç›¸å…³å˜é‡ - ç”¨äºé˜²æ­¢è¯¯è§¦
        let isMobileTabTouchActive = false;

        // DOM å…ƒç´ 
        const accountForm = document.getElementById('accountForm');
        const projectForm = document.getElementById('projectForm');
        const projectSelect = document.getElementById('project');
        const projectList = document.getElementById('projectList');
        const recordsTable = document.getElementById('recordsTable').getElementsByTagName('tbody')[0];
        const totalAmountElement = document.getElementById('totalAmount');
        const projectModal = document.getElementById('projectModal');
        const addProjectBtn = document.getElementById('addProjectBtn');
        const exportBtn = document.getElementById('exportBtn');
        const clearBtn = document.getElementById('clearBtn');
        const resetBtn = document.getElementById('resetBtn');
        const cancelProjectBtn = document.getElementById('cancelProjectBtn');
        const closeModalBtn = document.querySelector('.close');
        const searchBtn = document.getElementById('searchBtn');
        const resetSearchBtn = document.getElementById('resetSearchBtn');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const searchResultsInfo = document.getElementById('searchResultsInfo');
        const quickAddBtn = document.getElementById('quickAddBtn');
        const quickExportBtn = document.getElementById('quickExportBtn');
        
        // åˆ†é¡µç›¸å…³DOMå…ƒç´ 
        const pageSizeSelect = document.getElementById('pageSize');
        const firstPageBtn = document.getElementById('firstPageBtn');
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');
        const lastPageBtn = document.getElementById('lastPageBtn');
        const currentPageIndicator = document.getElementById('currentPageIndicator');
        const paginationInfo = document.getElementById('paginationInfo');
        
        // å¤šé€‰ä¸‹æ‹‰æ¡†ç›¸å…³DOMå…ƒç´ 
        const multiselectInput = document.getElementById('multiselectInput');
        const multiselectDropdown = document.getElementById('multiselectDropdown');
        const multiselectSearch = document.getElementById('multiselectSearch');
        const multiselectOptions = document.getElementById('multiselectOptions');
        const multiselectSelected = document.getElementById('multiselectSelected');
        
        // å¯¼å…¥ç›¸å…³DOMå…ƒç´ 
        const importFileInput = document.getElementById('importFile');
        const downloadTemplateBtn = document.getElementById('downloadTemplateBtn');
        const importBtn = document.getElementById('importBtn');
        const importPreview = document.getElementById('importPreview');
        const importPreviewBody = document.getElementById('importPreviewBody');
        
        // ç§»åŠ¨ç«¯ç›¸å…³DOMå…ƒç´ 
        const mobileTabs = document.querySelectorAll('.mobile-tab');
        const formTab = document.getElementById('formTab');
        const recordsTab = document.getElementById('recordsTab');
        const analysisTab = document.getElementById('analysisTab');
        const projectsTab = document.getElementById('projectsTab');
        
        // å¿«é€Ÿæ“ä½œæŒ‰é’®
        const quickIncomeBtn = document.getElementById('quickIncomeBtn');
        const quickExpenseBtn = document.getElementById('quickExpenseBtn');
        const quickFoodBtn = document.getElementById('quickFoodBtn');
        const addIncomeProjectBtn = document.getElementById('addIncomeProjectBtn');
        const addExpenseProjectBtn = document.getElementById('addExpenseProjectBtn');
        
        // åˆ†æç›¸å…³DOMå…ƒç´ 
        const analysisStartDateInput = document.getElementById('analysisStartDate');
        const analysisEndDateInput = document.getElementById('analysisEndDate');
        const updateAnalysisBtn = document.getElementById('updateAnalysisBtn');
        const resetAnalysisBtn = document.getElementById('resetAnalysisBtn');
        const expenseGroupBySelect = document.getElementById('expenseGroupBy');
        const expenseTrendProjectSelect = document.getElementById('expenseTrendProject');
        const expenseTrendGroupSelect = document.getElementById('expenseTrendGroup');
        const incomeTrendProjectSelect = document.getElementById('incomeTrendProject');
        const incomeTrendGroupSelect = document.getElementById('incomeTrendGroup');
        const balanceTrendGroupSelect = document.getElementById('balanceTrendGroup');

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            
            // è®¾ç½®æŸ¥è¯¢æ—¥æœŸé»˜è®¤èŒƒå›´ï¼ˆæœ€è¿‘30å¤©ï¼‰
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            startDateInput.value = thirtyDaysAgo.toISOString().split('T')[0];
            endDateInput.value = today;
            
            // è®¾ç½®åˆ†ææ—¥æœŸé»˜è®¤èŒƒå›´ï¼ˆæœ€è¿‘90å¤©ï¼‰
            const ninetyDaysAgo = new Date();
            ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);
            analysisStartDateInput.value = ninetyDaysAgo.toISOString().split('T')[0];
            analysisEndDateInput.value = today;
            
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
            loadData();
            
            // è®¾ç½®é»˜è®¤ç±»å‹ä¸ºæ”¯å‡º
            document.getElementById('type').value = 'expense';
            
            // æ›´æ–°é¡¹ç›®é€‰æ‹©åˆ—è¡¨
            updateProjectSelect();
            
            // è®¾ç½®é»˜è®¤é¡¹ç›®ä¸ºåƒé¥­ï¼ˆidä¸º4ï¼‰
            document.getElementById('project').value = 4;
            
            // æ›´æ–°é¡¹ç›®æ˜¾ç¤ºåˆ—è¡¨
            updateProjectList();
            
            // æ›´æ–°æŸ¥è¯¢é¡¹ç›®é€‰æ‹©åˆ—è¡¨
            updateMultiselectOptions();
            
            // æ›´æ–°è®°å½•è¡¨æ ¼
            updateRecordsTable();
            
            // æ›´æ–°æ€»é‡‘é¢
            updateTotalAmount();
            
            // æ›´æ–°åˆ†é¡µä¿¡æ¯
            updatePaginationInfo();
            
            // æ›´æ–°åˆ†æå›¾è¡¨é¡¹ç›®é€‰æ‹©
            updateAnalysisProjectSelects();
            
            // åˆå§‹åŒ–åˆ†æå›¾è¡¨
            initAnalysisCharts();
            
            // äº‹ä»¶ç›‘å¬å™¨
            accountForm.addEventListener('submit', addRecord);
            projectForm.addEventListener('submit', saveProject);
            addProjectBtn.addEventListener('click', openProjectModal);
            exportBtn.addEventListener('click', exportData);
            clearBtn.addEventListener('click', clearRecords);
            resetBtn.addEventListener('click', resetForm);
            cancelProjectBtn.addEventListener('click', closeProjectModal);
            closeModalBtn.addEventListener('click', closeProjectModal);
            searchBtn.addEventListener('click', applyFilter);
            resetSearchBtn.addEventListener('click', resetFilter);
            quickAddBtn.addEventListener('click', scrollToForm);
            quickExportBtn.addEventListener('click', exportData);
            
            // åˆ†é¡µäº‹ä»¶ç›‘å¬å™¨
            pageSizeSelect.addEventListener('change', changePageSize);
            firstPageBtn.addEventListener('click', () => changePage(1));
            prevPageBtn.addEventListener('click', goToPrevPage);
            nextPageBtn.addEventListener('click', goToNextPage);
            lastPageBtn.addEventListener('click', goToLastPage);
            
            // å¤šé€‰ä¸‹æ‹‰æ¡†äº‹ä»¶ç›‘å¬å™¨
            multiselectInput.addEventListener('click', toggleMultiselectDropdown);
            multiselectSearch.addEventListener('input', filterMultiselectOptions);
            
            // å¯¼å…¥äº‹ä»¶ç›‘å¬å™¨
            importFileInput.addEventListener('change', handleFileSelect);
            downloadTemplateBtn.addEventListener('click', downloadTemplate);
            importBtn.addEventListener('click', importRecords);
            
            // åˆå§‹åŒ–ç§»åŠ¨ç«¯æ ‡ç­¾äº‹ä»¶
            initMobileTabEvents();
            
            // å¿«é€Ÿæ“ä½œæŒ‰é’®äº‹ä»¶
            quickIncomeBtn.addEventListener('click', () => quickAddRecord('income', 'å·¥èµ„', 0));
            quickExpenseBtn.addEventListener('click', () => quickAddRecord('expense', 'æ—¥ç”¨å“', 0));
            quickFoodBtn.addEventListener('click', () => quickAddRecord('expense', 'åƒé¥­', 0));
            addIncomeProjectBtn.addEventListener('click', () => quickAddProject('income'));
            addExpenseProjectBtn.addEventListener('click', () => quickAddProject('expense'));
            
            // åˆ†æäº‹ä»¶ç›‘å¬å™¨
            updateAnalysisBtn.addEventListener('click', updateAnalysisCharts);
            resetAnalysisBtn.addEventListener('click', resetAnalysisFilter);
            expenseGroupBySelect.addEventListener('change', updateAnalysisCharts);
            expenseTrendProjectSelect.addEventListener('change', updateAnalysisCharts);
            expenseTrendGroupSelect.addEventListener('change', updateAnalysisCharts);
            incomeTrendProjectSelect.addEventListener('change', updateAnalysisCharts);
            incomeTrendGroupSelect.addEventListener('change', updateAnalysisCharts);
            balanceTrendGroupSelect.addEventListener('change', updateAnalysisCharts);
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            window.addEventListener('click', function(event) {
                if (event.target === projectModal) {
                    closeProjectModal();
                }
                if (!multiselectInput.contains(event.target) && !multiselectDropdown.contains(event.target)) {
                    multiselectDropdown.classList.remove('active');
                }
            });
            
            // ç›‘å¬ç±»å‹å˜åŒ–ï¼Œæ›´æ–°é¡¹ç›®åˆ—è¡¨
            document.getElementById('type').addEventListener('change', updateProjectSelect);
            
            // ç§»åŠ¨ç«¯åˆå§‹åŒ–
            initMobileView();
        });

        // ç§»åŠ¨ç«¯æ ‡ç­¾äº‹ä»¶åˆå§‹åŒ– - ä¼˜åŒ–ç‰ˆï¼Œé˜²æ­¢æ»šåŠ¨è¯¯è§¦
        function initMobileTabEvents() {
            mobileTabs.forEach(tab => {
                let touchStartTime = 0;
                let touchStartX = 0;
                let touchStartY = 0;
                let isTouchMoved = false;
                
                // è§¦æ‘¸å¼€å§‹äº‹ä»¶
                tab.addEventListener('touchstart', function(e) {
                    touchStartTime = Date.now();
                    touchStartX = e.touches[0].clientX;
                    touchStartY = e.touches[0].clientY;
                    isTouchMoved = false;
                    
                    // æ·»åŠ è§¦æ‘¸æ ·å¼
                    this.classList.add('touching');
                    
                    // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢æ»šåŠ¨
                    e.preventDefault();
                }, { passive: false });
                
                // è§¦æ‘¸ç§»åŠ¨äº‹ä»¶
                tab.addEventListener('touchmove', function(e) {
                    if (isTouchMoved) return;
                    
                    const touchX = e.touches[0].clientX;
                    const touchY = e.touches[0].clientY;
                    
                    // è®¡ç®—ç§»åŠ¨è·ç¦»
                    const deltaX = Math.abs(touchX - touchStartX);
                    const deltaY = Math.abs(touchY - touchStartY);
                    
                    // å¦‚æœç§»åŠ¨è·ç¦»è¶…è¿‡8pxï¼Œè®¤ä¸ºæ˜¯æ»šåŠ¨
                    if (deltaX > 8 || deltaY > 8) {
                        isTouchMoved = true;
                        this.classList.remove('touching');
                    }
                }, { passive: true });
                
                // è§¦æ‘¸ç»“æŸäº‹ä»¶
                tab.addEventListener('touchend', function(e) {
                    const touchEndTime = Date.now();
                    const timeDiff = touchEndTime - touchStartTime;
                    
                    // ç§»é™¤è§¦æ‘¸æ ·å¼
                    this.classList.remove('touching');
                    
                    // åˆ¤æ–­æ˜¯å¦ä¸ºæœ‰æ•ˆç‚¹å‡»ï¼š
                    // 1. è§¦æ‘¸æ—¶é—´åœ¨50-500msä¹‹é—´ï¼ˆé˜²æ­¢é•¿æŒ‰å’Œå¿«é€Ÿæ»šåŠ¨è¯¯è§¦ï¼‰
                    // 2. æ²¡æœ‰æ˜æ˜¾ç§»åŠ¨ï¼ˆisTouchMovedä¸ºfalseï¼‰
                    if (timeDiff >= 50 && timeDiff <= 500 && !isTouchMoved) {
                        const tabId = this.getAttribute('data-tab');
                        switchMobileTab(tabId);
                        
                        // æ·»åŠ ç‚¹å‡»åé¦ˆ
                        this.classList.add('clicked');
                        setTimeout(() => {
                            this.classList.remove('clicked');
                        }, 200);
                    }
                }, { passive: true });
                
                // ç‚¹å‡»äº‹ä»¶ï¼ˆæ¡Œé¢ç«¯ä½¿ç”¨ï¼‰
                tab.addEventListener('click', function(e) {
                    // åœ¨ç§»åŠ¨ç«¯ï¼Œè§¦æ‘¸äº‹ä»¶å·²ç»å¤„ç†ï¼Œè¿™é‡Œåªå¤„ç†æ¡Œé¢ç«¯
                    if (window.innerWidth > 767) {
                        const tabId = this.getAttribute('data-tab');
                        switchMobileTab(tabId);
                    } else {
                        // åœ¨ç§»åŠ¨ç«¯ï¼Œé˜»æ­¢ç‚¹å‡»äº‹ä»¶çš„é»˜è®¤è¡Œä¸º
                        e.preventDefault();
                        e.stopPropagation();
                    }
                });
            });
        }

        // ç§»åŠ¨ç«¯è§†å›¾åˆå§‹åŒ–
        function initMobileView() {
            // æ£€æŸ¥æ˜¯å¦æ˜¯ç§»åŠ¨è®¾å¤‡
            const isMobile = window.innerWidth <= 767;
            
            if (isMobile) {
                // è®¾ç½®åˆå§‹æ ‡ç­¾
                switchMobileTab('form');
                
                // éšè—æ¡Œé¢ç‰ˆæµ®åŠ¨æŒ‰é’®
                document.querySelector('.floating-elements').style.display = 'none';
                
                // è°ƒæ•´è¡¨æ ¼å®¹å™¨å®½åº¦
                const tableContainer = document.querySelector('.table-container');
                if (tableContainer) {
                    const containerWidth = document.querySelector('.container').offsetWidth;
                    tableContainer.style.width = `${containerWidth}px`;
                }
            }
        }

        // åˆ‡æ¢ç§»åŠ¨ç«¯æ ‡ç­¾
        function switchMobileTab(tabId) {
            // å¦‚æœå·²ç»æ˜¯å½“å‰æ ‡ç­¾ï¼Œç›´æ¥è¿”å›
            if (currentMobileTab === tabId) return;
            
            // æ›´æ–°å½“å‰æ ‡ç­¾
            currentMobileTab = tabId;
            
            // æ›´æ–°æ ‡ç­¾æ¿€æ´»çŠ¶æ€
            mobileTabs.forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // æ˜¾ç¤ºå¯¹åº”çš„å†…å®¹åŒºåŸŸ
            const tabs = [formTab, recordsTab, analysisTab, projectsTab];
            tabs.forEach(tab => {
                if (tab.id === `${tabId}Tab`) {
                    tab.classList.add('active');
                    // å¦‚æœæ˜¯åˆ†ææ ‡ç­¾ï¼Œæ›´æ–°å›¾è¡¨
                    if (tabId === 'analysis') {
                        updateAnalysisCharts();
                    }
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // ä¸è‡ªåŠ¨æ»šåŠ¨åˆ°é¡¶éƒ¨ï¼Œé¿å…é¡µé¢è·³åŠ¨
        }

        // æ›´æ–°åˆ†æå›¾è¡¨é¡¹ç›®é€‰æ‹©
        function updateAnalysisProjectSelects() {
            // æ›´æ–°æ”¯å‡ºè¶‹åŠ¿é¡¹ç›®é€‰æ‹©
            expenseTrendProjectSelect.innerHTML = '<option value="all">å…¨éƒ¨é¡¹ç›®</option>';
            projects.filter(p => p.type === 'expense').forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = `${project.emoji || 'ğŸ“'} ${project.name}`;
                expenseTrendProjectSelect.appendChild(option);
            });
            
            // æ›´æ–°æ”¶å…¥è¶‹åŠ¿é¡¹ç›®é€‰æ‹©
            incomeTrendProjectSelect.innerHTML = '<option value="all">å…¨éƒ¨é¡¹ç›®</option>';
            projects.filter(p => p.type === 'income').forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = `${project.emoji || 'ğŸ“'} ${project.name}`;
                incomeTrendProjectSelect.appendChild(option);
            });
        }

        // åˆå§‹åŒ–åˆ†æå›¾è¡¨
        function initAnalysisCharts() {
            // é”€æ¯ç°æœ‰çš„å›¾è¡¨å®ä¾‹
            if (expensePieChart) expensePieChart.destroy();
            if (expenseTrendChart) expenseTrendChart.destroy();
            if (incomeTrendChart) incomeTrendChart.destroy();
            if (balanceTrendChart) balanceTrendChart.destroy();
            
            // åˆ›å»ºå›¾è¡¨ç”»å¸ƒ
            const expensePieCtx = document.getElementById('expensePieChart').getContext('2d');
            const expenseTrendCtx = document.getElementById('expenseTrendChart').getContext('2d');
            const incomeTrendCtx = document.getElementById('incomeTrendChart').getContext('2d');
            const balanceTrendCtx = document.getElementById('balanceTrendChart').getContext('2d');
            
            // åˆå§‹åŒ–å›¾è¡¨å®ä¾‹
            expensePieChart = new Chart(expensePieCtx, {
                type: 'pie',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                padding: 10
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    label += `Â¥${value.toFixed(2)} (${percentage}%)`;
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
            
            expenseTrendChart = new Chart(expenseTrendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'æ”¯å‡º',
                        data: [],
                        borderColor: '#FF6B6B',
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Â¥' + value;
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'æ”¯å‡º: Â¥' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
            
            incomeTrendChart = new Chart(incomeTrendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'æ”¶å…¥',
                        data: [],
                        borderColor: '#2E8B57',
                        backgroundColor: 'rgba(46, 139, 87, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Â¥' + value;
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'æ”¶å…¥: Â¥' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
            
            balanceTrendChart = new Chart(balanceTrendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'æ”¶å…¥',
                            data: [],
                            borderColor: '#2E8B57',
                            backgroundColor: 'rgba(46, 139, 87, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'æ”¯å‡º',
                            data: [],
                            borderColor: '#FF6B6B',
                            backgroundColor: 'rgba(255, 107, 107, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'å‡€æ”¶å…¥',
                            data: [],
                            borderColor: '#FF8DC7',
                            backgroundColor: 'rgba(255, 141, 199, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Â¥' + value;
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': Â¥' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
        }

        // æ›´æ–°åˆ†æå›¾è¡¨
        function updateAnalysisCharts() {
            // è·å–åˆ†ææ—¶é—´èŒƒå›´
            const startDate = analysisStartDateInput.value;
            const endDate = analysisEndDateInput.value;
            
            if (!startDate || !endDate) {
                showNotification('è¯·é€‰æ‹©åˆ†ææ—¶é—´èŒƒå›´', 'danger');
                return;
            }
            
            if (new Date(startDate) > new Date(endDate)) {
                showNotification('å¼€å§‹æ—¥æœŸä¸èƒ½æ™šäºç»“æŸæ—¥æœŸ', 'danger');
                return;
            }
            
            // è¿‡æ»¤å‡ºåœ¨æ—¶é—´èŒƒå›´å†…çš„è®°å½•
            let filteredRecords = records.filter(record => {
                const recordDate = new Date(record.date);
                const start = new Date(startDate);
                const end = new Date(endDate);
                return recordDate >= start && recordDate <= end;
            });
            
            if (filteredRecords.length === 0) {
                showNotification('åœ¨é€‰å®šæ—¶é—´èŒƒå›´å†…æ²¡æœ‰è®°å½•', 'danger');
                return;
            }
            
            // æ›´æ–°æ”¯å‡ºé¥¼å›¾
            updateExpensePieChart(filteredRecords);
            
            // æ›´æ–°æ”¯å‡ºè¶‹åŠ¿å›¾
            updateExpenseTrendChart(filteredRecords);
            
            // æ›´æ–°æ”¶å…¥è¶‹åŠ¿å›¾
            updateIncomeTrendChart(filteredRecords);
            
            // æ›´æ–°æ”¶æ”¯å¯¹æ¯”è¶‹åŠ¿å›¾
            updateBalanceTrendChart(filteredRecords);
            
            showNotification('åˆ†æå›¾è¡¨å·²æ›´æ–°', 'success');
        }

        // æ›´æ–°æ”¯å‡ºé¥¼å›¾
        function updateExpensePieChart(filteredRecords) {
            // ç­›é€‰æ”¯å‡ºè®°å½•
            const expenseRecords = filteredRecords.filter(record => record.type === 'expense');
            
            if (expenseRecords.length === 0) {
                document.getElementById('noExpenseData').style.display = 'block';
                document.getElementById('expenseSummary').style.display = 'none';
                expensePieChart.data.labels = [];
                expensePieChart.data.datasets[0].data = [];
                expensePieChart.update();
                return;
            }
            
            document.getElementById('noExpenseData').style.display = 'none';
            document.getElementById('expenseSummary').style.display = 'flex';
            
            const groupBy = expenseGroupBySelect.value;
            let labels = [];
            let data = [];
            let colors = [];
            
            if (groupBy === 'project') {
                // æŒ‰é¡¹ç›®åˆ†ç»„
                const projectMap = {};
                
                expenseRecords.forEach(record => {
                    const projectName = record.projectName;
                    const amount = Math.abs(record.amount);
                    
                    if (!projectMap[projectName]) {
                        projectMap[projectName] = 0;
                    }
                    projectMap[projectName] += amount;
                });
                
                // æŒ‰é‡‘é¢æ’åº
                const sortedProjects = Object.entries(projectMap)
                    .sort((a, b) => b[1] - a[1]);
                
                // ç”Ÿæˆå›¾è¡¨æ•°æ®
                sortedProjects.forEach(([projectName, amount], index) => {
                    labels.push(projectName);
                    data.push(amount);
                    colors.push(getColorForIndex(index));
                });
                
                // æ›´æ–°æ‘˜è¦ä¿¡æ¯
                const totalExpense = data.reduce((sum, val) => sum + val, 0);
                document.getElementById('totalExpenseAmount').textContent = `Â¥${totalExpense.toFixed(2)}`;
                document.getElementById('expenseProjectCount').textContent = labels.length;
                
            } else if (groupBy === 'month') {
                // æŒ‰æœˆåˆ†ç»„
                const monthMap = {};
                
                expenseRecords.forEach(record => {
                    const date = new Date(record.date);
                    const monthKey = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                    const monthLabel = `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ`;
                    const amount = Math.abs(record.amount);
                    
                    if (!monthMap[monthKey]) {
                        monthMap[monthKey] = {
                            label: monthLabel,
                            amount: 0
                        };
                    }
                    monthMap[monthKey].amount += amount;
                });
                
                // æŒ‰æœˆä»½æ’åº
                const sortedMonths = Object.values(monthMap)
                    .sort((a, b) => {
                        const aDate = new Date(a.label.replace('å¹´', '-').replace('æœˆ', ''));
                        const bDate = new Date(b.label.replace('å¹´', '-').replace('æœˆ', ''));
                        return aDate - bDate;
                    });
                
                // ç”Ÿæˆå›¾è¡¨æ•°æ®
                sortedMonths.forEach((month, index) => {
                    labels.push(month.label);
                    data.push(month.amount);
                    colors.push(getColorForIndex(index));
                });
                
                // æ›´æ–°æ‘˜è¦ä¿¡æ¯
                const totalExpense = data.reduce((sum, val) => sum + val, 0);
                document.getElementById('totalExpenseAmount').textContent = `Â¥${totalExpense.toFixed(2)}`;
                document.getElementById('expenseProjectCount').textContent = labels.length;
            }
            
            // æ›´æ–°å›¾è¡¨
            expensePieChart.data.labels = labels;
            expensePieChart.data.datasets[0].data = data;
            expensePieChart.data.datasets[0].backgroundColor = colors;
            expensePieChart.update();
        }

        // æ›´æ–°æ”¯å‡ºè¶‹åŠ¿å›¾
        function updateExpenseTrendChart(filteredRecords) {
            // ç­›é€‰æ”¯å‡ºè®°å½•
            let expenseRecords = filteredRecords.filter(record => record.type === 'expense');
            
            // æ ¹æ®é€‰æ‹©çš„é¡¹ç›®è¿›è¡Œè¿‡æ»¤
            const selectedProject = expenseTrendProjectSelect.value;
            if (selectedProject !== 'all') {
                expenseRecords = expenseRecords.filter(record => record.projectId === parseInt(selectedProject));
            }
            
            if (expenseRecords.length === 0) {
                document.getElementById('noExpenseTrendData').style.display = 'block';
                document.getElementById('expenseTrendSummary').style.display = 'none';
                expenseTrendChart.data.labels = [];
                expenseTrendChart.data.datasets[0].data = [];
                expenseTrendChart.update();
                return;
            }
            
            document.getElementById('noExpenseTrendData').style.display = 'none';
            document.getElementById('expenseTrendSummary').style.display = 'flex';
            
            const groupBy = expenseTrendGroupSelect.value;
            const { labels, data } = groupRecordsByTime(expenseRecords, groupBy);
            
            // æ›´æ–°æ‘˜è¦ä¿¡æ¯
            const totalExpense = data.reduce((sum, val) => sum + val, 0);
            const avgExpense = totalExpense / data.length;
            const maxExpense = Math.max(...data);
            
            document.getElementById('avgExpenseAmount').textContent = `Â¥${avgExpense.toFixed(2)}`;
            document.getElementById('maxExpenseAmount').textContent = `Â¥${maxExpense.toFixed(2)}`;
            
            // æ›´æ–°å›¾è¡¨
            expenseTrendChart.data.labels = labels;
            expenseTrendChart.data.datasets[0].data = data;
            expenseTrendChart.update();
        }

        // æ›´æ–°æ”¶å…¥è¶‹åŠ¿å›¾
        function updateIncomeTrendChart(filteredRecords) {
            // ç­›é€‰æ”¶å…¥è®°å½•
            let incomeRecords = filteredRecords.filter(record => record.type === 'income');
            
            // æ ¹æ®é€‰æ‹©çš„é¡¹ç›®è¿›è¡Œè¿‡æ»¤
            const selectedProject = incomeTrendProjectSelect.value;
            if (selectedProject !== 'all') {
                incomeRecords = incomeRecords.filter(record => record.projectId === parseInt(selectedProject));
            }
            
            if (incomeRecords.length === 0) {
                document.getElementById('noIncomeTrendData').style.display = 'block';
                document.getElementById('incomeTrendSummary').style.display = 'none';
                incomeTrendChart.data.labels = [];
                incomeTrendChart.data.datasets[0].data = [];
                incomeTrendChart.update();
                return;
            }
            
            document.getElementById('noIncomeTrendData').style.display = 'none';
            document.getElementById('incomeTrendSummary').style.display = 'flex';
            
            const groupBy = incomeTrendGroupSelect.value;
            const { labels, data } = groupRecordsByTime(incomeRecords, groupBy);
            
            // æ›´æ–°æ‘˜è¦ä¿¡æ¯
            const totalIncome = data.reduce((sum, val) => sum + val, 0);
            const avgIncome = totalIncome / data.length;
            const maxIncome = Math.max(...data);
            
            document.getElementById('avgIncomeAmount').textContent = `Â¥${avgIncome.toFixed(2)}`;
            document.getElementById('maxIncomeAmount').textContent = `Â¥${maxIncome.toFixed(2)}`;
            
            // æ›´æ–°å›¾è¡¨
            incomeTrendChart.data.labels = labels;
            incomeTrendChart.data.datasets[0].data = data;
            incomeTrendChart.update();
        }

        // æ›´æ–°æ”¶æ”¯å¯¹æ¯”è¶‹åŠ¿å›¾
        function updateBalanceTrendChart(filteredRecords) {
            // åˆ†ç¦»æ”¶å…¥å’Œæ”¯å‡ºè®°å½•
            const incomeRecords = filteredRecords.filter(record => record.type === 'income');
            const expenseRecords = filteredRecords.filter(record => record.type === 'expense');
            
            if (incomeRecords.length === 0 && expenseRecords.length === 0) {
                document.getElementById('noBalanceTrendData').style.display = 'block';
                document.getElementById('balanceTrendSummary').style.display = 'none';
                balanceTrendChart.data.labels = [];
                balanceTrendChart.data.datasets[0].data = [];
                balanceTrendChart.data.datasets[1].data = [];
                balanceTrendChart.data.datasets[2].data = [];
                balanceTrendChart.update();
                return;
            }
            
            document.getElementById('noBalanceTrendData').style.display = 'none';
            document.getElementById('balanceTrendSummary').style.display = 'flex';
            
            const groupBy = balanceTrendGroupSelect.value;
            
            // åˆ†ç»„æ”¶å…¥æ•°æ®
            const incomeData = groupRecordsByTime(incomeRecords, groupBy);
            
            // åˆ†ç»„æ”¯å‡ºæ•°æ®
            const expenseData = groupRecordsByTime(expenseRecords, groupBy);
            
            // ç¡®ä¿æ ‡ç­¾ä¸€è‡´
            let labels = [];
            if (incomeData.labels.length > 0) {
                labels = incomeData.labels;
            } else {
                labels = expenseData.labels;
            }
            
            // ç¡®ä¿æ•°æ®é•¿åº¦ä¸€è‡´
            const incomeValues = alignDataToLabels(incomeData.data, incomeData.labels, labels);
            const expenseValues = alignDataToLabels(expenseData.data, expenseData.labels, labels);
            
            // è®¡ç®—å‡€æ”¶å…¥
            const netValues = incomeValues.map((income, index) => {
                const expense = expenseValues[index] || 0;
                return income - expense;
            });
            
            // æ›´æ–°æ‘˜è¦ä¿¡æ¯
            const totalIncome = incomeValues.reduce((sum, val) => sum + val, 0);
            const totalExpense = expenseValues.reduce((sum, val) => sum + val, 0);
            const netIncome = totalIncome - totalExpense;
            
            document.getElementById('totalIncomeAmount').textContent = `Â¥${totalIncome.toFixed(2)}`;
            document.getElementById('totalExpenseTrendAmount').textContent = `Â¥${totalExpense.toFixed(2)}`;
            document.getElementById('netIncomeAmount').textContent = `Â¥${netIncome.toFixed(2)}`;
            
            // æ›´æ–°å›¾è¡¨
            balanceTrendChart.data.labels = labels;
            balanceTrendChart.data.datasets[0].data = incomeValues;
            balanceTrendChart.data.datasets[1].data = expenseValues;
            balanceTrendChart.data.datasets[2].data = netValues;
            balanceTrendChart.update();
        }

        // æŒ‰æ—¶é—´åˆ†ç»„è®°å½•
        function groupRecordsByTime(records, groupBy) {
            const groupedData = {};
            const labels = [];
            const data = [];
            
            records.forEach(record => {
                const date = new Date(record.date);
                let key, label;
                
                if (groupBy === 'day') {
                    key = date.toISOString().split('T')[0];
                    label = `${date.getMonth() + 1}/${date.getDate()}`;
                } else if (groupBy === 'week') {
                    const weekStart = new Date(date);
                    weekStart.setDate(date.getDate() - date.getDay());
                    key = `${weekStart.getFullYear()}-W${Math.ceil((date.getDate() + 6 - date.getDay()) / 7)}`;
                    label = `${date.getMonth() + 1}æœˆç¬¬${Math.ceil((date.getDate() + 6 - date.getDay()) / 7)}å‘¨`;
                } else if (groupBy === 'month') {
                    key = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                    label = `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ`;
                }
                
                if (!groupedData[key]) {
                    groupedData[key] = {
                        label: label,
                        amount: 0
                    };
                }
                
                groupedData[key].amount += Math.abs(record.amount);
            });
            
            // æŒ‰æ—¶é—´æ’åº
            const sortedKeys = Object.keys(groupedData).sort();
            
            sortedKeys.forEach(key => {
                labels.push(groupedData[key].label);
                data.push(groupedData[key].amount);
            });
            
            return { labels, data };
        }

        // å°†æ•°æ®å¯¹é½åˆ°æ ‡ç­¾
        function alignDataToLabels(data, sourceLabels, targetLabels) {
            const result = [];
            
            targetLabels.forEach(label => {
                const index = sourceLabels.indexOf(label);
                if (index !== -1) {
                    result.push(data[index]);
                } else {
                    result.push(0);
                }
            });
            
            return result;
        }

        // è·å–é¢œè‰²
        function getColorForIndex(index) {
            const colors = [
                '#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0', '#118AB2',
                '#EF476F', '#7B68EE', '#FFA07A', '#20B2AA', '#FF8DC7',
                '#A3D8FF', '#FFD59E', '#A8E6CF', '#FFAAA5', '#C1E3FF'
            ];
            return colors[index % colors.length];
        }

        // é‡ç½®åˆ†æç­›é€‰æ¡ä»¶
        function resetAnalysisFilter() {
            const ninetyDaysAgo = new Date();
            ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);
            const today = new Date().toISOString().split('T')[0];
            
            analysisStartDateInput.value = ninetyDaysAgo.toISOString().split('T')[0];
            analysisEndDateInput.value = today;
            
            updateAnalysisCharts();
        }

        // å¿«é€Ÿæ·»åŠ è®°å½•
        function quickAddRecord(type, defaultProject, defaultAmount) {
            // è®¾ç½®è¡¨å•å€¼
            document.getElementById('type').value = type;
            updateProjectSelect();
            
            // æŸ¥æ‰¾å¯¹åº”çš„é¡¹ç›®ID
            const project = projects.find(p => p.name === defaultProject && p.type === type);
            if (project) {
                document.getElementById('project').value = project.id;
            }
            
            // è®¾ç½®é‡‘é¢ä¸º0ï¼Œè®©ç”¨æˆ·è¾“å…¥
            document.getElementById('amount').value = '';
            
            // è®¾ç½®ç„¦ç‚¹åˆ°é‡‘é¢è¾“å…¥æ¡†
            document.getElementById('amount').focus();
            
            // åˆ‡æ¢åˆ°è¡¨å•æ ‡ç­¾
            if (window.innerWidth <= 767) {
                switchMobileTab('form');
            }
            
            // æ»šåŠ¨åˆ°è¡¨å•
            scrollToForm();
            
            showNotification(`å·²åˆ‡æ¢åˆ°${type === 'income' ? 'æ”¶å…¥' : 'æ”¯å‡º'}æ¨¡å¼ï¼Œè¯·è¾“å…¥é‡‘é¢`, 'success');
        }

        // å¿«é€Ÿæ·»åŠ é¡¹ç›®
        function quickAddProject(type) {
            openProjectModal();
            document.getElementById('projectType').value = type;
            
            // æ ¹æ®ç±»å‹ç”Ÿæˆé»˜è®¤é¡¹ç›®å
            if (type === 'income') {
                document.getElementById('projectName').value = 'å…¶ä»–æ”¶å…¥';
            } else {
                document.getElementById('projectName').value = 'å…¶ä»–æ”¯å‡º';
            }
            
            // è®¾ç½®ç„¦ç‚¹åˆ°é¡¹ç›®åè¾“å…¥æ¡†
            document.getElementById('projectName').focus();
        }

        // æ»šåŠ¨åˆ°è¡¨å•åŒºåŸŸ
        function scrollToForm() {
            if (window.innerWidth <= 767) {
                switchMobileTab('form');
            } else {
                document.querySelector('.form-section').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            }
        }

        // åŠ è½½æœ¬åœ°å­˜å‚¨çš„æ•°æ®
        function loadData() {
            const savedProjects = localStorage.getItem('accountProjects');
            const savedRecords = localStorage.getItem('accountRecords');
            
            if (savedProjects) {
                projects = JSON.parse(savedProjects);
            }
            
            if (savedRecords) {
                records = JSON.parse(savedRecords);
            }
        }

        // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveData() {
            localStorage.setItem('accountProjects', JSON.stringify(projects));
            localStorage.setItem('accountRecords', JSON.stringify(records));
        }

        // æ›´æ–°é¡¹ç›®é€‰æ‹©ä¸‹æ‹‰åˆ—è¡¨
        function updateProjectSelect() {
            const type = document.getElementById('type').value;
            projectSelect.innerHTML = '';
            
            const filteredProjects = projects.filter(project => project.type === type);
            
            // æŸ¥æ‰¾åƒé¥­é¡¹ç›®æ˜¯å¦å­˜åœ¨
            const foodProject = filteredProjects.find(p => p.id === 4);
            
            filteredProjects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = `${project.emoji || 'ğŸ“'} ${project.name}`;
                projectSelect.appendChild(option);
            });
            
            // å¦‚æœåƒé¥­é¡¹ç›®å­˜åœ¨ï¼Œä¸”å½“å‰ç±»å‹æ˜¯æ”¯å‡ºï¼Œåˆ™é»˜è®¤é€‰ä¸­åƒé¥­é¡¹ç›®
            if (foodProject && type === 'expense') {
                document.getElementById('project').value = 4;
            }
        }

        // æ›´æ–°å¤šé€‰ä¸‹æ‹‰æ¡†é€‰é¡¹
        function updateMultiselectOptions() {
            multiselectOptions.innerHTML = '';
            
            projects.forEach(project => {
                const option = document.createElement('div');
                option.className = 'multiselect-option';
                option.dataset.id = project.id;
                option.innerHTML = `
                    <span class="emoji">${project.emoji || 'ğŸ“'}</span>
                    <span>${project.name}</span>
                    <span style="margin-left: auto; font-size: 0.8rem; color: #999;">${project.type === 'income' ? 'æ”¶å…¥' : 'æ”¯å‡º'}</span>
                `;
                
                option.addEventListener('click', () => toggleProjectSelection(project.id));
                
                // å¦‚æœé¡¹ç›®å·²è¢«é€‰ä¸­ï¼Œæ·»åŠ é€‰ä¸­æ ·å¼
                if (currentFilter.projects.includes(project.id)) {
                    option.classList.add('selected');
                }
                
                multiselectOptions.appendChild(option);
            });
            
            updateMultiselectSelected();
        }

        // åˆ‡æ¢é¡¹ç›®é€‰æ‹©çŠ¶æ€
        function toggleProjectSelection(projectId) {
            const index = currentFilter.projects.indexOf(projectId);
            
            if (index === -1) {
                // æ·»åŠ é¡¹ç›®
                currentFilter.projects.push(projectId);
            } else {
                // ç§»é™¤é¡¹ç›®
                currentFilter.projects.splice(index, 1);
            }
            
            // æ›´æ–°UI
            updateMultiselectOptions();
        }

        // æ›´æ–°å·²é€‰é¡¹ç›®æ˜¾ç¤º
        function updateMultiselectSelected() {
            multiselectSelected.innerHTML = '';
            
            if (currentFilter.projects.length === 0) {
                multiselectInput.textContent = 'é€‰æ‹©é¡¹ç›®...';
                return;
            }
            
            multiselectInput.textContent = `å·²é€‰æ‹© ${currentFilter.projects.length} ä¸ªé¡¹ç›®`;
            
            currentFilter.projects.forEach(projectId => {
                const project = projects.find(p => p.id === projectId);
                if (project) {
                    const tag = document.createElement('div');
                    tag.className = 'selected-tag';
                    tag.innerHTML = `
                        <span class="emoji">${project.emoji || 'ğŸ“'}</span>
                        <span>${project.name}</span>
                        <span class="remove" data-id="${project.id}">Ã—</span>
                    `;
                    
                    tag.querySelector('.remove').addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleProjectSelection(project.id);
                    });
                    
                    multiselectSelected.appendChild(tag);
                }
            });
        }

        // åˆ‡æ¢å¤šé€‰ä¸‹æ‹‰æ¡†æ˜¾ç¤ºçŠ¶æ€
        function toggleMultiselectDropdown() {
            multiselectDropdown.classList.toggle('active');
            if (multiselectDropdown.classList.contains('active')) {
                multiselectSearch.focus();
            }
        }

        // è¿‡æ»¤å¤šé€‰ä¸‹æ‹‰æ¡†é€‰é¡¹
        function filterMultiselectOptions() {
            const searchTerm = multiselectSearch.value.toLowerCase();
            const options = multiselectOptions.querySelectorAll('.multiselect-option');
            
            options.forEach(option => {
                const text = option.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    option.style.display = 'flex';
                } else {
                    option.style.display = 'none';
                }
            });
        }

        // æ›´æ–°é¡¹ç›®æ˜¾ç¤ºåˆ—è¡¨
        function updateProjectList() {
            projectList.innerHTML = '';
            
            if (projects.length === 0) {
                projectList.innerHTML = '<div class="empty-state"><p>æš‚æ— é¡¹ç›®ï¼Œè¯·æ·»åŠ </p></div>';
                return;
            }
            
            // é¦–å…ˆæ˜¾ç¤ºåƒé¥­é¡¹ç›®
            const foodProject = projects.find(p => p.id === 4);
            if (foodProject) {
                const projectItem = document.createElement('div');
                projectItem.className = `project-item ${foodProject.type}`;
                projectItem.style.order = '-1'; // å°†åƒé¥­é¡¹ç›®æ’åœ¨æœ€å‰é¢
                projectItem.innerHTML = `
                    <span class="emoji">${foodProject.emoji || 'ğŸ“'}</span>
                    <span>${foodProject.name}</span>
                    <div class="actions">
                        <button class="btn btn-secondary edit-project" data-id="${foodProject.id}"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger delete-project" data-id="${foodProject.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                projectList.appendChild(projectItem);
            }
            
            // æ˜¾ç¤ºå…¶ä»–é¡¹ç›®ï¼ˆæ’é™¤åƒé¥­é¡¹ç›®ï¼‰
            projects.forEach(project => {
                if (project.id === 4) return; // è·³è¿‡åƒé¥­é¡¹ç›®ï¼Œå› ä¸ºå·²ç»æ˜¾ç¤ºè¿‡äº†
                
                const projectItem = document.createElement('div');
                projectItem.className = `project-item ${project.type}`;
                projectItem.innerHTML = `
                    <span class="emoji">${project.emoji || 'ğŸ“'}</span>
                    <span>${project.name}</span>
                    <div class="actions">
                        <button class="btn btn-secondary edit-project" data-id="${project.id}"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger delete-project" data-id="${project.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                projectList.appendChild(projectItem);
            });
            
            // æ·»åŠ ç¼–è¾‘å’Œåˆ é™¤é¡¹ç›®çš„äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.edit-project').forEach(button => {
                button.addEventListener('click', function() {
                    const projectId = parseInt(this.getAttribute('data-id'));
                    editProject(projectId);
                });
            });
            
            document.querySelectorAll('.delete-project').forEach(button => {
                button.addEventListener('click', function() {
                    const projectId = parseInt(this.getAttribute('data-id'));
                    deleteProject(projectId);
                });
            });
        }

        // æ·»åŠ æ–°è®°å½•
        function addRecord(e) {
            e.preventDefault();
            
            const date = document.getElementById('date').value;
            const type = document.getElementById('type').value;
            const projectId = parseInt(document.getElementById('project').value);
            let amount = parseFloat(document.getElementById('amount').value);
            const note = document.getElementById('note').value;
            
            // éªŒè¯é‡‘é¢
            if (isNaN(amount) || amount <= 0) {
                showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢', 'danger');
                document.getElementById('amount').focus();
                return;
            }
            
            // å¦‚æœæ˜¯æ”¯å‡ºï¼Œé‡‘é¢è½¬ä¸ºè´Ÿæ•°
            if (type === 'expense') {
                amount = -Math.abs(amount);
            }
            
            // è·å–é¡¹ç›®åç§°
            const project = projects.find(p => p.id === projectId);
            const projectName = project ? project.name : 'æœªçŸ¥';
            const projectEmoji = project ? project.emoji : 'ğŸ“';
            
            // åˆ›å»ºæ–°è®°å½•
            const newRecord = {
                id: Date.now(),
                date,
                type,
                projectId,
                projectName,
                projectEmoji,
                amount,
                note
            };
            
            records.unshift(newRecord); // æ·»åŠ åˆ°å¼€å¤´ï¼Œè¿™æ ·æœ€æ–°çš„è®°å½•æ˜¾ç¤ºåœ¨æœ€å‰é¢
            saveData();
            updateRecordsTable();
            updateTotalAmount();
            resetForm();
            
            // æ›´æ–°åˆ†æå›¾è¡¨ï¼ˆå¦‚æœå½“å‰åœ¨åˆ†æé¡µé¢ï¼‰
            if (currentMobileTab === 'analysis') {
                updateAnalysisCharts();
            }
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            showNotification(`æˆåŠŸæ·»åŠ ${type === 'income' ? 'æ”¶å…¥' : 'æ”¯å‡º'}è®°å½•ï¼`, 'success');
            
            // åœ¨ç§»åŠ¨ç«¯åˆ‡æ¢åˆ°è®°å½•æ ‡ç­¾
            if (window.innerWidth <= 767) {
                setTimeout(() => switchMobileTab('records'), 500);
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type) {
            // ç§»é™¤ç°æœ‰çš„é€šçŸ¥
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: ${type === 'success' ? 'var(--success)' : 'var(--danger)'}; color: white; padding: 12px 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 1000; display: flex; align-items: center; gap: 10px; max-width: 90%;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // 3ç§’åç§»é™¤é€šçŸ¥
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // æ›´æ–°è®°å½•è¡¨æ ¼
        function updateRecordsTable() {
            recordsTable.innerHTML = '';
            
            // åº”ç”¨ç­›é€‰æ¡ä»¶
            let filteredRecords = applyFilterToRecords(records);
            
            // è®¡ç®—åˆ†é¡µ
            totalPages = Math.ceil(filteredRecords.length / pageSize);
            if (currentPage > totalPages) {
                currentPage = totalPages || 1;
            }
            
            // è·å–å½“å‰é¡µçš„è®°å½•
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const currentPageRecords = filteredRecords.slice(startIndex, endIndex);
            
            if (currentPageRecords.length === 0) {
                const emptyState = document.createElement('tr');
                emptyState.innerHTML = `
                    <td colspan="6">
                        <div class="empty-state">
                            <i class="fas fa-receipt"></i>
                            <p>æš‚æ— è®°å½•</p>
                            <p>ç‚¹å‡»"æ·»åŠ è®°å½•"å¼€å§‹è®°è´¦å§ï¼</p>
                        </div>
                    </td>
                `;
                recordsTable.appendChild(emptyState);
                return;
            }
            
            // æŒ‰æ—¥æœŸæ’åºï¼Œæœ€æ–°çš„åœ¨å‰é¢
            currentPageRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            currentPageRecords.forEach(record => {
                const row = recordsTable.insertRow();
                
                // æ—¥æœŸ
                const dateCell = row.insertCell(0);
                const dateObj = new Date(record.date);
                const month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
                const day = dateObj.getDate().toString().padStart(2, '0');
                dateCell.textContent = `${month}-${day}`;
                dateCell.title = record.date;
                
                // ç±»å‹
                const typeCell = row.insertCell(1);
                typeCell.innerHTML = `
                    <span class="type-indicator ${record.type === 'income' ? 'type-income' : 'type-expense'}"></span>
                    ${record.type === 'income' ? 'æ”¶å…¥' : 'æ”¯å‡º'}
                `;
                
                // é¡¹ç›®
                const projectCell = row.insertCell(2);
                projectCell.innerHTML = `<span class="emoji">${record.projectEmoji || 'ğŸ“'}</span> ${record.projectName}`;
                
                // é‡‘é¢
                const amountCell = row.insertCell(3);
                amountCell.textContent = `Â¥${Math.abs(record.amount).toFixed(2)}`;
                amountCell.className = record.type === 'income' ? 'income' : 'expense';
                
                // å¤‡æ³¨
                const noteCell = row.insertCell(4);
                noteCell.textContent = record.note || '-';
                noteCell.title = record.note || '';
                
                // æ“ä½œ
                const actionCell = row.insertCell(5);
                actionCell.innerHTML = `<button class="btn btn-danger delete-record" data-id="${record.id}"><i class="fas fa-trash"></i></button>`;
            });
            
            // æ·»åŠ åˆ é™¤è®°å½•çš„äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.delete-record').forEach(button => {
                button.addEventListener('click', function() {
                    const recordId = parseInt(this.getAttribute('data-id'));
                    deleteRecord(recordId);
                });
            });
            
            // æ›´æ–°æœç´¢ç»“æœä¿¡æ¯
            updateSearchResultsInfo(filteredRecords.length);
            
            // æ›´æ–°åˆ†é¡µä¿¡æ¯
            updatePaginationInfo();
        }

        // åº”ç”¨ç­›é€‰æ¡ä»¶åˆ°è®°å½•
        function applyFilterToRecords(records) {
            let filtered = [...records];
            
            // æ—¥æœŸç­›é€‰
            if (currentFilter.startDate) {
                filtered = filtered.filter(record => record.date >= currentFilter.startDate);
            }
            
            if (currentFilter.endDate) {
                filtered = filtered.filter(record => record.date <= currentFilter.endDate);
            }
            
            // é¡¹ç›®ç­›é€‰
            if (currentFilter.projects.length > 0) {
                filtered = filtered.filter(record => currentFilter.projects.includes(record.projectId));
            }
            
            return filtered;
        }

        // æ›´æ–°æœç´¢ç»“æœä¿¡æ¯
        function updateSearchResultsInfo(count) {
            let infoText = `æ˜¾ç¤º <span class="record-count">${count}</span> æ¡è®°å½•`;
            
            if (currentFilter.startDate || currentFilter.endDate || currentFilter.projects.length > 0) {
                infoText += "ï¼ˆå·²åº”ç”¨ç­›é€‰æ¡ä»¶ï¼‰";
            } else {
                infoText += "ï¼ˆå…¨éƒ¨è®°å½•ï¼‰";
            }
            
            searchResultsInfo.innerHTML = infoText;
        }

        // åˆ é™¤è®°å½•
        function deleteRecord(recordId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                records = records.filter(record => record.id !== recordId);
                saveData();
                updateRecordsTable();
                updateTotalAmount();
                
                // æ›´æ–°åˆ†æå›¾è¡¨ï¼ˆå¦‚æœå½“å‰åœ¨åˆ†æé¡µé¢ï¼‰
                if (currentMobileTab === 'analysis') {
                    updateAnalysisCharts();
                }
                
                showNotification('è®°å½•å·²åˆ é™¤ï¼', 'success');
            }
        }

        // æ›´æ–°æ€»é‡‘é¢
        function updateTotalAmount() {
            const total = records.reduce((sum, record) => sum + record.amount, 0);
            totalAmountElement.textContent = `Â¥${total.toFixed(2)}`;
            
            // æ ¹æ®æ€»é‡‘é¢è®¾ç½®é¢œè‰²
            if (total >= 0) {
                totalAmountElement.style.color = '#2E8B57';
            } else {
                totalAmountElement.style.color = '#FF6B6B';
            }
        }

        // é‡ç½®è¡¨å•
        function resetForm() {
            accountForm.reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            // è®¾ç½®é»˜è®¤ç±»å‹ä¸ºæ”¯å‡º
            document.getElementById('type').value = 'expense';
            updateProjectSelect();
            // è®¾ç½®é»˜è®¤é¡¹ç›®ä¸ºåƒé¥­ï¼ˆidä¸º4ï¼‰
            document.getElementById('project').value = 4;
            
            // è®¾ç½®ç„¦ç‚¹åˆ°æ—¥æœŸè¾“å…¥æ¡†
            document.getElementById('date').focus();
        }

        // æ‰“å¼€é¡¹ç›®æ¨¡æ€æ¡†
        function openProjectModal() {
            editingProjectId = null;
            document.getElementById('projectName').value = '';
            document.getElementById('projectType').value = 'expense'; // é»˜è®¤é¡¹ç›®ç±»å‹ä¸ºæ”¯å‡º
            projectModal.style.display = 'flex';
            
            // è®¾ç½®ç„¦ç‚¹åˆ°é¡¹ç›®åç§°è¾“å…¥æ¡†
            setTimeout(() => {
                document.getElementById('projectName').focus();
            }, 100);
        }

        // å…³é—­é¡¹ç›®æ¨¡æ€æ¡†
        function closeProjectModal() {
            projectModal.style.display = 'none';
        }

        // ç¼–è¾‘é¡¹ç›®
        function editProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (project) {
                editingProjectId = projectId;
                document.getElementById('projectName').value = project.name;
                document.getElementById('projectType').value = project.type;
                projectModal.style.display = 'flex';
                
                // è®¾ç½®ç„¦ç‚¹åˆ°é¡¹ç›®åç§°è¾“å…¥æ¡†
                setTimeout(() => {
                    document.getElementById('projectName').focus();
                }, 100);
            }
        }

        // ä¿å­˜é¡¹ç›®
        function saveProject(e) {
            e.preventDefault();
            
            const name = document.getElementById('projectName').value.trim();
            const type = document.getElementById('projectType').value;
            
            if (!name) {
                showNotification('è¯·è¾“å…¥é¡¹ç›®åç§°', 'danger');
                return;
            }
            
            // æ£€æŸ¥é¡¹ç›®åç§°æ˜¯å¦å·²å­˜åœ¨ï¼ˆæ’é™¤å½“å‰ç¼–è¾‘çš„é¡¹ç›®ï¼‰
            const existingProject = projects.find(p => 
                p.name.toLowerCase() === name.toLowerCase() && 
                p.id !== editingProjectId
            );
            
            if (existingProject) {
                showNotification('é¡¹ç›®åç§°å·²å­˜åœ¨', 'danger');
                return;
            }
            
            if (editingProjectId) {
                // æ›´æ–°ç°æœ‰é¡¹ç›®
                const projectIndex = projects.findIndex(p => p.id === editingProjectId);
                if (projectIndex !== -1) {
                    projects[projectIndex].name = name;
                    projects[projectIndex].type = type;
                }
                showNotification('é¡¹ç›®å·²æ›´æ–°ï¼', 'success');
            } else {
                // æ·»åŠ æ–°é¡¹ç›®
                const newId = projects.length > 0 ? Math.max(...projects.map(p => p.id)) + 1 : 1;
                projects.push({
                    id: newId,
                    name,
                    type,
                    emoji: type === 'income' ? 'ğŸ’°' : 'ğŸ’¸'
                });
                showNotification('é¡¹ç›®å·²æ·»åŠ ï¼', 'success');
            }
            
            saveData();
            updateProjectSelect();
            updateProjectList();
            updateMultiselectOptions();
            updateAnalysisProjectSelects();
            closeProjectModal();
        }

        // åˆ é™¤é¡¹ç›®
        function deleteProject(projectId) {
            // æ£€æŸ¥æ˜¯å¦æœ‰è®°å½•ä½¿ç”¨æ­¤é¡¹ç›®
            const recordsUsingProject = records.filter(record => record.projectId === projectId);
            
            if (recordsUsingProject.length > 0) {
                showNotification('æ— æ³•åˆ é™¤è¯¥é¡¹ç›®ï¼Œå› ä¸ºæœ‰è®°å½•æ­£åœ¨ä½¿ç”¨å®ƒã€‚è¯·å…ˆåˆ é™¤ç›¸å…³è®°å½•ã€‚', 'danger');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¡¹ç›®å—ï¼Ÿ')) {
                projects = projects.filter(project => project.id !== projectId);
                saveData();
                updateProjectSelect();
                updateProjectList();
                updateMultiselectOptions();
                updateAnalysisProjectSelects();
                showNotification('é¡¹ç›®å·²åˆ é™¤ï¼', 'success');
            }
        }

        // åº”ç”¨ç­›é€‰æ¡ä»¶
        function applyFilter() {
            currentFilter.startDate = startDateInput.value;
            currentFilter.endDate = endDateInput.value;
            
            // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
            currentPage = 1;
            
            updateRecordsTable();
        }

        // é‡ç½®ç­›é€‰æ¡ä»¶
        function resetFilter() {
            startDateInput.value = '';
            endDateInput.value = '';
            currentFilter = {
                startDate: null,
                endDate: null,
                projects: []
            };
            
            // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
            currentPage = 1;
            
            updateMultiselectOptions();
            updateRecordsTable();
        }

        // å¯¼å‡ºæ•°æ®ä¸ºXLSXæ ¼å¼
        function exportData() {
            if (records.length === 0) {
                showNotification('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º', 'danger');
                return;
            }
            
            // åº”ç”¨ç­›é€‰æ¡ä»¶
            let dataToExport = applyFilterToRecords(records);
            
            // å‡†å¤‡å¯¼å‡ºæ•°æ®
            const exportData = [
                ['æ—¥æœŸ', 'ç±»å‹', 'é¡¹ç›®', 'é‡‘é¢', 'å¤‡æ³¨']
            ];
            
            dataToExport.forEach(record => {
                const typeText = record.type === 'income' ? 'æ”¶å…¥' : 'æ”¯å‡º';
                const amountText = record.type === 'income' ? 
                    `+${record.amount.toFixed(2)}` : 
                    `-${Math.abs(record.amount).toFixed(2)}`;
                
                exportData.push([
                    record.date,
                    typeText,
                    record.projectName,
                    amountText,
                    record.note || ''
                ]);
            });
            
            // åˆ›å»ºå·¥ä½œç°¿
            const ws = XLSX.utils.aoa_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "è´¦æœ¬è®°å½•");
            
            // ç”Ÿæˆæ–‡ä»¶å
            const today = new Date().toISOString().split('T')[0];
            const fileName = `è´¦æœ¬è®°å½•_${today}.xlsx`;
            
            // å¯¼å‡ºæ–‡ä»¶
            XLSX.writeFile(wb, fileName);
            
            showNotification('æ•°æ®å¯¼å‡ºæˆåŠŸï¼', 'success');
        }

        // æ¸…ç©ºè®°å½•
        function clearRecords() {
            if (records.length === 0) {
                showNotification('æ²¡æœ‰è®°å½•å¯æ¸…ç©º', 'danger');
                return;
            }
            
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                records = [];
                saveData();
                updateRecordsTable();
                updateTotalAmount();
                
                // æ›´æ–°åˆ†æå›¾è¡¨ï¼ˆå¦‚æœå½“å‰åœ¨åˆ†æé¡µé¢ï¼‰
                if (currentMobileTab === 'analysis') {
                    updateAnalysisCharts();
                }
                
                showNotification('æ‰€æœ‰è®°å½•å·²æ¸…ç©ºï¼', 'success');
            }
        }

        // åˆ†é¡µç›¸å…³å‡½æ•°
        function changePageSize() {
            pageSize = parseInt(pageSizeSelect.value);
            currentPage = 1;
            updateRecordsTable();
        }
        
        function changePage(page) {
            currentPage = page;
            updateRecordsTable();
        }
        
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                updateRecordsTable();
            }
        }
        
        function goToNextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                updateRecordsTable();
            }
        }
        
        function goToLastPage() {
            currentPage = totalPages;
            updateRecordsTable();
        }
        
        function updatePaginationInfo() {
            const filteredRecords = applyFilterToRecords(records);
            const totalRecords = filteredRecords.length;
            const startRecord = (currentPage - 1) * pageSize + 1;
            const endRecord = Math.min(currentPage * pageSize, totalRecords);
            
            paginationInfo.innerHTML = `ç¬¬ ${currentPage} é¡µï¼Œå…± ${totalPages} é¡µï¼Œæ¯é¡µ ${pageSize} æ¡è®°å½•`;
            currentPageIndicator.textContent = currentPage;
            
            // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€
            firstPageBtn.disabled = currentPage === 1;
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
            lastPageBtn.disabled = currentPage === totalPages || totalPages === 0;
        }

        // å¯¼å…¥ç›¸å…³å‡½æ•°
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    // éªŒè¯æ•°æ®æ ¼å¼
                    if (jsonData.length < 2 || jsonData[0].join(',') !== 'æ—¥æœŸ,ç±»å‹,é¡¹ç›®,é‡‘é¢,å¤‡æ³¨') {
                        showNotification('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä½¿ç”¨ä¸‹è½½çš„æ¨¡æ¿æ–‡ä»¶ï¼', 'danger');
                        return;
                    }
                    
                    // è§£ææ•°æ®
                    importData = [];
                    let hasError = false;
                    
                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row.length < 4) continue;
                        
                        const date = row[0];
                        const type = row[1];
                        const projectName = row[2];
                        const amount = parseFloat(row[3]);
                        const note = row[4] || '';
                        
                        // éªŒè¯æ•°æ®
                        if (!date || !type || !projectName || isNaN(amount)) {
                            showNotification(`ç¬¬ ${i+1} è¡Œæ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œè·³è¿‡è¯¥è¡Œ`, 'danger');
                            hasError = true;
                            continue;
                        }
                        
                        // éªŒè¯ç±»å‹
                        if (type !== 'æ”¶å…¥' && type !== 'æ”¯å‡º') {
                            showNotification(`ç¬¬ ${i+1} è¡Œç±»å‹ä¸æ­£ç¡®ï¼Œåº”ä¸º"æ”¶å…¥"æˆ–"æ”¯å‡º"ï¼Œè·³è¿‡è¯¥è¡Œ`, 'danger');
                            hasError = true;
                            continue;
                        }
                        
                        // æŸ¥æ‰¾é¡¹ç›®
                        const project = projects.find(p => p.name === projectName);
                        if (!project) {
                            showNotification(`ç¬¬ ${i+1} è¡Œé¡¹ç›®"${projectName}"ä¸å­˜åœ¨ï¼Œè·³è¿‡è¯¥è¡Œ`, 'danger');
                            hasError = true;
                            continue;
                        }
                        
                        // éªŒè¯é¡¹ç›®ç±»å‹æ˜¯å¦åŒ¹é…
                        if ((type === 'æ”¶å…¥' && project.type !== 'income') || 
                            (type === 'æ”¯å‡º' && project.type !== 'expense')) {
                            showNotification(`ç¬¬ ${i+1} è¡Œé¡¹ç›®"${projectName}"ç±»å‹ä¸åŒ¹é…ï¼Œè·³è¿‡è¯¥è¡Œ`, 'danger');
                            hasError = true;
                            continue;
                        }
                        
                        // æ·»åŠ åˆ°å¯¼å…¥æ•°æ®
                        importData.push({
                            id: Date.now() + i,
                            date,
                            type: type === 'æ”¶å…¥' ? 'income' : 'expense',
                            projectId: project.id,
                            projectName,
                            projectEmoji: project.emoji,
                            amount: type === 'æ”¶å…¥' ? amount : -amount,
                            note
                        });
                    }
                    
                    if (importData.length > 0) {
                        // æ˜¾ç¤ºé¢„è§ˆ
                        showImportPreview();
                        importBtn.disabled = false;
                        
                        if (hasError) {
                            showNotification('éƒ¨åˆ†æ•°æ®å¯¼å…¥å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æç¤ºä¿¡æ¯', 'danger');
                        } else {
                            showNotification(`æˆåŠŸè§£æ ${importData.length} æ¡è®°å½•ï¼Œç‚¹å‡»"å¯¼å…¥æ•°æ®"æŒ‰é’®å®Œæˆå¯¼å…¥`, 'success');
                        }
                    } else {
                        showNotification('æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„è®°å½•æ•°æ®', 'danger');
                        importBtn.disabled = true;
                        importPreview.style.display = 'none';
                    }
                } catch (error) {
                    console.error('å¯¼å…¥é”™è¯¯:', error);
                    showNotification('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼', 'danger');
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        function showImportPreview() {
            importPreviewBody.innerHTML = '';
            
            // åªæ˜¾ç¤ºå‰5æ¡è®°å½•ä½œä¸ºé¢„è§ˆ
            const previewData = importData.slice(0, 5);
            
            previewData.forEach(record => {
                const row = importPreviewBody.insertRow();
                
                // æ—¥æœŸ
                const dateCell = row.insertCell(0);
                dateCell.textContent = record.date;
                
                // ç±»å‹
                const typeCell = row.insertCell(1);
                typeCell.textContent = record.type === 'income' ? 'æ”¶å…¥' : 'æ”¯å‡º';
                typeCell.className = record.type === 'income' ? 'income' : 'expense';
                
                // é¡¹ç›®
                const projectCell = row.insertCell(2);
                projectCell.innerHTML = `<span class="emoji">${record.projectEmoji || 'ğŸ“'}</span> ${record.projectName}`;
                
                // é‡‘é¢
                const amountCell = row.insertCell(3);
                amountCell.textContent = `Â¥${Math.abs(record.amount).toFixed(2)}`;
                amountCell.className = record.type === 'income' ? 'income' : 'expense';
                
                // å¤‡æ³¨
                const noteCell = row.insertCell(4);
                noteCell.textContent = record.note || '-';
            });
            
            if (importData.length > 5) {
                const infoRow = importPreviewBody.insertRow();
                const infoCell = infoRow.insertCell(0);
                infoCell.colSpan = 5;
                infoCell.textContent = `... è¿˜æœ‰ ${importData.length - 5} æ¡è®°å½•`;
                infoCell.style.textAlign = 'center';
                infoCell.style.fontStyle = 'italic';
                infoCell.style.color = '#999';
            }
            
            importPreview.style.display = 'block';
        }
        
        function importRecords() {
            if (importData.length === 0) {
                showNotification('æ²¡æœ‰å¯å¯¼å…¥çš„æ•°æ®', 'danger');
                return;
            }
            
            // å°†å¯¼å…¥æ•°æ®æ·»åŠ åˆ°è®°å½•ä¸­
            records = [...importData, ...records];
            saveData();
            
            // æ›´æ–°UI
            updateRecordsTable();
            updateTotalAmount();
            
            // æ›´æ–°åˆ†æå›¾è¡¨ï¼ˆå¦‚æœå½“å‰åœ¨åˆ†æé¡µé¢ï¼‰
            if (currentMobileTab === 'analysis') {
                updateAnalysisCharts();
            }
            
            // é‡ç½®å¯¼å…¥çŠ¶æ€
            importFileInput.value = '';
            importBtn.disabled = true;
            importPreview.style.display = 'none';
            importData = [];
            
            showNotification(`æˆåŠŸå¯¼å…¥è®°å½•ï¼`, 'success');
        }
        
        function downloadTemplate() {
            // åˆ›å»ºæ¨¡æ¿æ•°æ®
            const templateData = [
                ['æ—¥æœŸ', 'ç±»å‹', 'é¡¹ç›®', 'é‡‘é¢', 'å¤‡æ³¨'],
                ['2023-01-01', 'æ”¶å…¥', 'å·¥èµ„', '5000', 'ä¸€æœˆå·¥èµ„'],
                ['2023-01-02', 'æ”¯å‡º', 'åƒé¥­', '50', 'åˆé¤'],
                ['2023-01-03', 'æ”¯å‡º', 'è¡£æœ', '200', 'æ–°è¡£æœ'],
                ['2023-01-04', 'æ”¶å…¥', 'å…¶ä»–', '100', 'çº¢åŒ…'],
                ['2023-01-05', 'æ”¯å‡º', 'æ—¥ç”¨å“', '80', 'æ´—å‘æ°´']
            ];
            
            // åˆ›å»ºå·¥ä½œç°¿
            const ws = XLSX.utils.aoa_to_sheet(templateData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "è´¦æœ¬è®°å½•æ¨¡æ¿");
            
            // è®¾ç½®åˆ—å®½
            const colWidths = [
                { wch: 12 }, // æ—¥æœŸ
                { wch: 8 },  // ç±»å‹
                { wch: 12 }, // é¡¹ç›®
                { wch: 10 }, // é‡‘é¢
                { wch: 20 }  // å¤‡æ³¨
            ];
            ws['!cols'] = colWidths;
            
            // å¯¼å‡ºæ–‡ä»¶
            XLSX.writeFile(wb, "è´¦æœ¬è®°å½•æ¨¡æ¿.xlsx");
            
            showNotification('æ¨¡æ¿ä¸‹è½½æˆåŠŸï¼', 'success');
        }

        // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°åˆå§‹åŒ–ç§»åŠ¨ç«¯è§†å›¾
        window.addEventListener('resize', initMobileView);
    </script>
</body>
</html>