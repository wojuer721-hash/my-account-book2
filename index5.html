<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="‰∏™‰∫∫ËÆ∞Ë¥¶Êú¨Á≥ªÁªüÔºåÊîØÊåÅÊî∂ÊîØËÆ∞ÂΩï„ÄÅÈ°πÁõÆÁÆ°ÁêÜÂíåÊï∞ÊçÆÂàÜÊûê">
    <meta name="keywords" content="ËÆ∞Ë¥¶,Ë¥¢Âä°ÁÆ°ÁêÜ,Êî∂ÊîØËÆ∞ÂΩï,Êï∞ÊçÆÂàÜÊûê">
    <title>ËÆ∞Ë¥¶Êú¨ - ‰∏™‰∫∫Ë¥¢Âä°ÁÆ°ÁêÜ</title>
    <!-- ÂºïÂÖ•SheetJSÂ∫ìÁî®‰∫éÂØºÂá∫XLSX -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <!-- ÂºïÂÖ•Chart.jsÁî®‰∫éÂõæË°®ÁªòÂà∂ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary: #FF8DC7;
            --secondary: #A3D8FF;
            --accent: #FFD59E;
            --light: #FFF5E4;
            --text: #5A5A5A;
            --success: #A8E6CF;
            --danger: #FFAAA5;
            --warning: #FFD166;
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 6px 16px rgba(0, 0, 0, 0.12);
            --radius: 16px;
            --touch-size: 44px;
        }
        
        body {
            background: linear-gradient(135deg, #FFD6E7 0%, #C1E3FF 100%);
            color: var(--text);
            line-height: 1.5;
            padding: 12px;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px 15px;
            border-radius: var(--radius);
            background: var(--card-bg);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        h1 i {
            color: var(--accent);
            font-size: 1.6rem;
        }
        
        .summary-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 2px dashed var(--secondary);
            backdrop-filter: blur(10px);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        .summary-card h2 {
            font-size: 1rem;
            margin-bottom: 8px;
            opacity: 0.9;
            color: var(--primary);
        }
        
        .summary-card .amount {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-section, .records-section, .analysis-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            transition: transform 0.3s;
        }
        
        .form-section:hover, .records-section:hover, .analysis-section:hover {
            transform: translateY(-2px);
        }
        
        .form-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--secondary);
        }
        
        .records-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--accent);
        }
        
        .analysis-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: #A8E6CF;
        }
        
        .section-title {
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 16px;
            padding-bottom: 10px;
            border-bottom: 2px dotted var(--secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title i {
            color: var(--accent);
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.95rem;
        }
        
        label i {
            color: var(--primary);
            width: 18px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #E8E8E8;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
            -webkit-appearance: none;
            appearance: none;
            min-height: var(--touch-size);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 141, 199, 0.2);
        }
        
        .btn {
            padding: 14px 16px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: var(--touch-size);
            touch-action: manipulation;
            user-select: none;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        .btn:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #FF6BAE);
            color: white;
            box-shadow: 0 3px 8px rgba(255, 107, 174, 0.3);
        }
        
        .btn-primary:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 1px 4px rgba(255, 107, 174, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #7ED9A3);
            color: white;
            box-shadow: 0 3px 8px rgba(168, 230, 207, 0.3);
        }
        
        .btn-success:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 1px 4px rgba(168, 230, 207, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #FF8A80);
            color: white;
            box-shadow: 0 3px 8px rgba(255, 170, 165, 0.3);
        }
        
        .btn-danger:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 1px 4px rgba(255, 170, 165, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #FFC145);
            color: var(--text);
            box-shadow: 0 3px 8px rgba(255, 209, 102, 0.3);
        }
        
        .btn-warning:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 1px 4px rgba(255, 209, 102, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #E8E8E8, #D0D0D0);
            color: var(--text);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
        }
        
        .btn-secondary:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }
        
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .buttons .btn {
            width: 100%;
        }
        
        .btn-group {
            display: flex;
            gap: 5px;
        }
        
        .btn-group .btn {
            flex: 1;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
            font-size: 0.9rem;
            min-width: 600px;
        }
        
        th, td {
            padding: 12px 10px;
            text-align: left;
            border-bottom: 1px solid #F0F0F0;
        }
        
        th {
            background-color: rgba(163, 216, 255, 0.2);
            font-weight: 600;
            color: var(--primary);
            font-size: 0.9rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        tr {
            transition: background-color 0.2s;
        }
        
        tr:hover {
            background-color: rgba(255, 213, 158, 0.1);
        }
        
        tr.selected {
            background-color: rgba(163, 216, 255, 0.3) !important;
        }
        
        tr.dragging {
            opacity: 0.5;
            background-color: var(--accent);
        }
        
        tr.drag-over {
            border-top: 2px solid var(--primary);
        }
        
        .income {
            color: #2E8B57;
            font-weight: 500;
        }
        
        .expense {
            color: #FF6B6B;
            font-weight: 500;
        }
        
        .actions {
            display: flex;
            gap: 5px;
        }
        
        .actions .btn {
            padding: 8px 10px;
            font-size: 0.85rem;
            border-radius: 8px;
            min-height: 36px;
        }
        
        .project-management {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dotted var(--secondary);
        }
        
        .project-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        
        .project-item {
            background: white;
            border-radius: 12px;
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #F0F0F0;
            flex: 1 0 calc(50% - 8px);
            max-width: calc(50% - 8px);
            transition: transform 0.2s;
        }
        
        .project-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .project-item.income {
            border-left: 4px solid var(--success);
        }
        
        .project-item.expense {
            border-left: 4px solid var(--danger);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            padding: 15px;
        }
        
        .modal-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            position: relative;
            border: 2px solid var(--primary);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .modal-title {
            font-size: 1.2rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .close {
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text);
            transition: all 0.3s;
            padding: 5px;
            min-width: 36px;
            min-height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close:active {
            color: var(--primary);
            transform: scale(0.95);
        }
        
        .search-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            border: 2px dashed var(--accent);
        }
        
        .search-row {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .search-group {
            width: 100%;
        }
        
        .search-results-info {
            margin-top: 10px;
            font-size: 0.85rem;
            color: var(--text);
            padding: 10px;
            background: rgba(255, 213, 158, 0.2);
            border-radius: 10px;
            text-align: center;
        }
        
        .record-count {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            margin: 0 3px;
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            
            .container {
                max-width: 1200px;
            }
            
            .content {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .form-section {
                flex: 1;
                min-width: 300px;
            }
            
            .records-section {
                flex: 2;
                min-width: 600px;
            }
            
            .analysis-section {
                flex: 100%;
                min-width: 300px;
            }
            
            .buttons {
                flex-direction: row;
            }
            
            .buttons .btn {
                width: auto;
            }
            
            .search-row {
                flex-direction: row;
            }
            
            .search-group {
                flex: 1;
                min-width: 200px;
            }
            
            .project-item {
                flex: 1 0 calc(33.333% - 8px);
                max-width: calc(33.333% - 8px);
            }
            
            table {
                min-width: auto;
                font-size: 1rem;
            }
        }
        
        .floating-elements {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }
        
        .floating-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.4rem;
            color: white;
            touch-action: manipulation;
        }
        
        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }
        
        .floating-btn:active {
            transform: scale(0.95);
        }
        
        .floating-btn.primary {
            background: var(--primary);
        }
        
        .floating-btn.success {
            background: var(--success);
        }
        
        .floating-btn.warning {
            background: var(--warning);
        }
        
        .empty-state {
            text-align: center;
            padding: 30px 15px;
            color: var(--text);
        }
        
        .empty-state i {
            font-size: 3rem;
            color: var(--secondary);
            margin-bottom: 16px;
        }
        
        .empty-state p {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }
        
        .type-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 6px;
        }
        
        .type-income {
            background: var(--success);
        }
        
        .type-expense {
            background: var(--danger);
        }
        
        .emoji {
            font-size: 1.1rem;
            margin-right: 4px;
        }
        
        /* ÂàÜÈ°µÊ†∑Âºè */
        .pagination {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 16px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }
        
        .pagination-info {
            font-size: 0.85rem;
            color: var(--text);
            text-align: center;
        }
        
        .pagination-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .pagination-btn {
            padding: 10px 14px;
            border: none;
            border-radius: 8px;
            background: var(--secondary);
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            min-height: 40px;
            min-width: 40px;
            touch-action: manipulation;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        .pagination-btn:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-size-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .page-size-selector select {
            width: auto;
            padding: 8px 12px;
            min-height: 40px;
        }
        
        /* Â§öÈÄâ‰∏ãÊãâÊ°ÜÊ†∑Âºè */
        .multiselect-container {
            position: relative;
        }
        
        .multiselect-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: white;
            border: 2px solid #E8E8E8;
            border-radius: 12px;
            margin-top: 5px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .multiselect-dropdown.active {
            display: block;
        }
        
        .multiselect-search {
            padding: 10px;
            border-bottom: 1px solid #E8E8E8;
        }
        
        .multiselect-search input {
            padding: 10px 12px;
            border-radius: 8px;
            min-height: 40px;
        }
        
        .multiselect-options {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .multiselect-option {
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
            min-height: 44px;
        }
        
        .multiselect-option:hover {
            background: rgba(163, 216, 255, 0.2);
        }
        
        .multiselect-option:active {
            background: rgba(255, 141, 199, 0.2);
        }
        
        .multiselect-option.selected {
            background: rgba(255, 141, 199, 0.2);
        }
        
        .multiselect-selected {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }
        
        .selected-tag {
            background: var(--primary);
            color: white;
            padding: 6px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
            max-width: 100%;
        }
        
        .selected-tag .remove {
            cursor: pointer;
            font-weight: bold;
            padding: 2px;
        }
        
        .multiselect-input {
            cursor: pointer;
            position: relative;
            padding: 14px 16px;
            border: 2px solid #E8E8E8;
            border-radius: 12px;
            background: white;
            min-height: var(--touch-size);
            display: flex;
            align-items: center;
        }
        
        .multiselect-input::after {
            content: "‚ñº";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text);
            pointer-events: none;
        }
        
        /* ÂØºÂÖ•ÂäüËÉΩÊ†∑Âºè */
        .import-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dotted var(--secondary);
        }
        
        .import-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        @media (min-width: 480px) {
            .import-actions {
                flex-direction: row;
            }
        }
        
        .import-preview {
            margin-top: 16px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #E8E8E8;
            border-radius: 12px;
            padding: 12px;
            background: white;
        }
        
        .import-preview table {
            margin-top: 0;
            font-size: 0.85rem;
        }
        
        .import-preview th, .import-preview td {
            padding: 8px 10px;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: block;
            width: 100%;
        }
        
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-label {
            display: block;
            padding: 14px 16px;
            border: 2px dashed var(--secondary);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(163, 216, 255, 0.1);
            min-height: var(--touch-size);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .file-input-label:hover {
            background: rgba(163, 216, 255, 0.2);
            border-color: var(--primary);
        }
        
        .file-input-label:active {
            background: rgba(163, 216, 255, 0.3);
        }
        
        .file-input-label i {
            color: var(--primary);
        }
        
        /* Ë°®Ê†ºÂÆπÂô®ÔºåÁî®‰∫éÂú®ÊâãÊú∫‰∏äÂÆûÁé∞Ê∞¥Âπ≥ÊªöÂä® */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 0 -20px;
            padding: 0 20px;
            width: calc(100% + 40px);
        }
        
        /* ÁßªÂä®Á´ØËèúÂçïÂàáÊç¢ */
        .mobile-tabs {
            display: none;
        }
        
        @media (max-width: 767px) {
            .mobile-tabs {
                display: flex;
                background: var(--card-bg);
                border-radius: var(--radius);
                margin-bottom: 16px;
                overflow: hidden;
                box-shadow: var(--shadow);
            }
            
            .mobile-tab {
                flex: 1;
                padding: 14px 10px;
                text-align: center;
                font-weight: 500;
                color: var(--text);
                cursor: pointer;
                transition: all 0.3s;
                border-bottom: 3px solid transparent;
                position: relative;
                -webkit-tap-highlight-color: transparent;
                user-select: none;
            }
            
            .mobile-tab.active {
                color: var(--primary);
                border-bottom-color: var(--primary);
                background: rgba(255, 141, 199, 0.1);
            }
            
            .mobile-tab.active::after {
                content: '';
                position: absolute;
                bottom: -3px;
                left: 50%;
                transform: translateX(-50%);
                width: 0;
                height: 0;
                border-left: 8px solid transparent;
                border-right: 8px solid transparent;
                border-top: 8px solid var(--primary);
            }
            
            .mobile-tab.touching {
                background: rgba(255, 141, 199, 0.15) !important;
                transition: none !important;
            }
            
            .mobile-tab.clicked {
                background: rgba(255, 141, 199, 0.2) !important;
                transform: scale(0.98);
            }
            
            .form-section, .records-section, .analysis-section {
                display: none;
            }
            
            .form-section.active, .records-section.active, .analysis-section.active {
                display: block;
            }
            
            /* ÈöêËóèÊ°åÈù¢ÁâàÊµÆÂä®ÊåâÈíÆ */
            .floating-elements {
                display: none;
            }
        }
        
        /* ËæìÂÖ•Ê°ÜÂç†‰ΩçÁ¨¶Ê†∑Âºè */
        ::placeholder {
            color: #aaa;
            opacity: 1;
        }
        
        /* Ëá™ÂÆö‰πâÈÄâÊã©Ê°ÜÁÆ≠Â§¥ */
        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%235A5A5A' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
            padding-right: 40px;
        }
        
        /* Ëá™ÂÆö‰πâÊªöÂä®Êù° */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 141, 199, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 141, 199, 0.7);
        }
        
        /* Êó•ÊúüÈÄâÊã©Âô®Ê†∑Âºè */
        input[type="date"]::-webkit-calendar-picker-indicator {
            padding: 5px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        /* Âø´ÈÄüÊìç‰ΩúËèúÂçï */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 16px;
            flex-wrap: wrap;
        }
        
        .quick-action-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 10px;
            background: white;
            border: 1px solid #E8E8E8;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        .quick-action-btn:hover {
            background: rgba(255, 141, 199, 0.1);
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .quick-action-btn:active {
            background: rgba(255, 141, 199, 0.2);
            transform: translateY(0);
        }
        
        .quick-action-btn i {
            font-size: 1.4rem;
            color: var(--primary);
        }
        
        .quick-action-btn span {
            font-size: 0.9rem;
            color: var(--text);
        }
        
        /* ÂõæË°®ÂÆπÂô®Ê†∑Âºè */
        .chart-container {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid #F0F0F0;
            position: relative;
        }
        
        .chart-title {
            font-size: 1rem;
            color: var(--primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chart-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .chart-control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chart-control-group label {
            font-size: 0.9rem;
            margin-bottom: 0;
        }
        
        .chart-control-group select {
            padding: 8px 12px;
            min-height: 36px;
            width: auto;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .no-data-message {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-style: italic;
        }
        
        .chart-summary {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding: 10px;
            background: rgba(163, 216, 255, 0.1);
            border-radius: 10px;
            font-size: 0.9rem;
        }
        
        .chart-summary-item {
            text-align: center;
            flex: 1;
        }
        
        .chart-summary-value {
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        @media (min-width: 992px) {
            .analysis-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* ÁßªÂä®Á´ØÊó•ÊúüÈÄâÊã©Âô®‰ºòÂåñ */
        @media (max-width: 767px) {
            input[type="date"] {
                font-size: 16px;
            }
            
            .chart-controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .chart-control-group {
                width: 100%;
            }
            
            .chart-control-group select {
                width: 100%;
            }
            
            .chart-wrapper {
                height: 250px;
            }
        }
        
        /* ÈÄöÁü•Ê†∑Âºè */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: var(--text);
            padding: 12px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 90%;
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid var(--primary);
        }
        
        .notification.success {
            border-left-color: var(--success);
        }
        
        .notification.danger {
            border-left-color: var(--danger);
        }
        
        .notification.warning {
            border-left-color: var(--warning);
        }
        
        @keyframes slideIn {
            from {
                top: -100px;
                opacity: 0;
            }
            to {
                top: 20px;
                opacity: 1;
            }
        }
        
        /* ÁªüËÆ°ÁΩëÊ†ºÊ†∑Âºè */
        .statistics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            background: white;
            border-radius: var(--radius);
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid #F0F0F0;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--text);
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .stat-value {
            font-size: 1.4rem;
            font-weight: bold;
        }
        
        .stat-value.income {
            color: #2E8B57;
        }
        
        .stat-value.expense {
            color: #FF6B6B;
        }
        
        /* ÂØºÂá∫Ê†ºÂºèÈÄâÊã©Âô® */
        select.btn {
            padding-right: 40px;
            cursor: pointer;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        /* ÈîÆÁõòÂø´Êç∑ÈîÆÊèêÁ§∫ */
        .keyboard-shortcuts {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 100;
            display: none;
        }
        
        .keyboard-shortcuts.show {
            display: block;
        }
        
        .shortcut-key {
            background: var(--text);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
            margin: 0 2px;
        }
        
        @media (min-width: 768px) {
            .keyboard-shortcuts {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-piggy-bank"></i> ËÆ∞Ë¥¶Êú¨</h1>
            <p>ËΩªÊùæËÆ∞ÂΩïÊØè‰∏ÄÁ¨îÊî∂ÊîØÔºåËÆ©Ë¥¢Âä°ÁÆ°ÁêÜÂèòÂæóÁÆÄÂçïÂèàÊúâË∂£</p>
        </header>
        
        <div class="summary-card">
            <h2><i class="fas fa-wallet"></i> ÂΩìÂâç‰ΩôÈ¢ù</h2>
            <div class="amount" id="totalAmount">¬•0.00</div>
        </div>
        
        <!-- ÈîÆÁõòÂø´Êç∑ÈîÆÊèêÁ§∫ -->
        <div class="keyboard-shortcuts">
            <div style="background: var(--card-bg); padding: 10px; border-radius: var(--radius); box-shadow: var(--shadow); font-size: 0.8rem;">
                <strong>Âø´Êç∑ÈîÆÔºö</strong><br>
                <span class="shortcut-key">Ctrl+S</span> ‰øùÂ≠òËÆ∞ÂΩï<br>
                <span class="shortcut-key">Esc</span> ÈáçÁΩÆË°®Âçï<br>
                <span class="shortcut-key">Ctrl+F</span> ÊêúÁ¥¢ÁÑ¶ÁÇπ<br>
                <span class="shortcut-key">Ctrl+E</span> ÂØºÂá∫Êï∞ÊçÆ<br>
                <span class="shortcut-key">Del</span> Âà†Èô§ÈÄâ‰∏≠
            </div>
        </div>
        
        <!-- ÁßªÂä®Á´ØÊ†áÁ≠æÂàáÊç¢ -->
        <div class="mobile-tabs">
            <div class="mobile-tab active" data-tab="form"><i class="fas fa-plus-circle"></i> ËÆ∞Ë¥¶</div>
            <div class="mobile-tab" data-tab="records"><i class="fas fa-list-alt"></i> ËÆ∞ÂΩï</div>
            <div class="mobile-tab" data-tab="analysis"><i class="fas fa-chart-line"></i> ÂàÜÊûê</div>
            <div class="mobile-tab" data-tab="projects"><i class="fas fa-tags"></i> È°πÁõÆ</div>
        </div>
        
        <div class="content">
            <div class="form-section active" id="formTab">
                <h2 class="section-title"><i class="fas fa-plus-circle"></i> Ê∑ªÂä†Êñ∞ËÆ∞ÂΩï</h2>
                <form id="accountForm">
                    <div class="form-group">
                        <label for="date"><i class="fas fa-calendar-alt"></i> Êó•Êúü</label>
                        <input type="date" id="date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="type"><i class="fas fa-exchange-alt"></i> Á±ªÂûã</label>
                        <select id="type" required>
                            <option value="expense">ÊîØÂá∫ üí∏</option>
                            <option value="income">Êî∂ÂÖ• üí∞</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="project"><i class="fas fa-tags"></i> È°πÁõÆ</label>
                        <select id="project" required>
                            <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="amount"><i class="fas fa-coins"></i> ÈáëÈ¢ù</label>
                        <input type="number" id="amount" step="0.01" min="0" placeholder="ËØ∑ËæìÂÖ•ÈáëÈ¢ù" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="note"><i class="fas fa-sticky-note"></i> Â§áÊ≥®</label>
                        <textarea id="note" rows="3" placeholder="Ê∑ªÂä†Â§áÊ≥®ÔºàÂèØÈÄâÔºâ"></textarea>
                    </div>
                    
                    <div class="buttons">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Ê∑ªÂä†ËÆ∞ÂΩï</button>
                        <button type="button" class="btn btn-secondary" id="resetBtn"><i class="fas fa-redo"></i> ÈáçÁΩÆ</button>
                    </div>
                </form>
                
                <!-- Âø´ÈÄüÊìç‰Ωú -->
                <div class="quick-actions">
                    <div class="quick-action-btn" id="quickIncomeBtn">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Âø´ÈÄüÊî∂ÂÖ•</span>
                    </div>
                    <div class="quick-action-btn" id="quickExpenseBtn">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Âø´ÈÄüÊîØÂá∫</span>
                    </div>
                    <div class="quick-action-btn" id="quickFoodBtn">
                        <i class="fas fa-utensils"></i>
                        <span>È§êÈ•ÆÊ∂àË¥π</span>
                    </div>
                </div>
                
                <div class="import-section">
                    <h3 class="section-title"><i class="fas fa-file-import"></i> ÂØºÂÖ•ËÆ∞ÂΩï</h3>
                    <div class="file-input-wrapper">
                        <input type="file" id="importFile" accept=".xlsx, .xls, .csv">
                        <label for="importFile" class="file-input-label">
                            <i class="fas fa-upload"></i> ÈÄâÊã©Excel/CSVÊñá‰ª∂ÂØºÂÖ•
                        </label>
                    </div>
                    <div class="import-actions">
                        <button class="btn btn-success" id="downloadTemplateBtn"><i class="fas fa-download"></i> ‰∏ãËΩΩÊ®°Êùø</button>
                        <button class="btn btn-primary" id="importBtn" disabled><i class="fas fa-file-import"></i> ÂØºÂÖ•Êï∞ÊçÆ</button>
                    </div>
                    <div class="import-preview" id="importPreview" style="display: none;">
                        <h4>ÂØºÂÖ•È¢ÑËßà (Ââç5Êù°ËÆ∞ÂΩï)</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Êó•Êúü</th>
                                    <th>Á±ªÂûã</th>
                                    <th>È°πÁõÆ</th>
                                    <th>ÈáëÈ¢ù</th>
                                    <th>Â§áÊ≥®</th>
                                </tr>
                            </thead>
                            <tbody id="importPreviewBody">
                                <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="records-section" id="recordsTab">
                <h2 class="section-title"><i class="fas fa-list-alt"></i> Ë¥¶Êú¨ËÆ∞ÂΩï</h2>
                
                <div class="search-section">
                    <h3><i class="fas fa-search"></i> Êü•ËØ¢ËÆ∞ÂΩï</h3>
                    <div class="search-row">
                        <div class="search-group">
                            <label for="startDate"><i class="fas fa-calendar"></i> ÂºÄÂßãÊó•Êúü</label>
                            <input type="date" id="startDate">
                        </div>
                        <div class="search-group">
                            <label for="endDate"><i class="fas fa-calendar"></i> ÁªìÊùüÊó•Êúü</label>
                            <input type="date" id="endDate">
                        </div>
                        <div class="search-group">
                            <label for="searchProject"><i class="fas fa-filter"></i> È°πÁõÆÁ≠õÈÄâ</label>
                            <div class="multiselect-container">
                                <div class="multiselect-input" id="multiselectInput">
                                    ÈÄâÊã©È°πÁõÆ...
                                </div>
                                <div class="multiselect-dropdown" id="multiselectDropdown">
                                    <div class="multiselect-search">
                                        <input type="text" id="multiselectSearch" placeholder="ÊêúÁ¥¢È°πÁõÆ...">
                                    </div>
                                    <div class="multiselect-options" id="multiselectOptions">
                                        <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                                    </div>
                                </div>
                                <div class="multiselect-selected" id="multiselectSelected">
                                    <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="buttons">
                        <button class="btn btn-primary" id="searchBtn"><i class="fas fa-search"></i> Êü•ËØ¢</button>
                        <button class="btn btn-secondary" id="resetSearchBtn"><i class="fas fa-times"></i> ÈáçÁΩÆÊü•ËØ¢</button>
                    </div>
                    <div class="search-results-info" id="searchResultsInfo">
                        ÊòæÁ§∫ÂÖ®ÈÉ®ËÆ∞ÂΩï
                    </div>
                </div>
                
                <div class="buttons btn-group">
                    <select id="exportFormat" class="btn btn-success">
                        <option value="xlsx">XLSXÊ†ºÂºè</option>
                        <option value="csv">CSVÊ†ºÂºè</option>
                        <option value="json">JSONÊ†ºÂºè</option>
                    </select>
                    <button class="btn btn-success" id="exportBtn"><i class="fas fa-file-export"></i> ÂØºÂá∫Êï∞ÊçÆ</button>
                    <button class="btn btn-warning" id="statisticsBtn"><i class="fas fa-chart-bar"></i> ÁªüËÆ°</button>
                    <button class="btn btn-danger" id="batchDeleteBtn"><i class="fas fa-trash-alt"></i> ÊâπÈáèÂà†Èô§</button>
                    <button class="btn btn-danger" id="clearBtn"><i class="fas fa-trash"></i> Ê∏ÖÁ©∫ËÆ∞ÂΩï</button>
                </div>
                
                <div class="table-container">
                    <table id="recordsTable">
                        <thead>
                            <tr>
                                <th>Êó•Êúü</th>
                                <th>Á±ªÂûã</th>
                                <th>È°πÁõÆ</th>
                                <th>ÈáëÈ¢ù</th>
                                <th>Â§áÊ≥®</th>
                                <th>Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                        </tbody>
                    </table>
                </div>
                
                <!-- ÂàÜÈ°µÊéß‰ª∂ -->
                <div class="pagination">
                    <div class="pagination-info" id="paginationInfo">
                        Á¨¨ 1 È°µÔºåÂÖ± 1 È°µÔºåÊØèÈ°µ 10 Êù°ËÆ∞ÂΩï
                    </div>
                    <div class="pagination-controls">
                        <div class="page-size-selector">
                            <span>ÊØèÈ°µÊòæÁ§∫:</span>
                            <select id="pageSize">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                                <option value="200">200</option>
                            </select>
                        </div>
                        <button class="pagination-btn" id="firstPageBtn" disabled>È¶ñÈ°µ</button>
                        <button class="pagination-btn" id="prevPageBtn" disabled>‰∏ä‰∏ÄÈ°µ</button>
                        <span id="currentPageIndicator">1</span>
                        <button class="pagination-btn" id="nextPageBtn" disabled>‰∏ã‰∏ÄÈ°µ</button>
                        <button class="pagination-btn" id="lastPageBtn" disabled>Êú´È°µ</button>
                    </div>
                </div>
            </div>
            
            <!-- ÂàÜÊûêÈÉ®ÂàÜ -->
            <div class="analysis-section" id="analysisTab">
                <h2 class="section-title"><i class="fas fa-chart-line"></i> Êî∂ÊîØÂàÜÊûê</h2>
                
                <div class="search-section">
                    <h3><i class="fas fa-calendar-alt"></i> ÂàÜÊûêÊó∂Èó¥ËåÉÂõ¥</h3>
                    <div class="search-row">
                        <div class="search-group">
                            <label for="analysisStartDate"><i class="fas fa-calendar"></i> ÂºÄÂßãÊó•Êúü</label>
                            <input type="date" id="analysisStartDate">
                        </div>
                        <div class="search-group">
                            <label for="analysisEndDate"><i class="fas fa-calendar"></i> ÁªìÊùüÊó•Êúü</label>
                            <input type="date" id="analysisEndDate">
                        </div>
                    </div>
                    <div class="buttons">
                        <button class="btn btn-primary" id="updateAnalysisBtn"><i class="fas fa-sync-alt"></i> Êõ¥Êñ∞ÂàÜÊûê</button>
                        <button class="btn btn-secondary" id="resetAnalysisBtn"><i class="fas fa-times"></i> ÈáçÁΩÆÊó∂Èó¥</button>
                    </div>
                </div>
                
                <div class="analysis-grid">
                    <!-- ÊîØÂá∫ÂêÑÈ°πÁõÆÂç†ÊØîÂõæ -->
                    <div class="chart-container">
                        <div class="chart-title"><i class="fas fa-chart-pie"></i> ÊîØÂá∫È°πÁõÆÂç†ÊØî</div>
                        <div class="chart-controls">
                            <div class="chart-control-group">
                                <label>ÂàÜÁªÑÊñπÂºè:</label>
                                <select id="expenseGroupBy">
                                    <option value="project">ÊåâÈ°πÁõÆ</option>
                                    <option value="month">ÊåâÊúà</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="expensePieChart"></canvas>
                            <div class="no-data-message" id="noExpenseData" style="display: none;">ÊöÇÊó†ÊîØÂá∫Êï∞ÊçÆ</div>
                        </div>
                        <div class="chart-summary" id="expenseSummary" style="display: none;">
                            <div class="chart-summary-item">
                                <div>ÊÄªÊîØÂá∫</div>
                                <div class="chart-summary-value" id="totalExpenseAmount">¬•0.00</div>
                            </div>
                            <div class="chart-summary-item">
                                <div>È°πÁõÆÊï∞Èáè</div>
                                <div class="chart-summary-value" id="expenseProjectCount">0</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÊîØÂá∫Ë∂ãÂäøÂàÜÂ∏ÉÂõæ -->
                    <div class="chart-container">
                        <div class="chart-title"><i class="fas fa-chart-line"></i> ÊîØÂá∫Ë∂ãÂäø</div>
                        <div class="chart-controls">
                            <div class="chart-control-group">
                                <label>È°πÁõÆ:</label>
                                <select id="expenseTrendProject">
                                    <option value="all">ÂÖ®ÈÉ®È°πÁõÆ</option>
                                    <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                                </select>
                            </div>
                            <div class="chart-control-group">
                                <label>ÂàÜÁªÑ:</label>
                                <select id="expenseTrendGroup">
                                    <option value="day">ÊåâÊó•</option>
                                    <option value="week">ÊåâÂë®</option>
                                    <option value="month">ÊåâÊúà</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="expenseTrendChart"></canvas>
                            <div class="no-data-message" id="noExpenseTrendData" style="display: none;">ÊöÇÊó†ÊîØÂá∫Ë∂ãÂäøÊï∞ÊçÆ</div>
                        </div>
                        <div class="chart-summary" id="expenseTrendSummary" style="display: none;">
                            <div class="chart-summary-item">
                                <div>Âπ≥ÂùáÊîØÂá∫</div>
                                <div class="chart-summary-value" id="avgExpenseAmount">¬•0.00</div>
                            </div>
                            <div class="chart-summary-item">
                                <div>ÊúÄÂ§ßÊîØÂá∫</div>
                                <div class="chart-summary-value" id="maxExpenseAmount">¬•0.00</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Êî∂ÂÖ•Ë∂ãÂäøÂàÜÂ∏ÉÂõæ -->
                    <div class="chart-container">
                        <div class="chart-title"><i class="fas fa-chart-line"></i> Êî∂ÂÖ•Ë∂ãÂäø</div>
                        <div class="chart-controls">
                            <div class="chart-control-group">
                                <label>È°πÁõÆ:</label>
                                <select id="incomeTrendProject">
                                    <option value="all">ÂÖ®ÈÉ®È°πÁõÆ</option>
                                    <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                                </select>
                            </div>
                            <div class="chart-control-group">
                                <label>ÂàÜÁªÑ:</label>
                                <select id="incomeTrendGroup">
                                    <option value="day">ÊåâÊó•</option>
                                    <option value="week">ÊåâÂë®</option>
                                    <option value="month">ÊåâÊúà</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="incomeTrendChart"></canvas>
                            <div class="no-data-message" id="noIncomeTrendData" style="display: none;">ÊöÇÊó†Êî∂ÂÖ•Ë∂ãÂäøÊï∞ÊçÆ</div>
                        </div>
                        <div class="chart-summary" id="incomeTrendSummary" style="display: none;">
                            <div class="chart-summary-item">
                                <div>Âπ≥ÂùáÊî∂ÂÖ•</div>
                                <div class="chart-summary-value" id="avgIncomeAmount">¬•0.00</div>
                            </div>
                            <div class="chart-summary-item">
                                <div>ÊúÄÂ§ßÊî∂ÂÖ•</div>
                                <div class="chart-summary-value" id="maxIncomeAmount">¬•0.00</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Êî∂ÊîØÂØπÊØîË∂ãÂäøÂõæ -->
                    <div class="chart-container">
                        <div class="chart-title"><i class="fas fa-balance-scale"></i> Êî∂ÊîØÂØπÊØîË∂ãÂäø</div>
                        <div class="chart-controls">
                            <div class="chart-control-group">
                                <label>ÂàÜÁªÑ:</label>
                                <select id="balanceTrendGroup">
                                    <option value="day">ÊåâÊó•</option>
                                    <option value="week">ÊåâÂë®</option>
                                    <option value="month">ÊåâÊúà</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="balanceTrendChart"></canvas>
                            <div class="no-data-message" id="noBalanceTrendData" style="display: none;">ÊöÇÊó†Êî∂ÊîØÂØπÊØîÊï∞ÊçÆ</div>
                        </div>
                        <div class="chart-summary" id="balanceTrendSummary" style="display: none;">
                            <div class="chart-summary-item">
                                <div>ÊÄªÊî∂ÂÖ•</div>
                                <div class="chart-summary-value" id="totalIncomeAmount">¬•0.00</div>
                            </div>
                            <div class="chart-summary-item">
                                <div>ÊÄªÊîØÂá∫</div>
                                <div class="chart-summary-value" id="totalExpenseTrendAmount">¬•0.00</div>
                            </div>
                            <div class="chart-summary-item">
                                <div>ÂáÄÊî∂ÂÖ•</div>
                                <div class="chart-summary-value" id="netIncomeAmount">¬•0.00</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- È°πÁõÆÁÆ°ÁêÜÈÉ®ÂàÜÔºàÁßªÂä®Á´Ø‰∏ìÂ±ûÔºâ -->
            <div class="form-section" id="projectsTab">
                <h2 class="section-title"><i class="fas fa-tags"></i> È°πÁõÆÁÆ°ÁêÜ</h2>
                
                <div class="project-management">
                    <button class="btn btn-success" id="addProjectBtn"><i class="fas fa-plus"></i> Ê∑ªÂä†È°πÁõÆ</button>
                    
                    <div class="project-list" id="projectList">
                        <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
                    </div>
                </div>
                
                <div class="quick-actions">
                    <div class="quick-action-btn" id="addIncomeProjectBtn">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Ê∑ªÂä†Êî∂ÂÖ•È°πÁõÆ</span>
                    </div>
                    <div class="quick-action-btn" id="addExpenseProjectBtn">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Ê∑ªÂä†ÊîØÂá∫È°πÁõÆ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- È°πÁõÆÁºñËæëÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-edit"></i> Ê∑ªÂä†/ÁºñËæëÈ°πÁõÆ</h3>
                <span class="close">&times;</span>
            </div>
            <form id="projectForm">
                <div class="form-group">
                    <label for="projectName"><i class="fas fa-tag"></i> È°πÁõÆÂêçÁß∞</label>
                    <input type="text" id="projectName" required>
                </div>
                
                <div class="form-group">
                    <label for="projectType"><i class="fas fa-exchange-alt"></i> È°πÁõÆÁ±ªÂûã</label>
                    <select id="projectType" required>
                        <option value="expense">ÊîØÂá∫È°πÁõÆ üí∏</option>
                        <option value="income">Êî∂ÂÖ•È°πÁõÆ üí∞</option>
                    </select>
                </div>
                
                <div class="buttons">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> ‰øùÂ≠ò</button>
                    <button type="button" class="btn btn-secondary" id="cancelProjectBtn"><i class="fas fa-times"></i> ÂèñÊ∂à</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- ÁªüËÆ°Ê®°ÊÄÅÊ°Ü -->
    <div class="modal" id="statisticsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-chart-bar"></i> Êï∞ÊçÆÁªüËÆ°</h3>
                <span class="close">&times;</span>
            </div>
            <div class="statistics-grid" id="statisticsGrid">
                <!-- Âä®ÊÄÅÂ°´ÂÖÖ -->
            </div>
            <div class="buttons">
                <button class="btn btn-primary" id="closeStatsBtn">ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>

    <!-- ÊµÆÂä®ÊåâÈíÆÔºàÊ°åÈù¢Á´ØÔºâ -->
    <div class="floating-elements">
        <div class="floating-btn warning" id="showShortcutsBtn" title="ÊòæÁ§∫Âø´Êç∑ÈîÆ">
            <i class="fas fa-keyboard"></i>
        </div>
        <div class="floating-btn primary" id="quickAddBtn" title="Âø´ÈÄüÊ∑ªÂä†ËÆ∞ÂΩï">
            <i class="fas fa-plus"></i>
        </div>
        <div class="floating-btn success" id="quickExportBtn" title="Âø´ÈÄüÂØºÂá∫">
            <i class="fas fa-file-export"></i>
        </div>
    </div>

    <script>
        // ÂàùÂßãÂåñÈªòËÆ§È°πÁõÆÂíåË¥¶Êú¨Êï∞ÊçÆ
        let projects = [
            { id: 1, name: "Â∑•ËµÑ", type: "income", emoji: "üí∞" },
            { id: 2, name: "Âá∫Â∑Æ", type: "income", emoji: "üíº" },
            { id: 3, name: "Êú¨Èáë", type: "income", emoji: "üí∞" },
            { id: 4, name: "ÂêÉÈ•≠", type: "expense", emoji: "üçî" },
            { id: 5, name: "Êó•Áî®ÂìÅ", type: "expense", emoji: "üß¥" },
            { id: 6, name: "ÂåñÂ¶ÜÂìÅ", type: "expense", emoji: "üíÑ" },
            { id: 7, name: "Ë°£Êúç", type: "expense", emoji: "üëï" },
            { id: 8, name: "ÂÆ†Áâ©", type: "expense", emoji: "üê∂" },
            { id: 9, name: "ËØùË¥π", type: "expense", emoji: "üì±" },
            { id: 10, name: "MaMa", type: "expense", emoji: "üë©" },
            { id: 11, name: "ÈÄöÂã§", type: "expense", emoji: "üöá" },
            { id: 12, name: "ÊàøÁßü", type: "expense", emoji: "üè†" },
            { id: 13, name: "Ê∞¥Ë¥π", type: "expense", emoji: "üíß" },
            { id: 14, name: "ÁîµË¥π", type: "expense", emoji: "‚ö°" },
            { id: 15, name: "ÁáÉÊ∞îË¥π", type: "expense", emoji: "üî•" },
            { id: 16, name: "ÁîµÂä®ËΩ¶", type: "expense", emoji: "üõµ" },
            { id: 17, name: "ÊóÖÊ∏∏", type: "expense", emoji: "‚úàÔ∏è" },
            { id: 18, name: "ÁîµÂ≠êËù¥Ëù∂", type: "expense", emoji: "üéÆ" },
            { id: 19, name: "Â®±‰πê", type: "expense", emoji: "üé¨" },
            { id: 20, name: "ÂåªËçØ", type: "expense", emoji: "üíä" },
            { id: 21, name: "Á§ºÁâ©", type: "expense", emoji: "üéÅ" },
            { id: 22, name: "È•∞ÂìÅ", type: "expense", emoji: "üíé" },
            { id: 23, name: "ËÆæÂ§á", type: "expense", emoji: "üíª" }
        ];

        let records = [];
        let editingProjectId = null;
        let currentFilter = {
            startDate: null,
            endDate: null,
            projects: []
        };
        
        // ÂàÜÊûêÁõ∏ÂÖ≥ÂèòÈáè
        let analysisFilter = {
            startDate: null,
            endDate: null
        };
        
        // ÂõæË°®ÂÆû‰æã
        let expensePieChart = null;
        let expenseTrendChart = null;
        let incomeTrendChart = null;
        let balanceTrendChart = null;
        
        // ÂàÜÈ°µÁõ∏ÂÖ≥ÂèòÈáè
        let currentPage = 1;
        let pageSize = 10;
        let totalPages = 1;
        
        // ÂØºÂÖ•Áõ∏ÂÖ≥ÂèòÈáè
        let importData = [];
        
        // ÁßªÂä®Á´ØÂΩìÂâçÊ†áÁ≠æ
        let currentMobileTab = 'form';
        
        // Ëß¶Êë∏Áõ∏ÂÖ≥ÂèòÈáè - Áî®‰∫éÈò≤Ê≠¢ËØØËß¶
        let isMobileTabTouchActive = false;
        
        // ÊãñÊîæÁõ∏ÂÖ≥ÂèòÈáè
        let dragSource = null;

        // DOM ÂÖÉÁ¥†
        const accountForm = document.getElementById('accountForm');
        const projectForm = document.getElementById('projectForm');
        const projectSelect = document.getElementById('project');
        const projectList = document.getElementById('projectList');
        const recordsTable = document.getElementById('recordsTable').getElementsByTagName('tbody')[0];
        const totalAmountElement = document.getElementById('totalAmount');
        const projectModal = document.getElementById('projectModal');
        const statisticsModal = document.getElementById('statisticsModal');
        const addProjectBtn = document.getElementById('addProjectBtn');
        const exportBtn = document.getElementById('exportBtn');
        const exportFormatSelect = document.getElementById('exportFormat');
        const statisticsBtn = document.getElementById('statisticsBtn');
        const batchDeleteBtn = document.getElementById('batchDeleteBtn');
        const clearBtn = document.getElementById('clearBtn');
        const resetBtn = document.getElementById('resetBtn');
        const cancelProjectBtn = document.getElementById('cancelProjectBtn');
        const closeModalBtn = document.querySelector('.close');
        const searchBtn = document.getElementById('searchBtn');
        const resetSearchBtn = document.getElementById('resetSearchBtn');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const searchResultsInfo = document.getElementById('searchResultsInfo');
        const quickAddBtn = document.getElementById('quickAddBtn');
        const quickExportBtn = document.getElementById('quickExportBtn');
        const showShortcutsBtn = document.getElementById('showShortcutsBtn');
        
        // ÂàÜÈ°µÁõ∏ÂÖ≥DOMÂÖÉÁ¥†
        const pageSizeSelect = document.getElementById('pageSize');
        const firstPageBtn = document.getElementById('firstPageBtn');
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');
        const lastPageBtn = document.getElementById('lastPageBtn');
        const currentPageIndicator = document.getElementById('currentPageIndicator');
        const paginationInfo = document.getElementById('paginationInfo');
        
        // Â§öÈÄâ‰∏ãÊãâÊ°ÜÁõ∏ÂÖ≥DOMÂÖÉÁ¥†
        const multiselectInput = document.getElementById('multiselectInput');
        const multiselectDropdown = document.getElementById('multiselectDropdown');
        const multiselectSearch = document.getElementById('multiselectSearch');
        const multiselectOptions = document.getElementById('multiselectOptions');
        const multiselectSelected = document.getElementById('multiselectSelected');
        
        // ÂØºÂÖ•Áõ∏ÂÖ≥DOMÂÖÉÁ¥†
        const importFileInput = document.getElementById('importFile');
        const downloadTemplateBtn = document.getElementById('downloadTemplateBtn');
        const importBtn = document.getElementById('importBtn');
        const importPreview = document.getElementById('importPreview');
        const importPreviewBody = document.getElementById('importPreviewBody');
        
        // ÁßªÂä®Á´ØÁõ∏ÂÖ≥DOMÂÖÉÁ¥†
        const mobileTabs = document.querySelectorAll('.mobile-tab');
        const formTab = document.getElementById('formTab');
        const recordsTab = document.getElementById('recordsTab');
        const analysisTab = document.getElementById('analysisTab');
        const projectsTab = document.getElementById('projectsTab');
        
        // Âø´ÈÄüÊìç‰ΩúÊåâÈíÆ
        const quickIncomeBtn = document.getElementById('quickIncomeBtn');
        const quickExpenseBtn = document.getElementById('quickExpenseBtn');
        const quickFoodBtn = document.getElementById('quickFoodBtn');
        const addIncomeProjectBtn = document.getElementById('addIncomeProjectBtn');
        const addExpenseProjectBtn = document.getElementById('addExpenseProjectBtn');
        
        // ÂàÜÊûêÁõ∏ÂÖ≥DOMÂÖÉÁ¥†
        const analysisStartDateInput = document.getElementById('analysisStartDate');
        const analysisEndDateInput = document.getElementById('analysisEndDate');
        const updateAnalysisBtn = document.getElementById('updateAnalysisBtn');
        const resetAnalysisBtn = document.getElementById('resetAnalysisBtn');
        const expenseGroupBySelect = document.getElementById('expenseGroupBy');
        const expenseTrendProjectSelect = document.getElementById('expenseTrendProject');
        const expenseTrendGroupSelect = document.getElementById('expenseTrendGroup');
        const incomeTrendProjectSelect = document.getElementById('incomeTrendProject');
        const incomeTrendGroupSelect = document.getElementById('incomeTrendGroup');
        const balanceTrendGroupSelect = document.getElementById('balanceTrendGroup');
        
        // ÁªüËÆ°Áõ∏ÂÖ≥DOMÂÖÉÁ¥†
        const closeStatsBtn = document.getElementById('closeStatsBtn');
        const statisticsGrid = document.getElementById('statisticsGrid');

        // ==================== ËæÖÂä©ÂáΩÊï∞ ====================
        
        // ExcelÊó•ÊúüÊ†ºÂºèÂåñÂáΩÊï∞
        function formatExcelDate(excelDate) {
            if (!excelDate) return '';
            
            // Â¶ÇÊûúÊòØÊï∞Â≠óÔºàExcelÂ∫èÂàóÂè∑Ôºâ
            if (typeof excelDate === 'number') {
                // ExcelÁöÑÂü∫ÂáÜÊó•ÊúüÊòØ1900-01-00ÔºàÂÆûÈôÖ‰∏ä1899-12-31Ôºâ
                const excelEpoch = new Date(1899, 11, 31);
                const date = new Date(excelEpoch.getTime() + (excelDate - 1) * 24 * 60 * 60 * 1000);
                
                // ‰øÆÊ≠£ExcelÁöÑ1900Âπ¥Èó∞Âπ¥ÈîôËØØ
                if (excelDate > 59) {
                    date.setDate(date.getDate() - 1);
                }
                
                return formatDateToYYYYMMDD(date);
            }
            
            // Â¶ÇÊûúÊòØÂ≠óÁ¨¶‰∏≤
            if (typeof excelDate === 'string') {
                let dateStr = excelDate.trim();
                
                // ÁßªÈô§Êó∂Èó¥ÈÉ®ÂàÜ
                if (dateStr.includes(' ')) {
                    dateStr = dateStr.split(' ')[0];
                }
                
                // Â∞ùËØïËß£ÊûêÂ∏∏ËßÅÊ†ºÂºè
                const date = parseDateString(dateStr);
                if (date && !isNaN(date.getTime())) {
                    return formatDateToYYYYMMDD(date);
                }
            }
            
            // Â¶ÇÊûúÊòØDateÂØπË±°
            if (excelDate instanceof Date) {
                if (!isNaN(excelDate.getTime())) {
                    return formatDateToYYYYMMDD(excelDate);
                }
            }
            
            return '';
        }

        // Ëß£ÊûêÊó•ÊúüÂ≠óÁ¨¶‰∏≤
        function parseDateString(dateStr) {
            if (!dateStr) return null;
            
            // Â∞ùËØïYYYY-MM-DDÊ†ºÂºè
            let match = dateStr.match(/^(\d{4})[-/](\d{1,2})[-/](\d{1,2})$/);
            if (match) {
                const year = parseInt(match[1], 10);
                const month = parseInt(match[2], 10) - 1;
                const day = parseInt(match[3], 10);
                return new Date(year, month, day);
            }
            
            // Â∞ùËØïYYYYÂπ¥MMÊúàDDÊó•Ê†ºÂºè
            match = dateStr.match(/^(\d{4})Âπ¥(\d{1,2})Êúà(\d{1,2})Êó•$/);
            if (match) {
                const year = parseInt(match[1], 10);
                const month = parseInt(match[2], 10) - 1;
                const day = parseInt(match[3], 10);
                return new Date(year, month, day);
            }
            
            // Â∞ùËØïMM/DD/YYYYÊ†ºÂºè
            match = dateStr.match(/^(\d{1,2})[/-](\d{1,2})[/-](\d{4})$/);
            if (match) {
                const month = parseInt(match[1], 10) - 1;
                const day = parseInt(match[2], 10);
                const year = parseInt(match[3], 10);
                return new Date(year, month, day);
            }
            
            // Â∞ùËØïÁõ¥Êé•Ëß£Êûê
            const date = new Date(dateStr);
            if (!isNaN(date.getTime())) {
                return date;
            }
            
            return null;
        }

        // Ê†ºÂºèÂåñÊó•Êúü‰∏∫YYYY-MM-DD
        function formatDateToYYYYMMDD(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Ëß£ÊûêÁ±ªÂûã
        function parseType(typeStr) {
            if (!typeStr) return null;
            
            const str = typeStr.toString().trim().toLowerCase();
            
            if (str === 'Êî∂ÂÖ•' || str === 'income' || str === 'in') {
                return 'income';
            }
            
            if (str === 'ÊîØÂá∫' || str === 'expense' || str === 'out' || str === 'ÊîØÂá∫') {
                return 'expense';
            }
            
            return null;
        }

        // Ëß£ÊûêÈáëÈ¢ù
        function parseAmount(amountStr) {
            if (!amountStr) return NaN;
            
            // ÁßªÈô§Ë¥ßÂ∏ÅÁ¨¶Âè∑ÂíåÂçÉÂàÜ‰ΩçÂàÜÈöîÁ¨¶
            const cleaned = amountStr.toString()
                .replace(/[¬•$,Ôºå]/g, '')
                .replace(/ /g, '');
            
            return parseFloat(cleaned);
        }

        // Ëé∑ÂèñÈªòËÆ§emoji
        function getDefaultEmoji(projectName, type) {
            // Ê£ÄÊü•Â∏∏ËßÅÈ°πÁõÆ
            const commonProjects = {
                'ÂêÉÈ•≠': 'üçî',
                'È§êÈ•Æ': 'üçî',
                '‰∫§ÈÄö': 'üöá',
                'Ë¥≠Áâ©': 'üõçÔ∏è',
                'Â®±‰πê': 'üé¨',
                'Â∑•ËµÑ': 'üí∞',
                'Â•ñÈáë': 'üéÅ',
                'ÊàøÁßü': 'üè†',
                'Ê∞¥Áîµ': 'üíß'
            };
            
            for (const [key, emoji] of Object.entries(commonProjects)) {
                if (projectName.includes(key)) {
                    return emoji;
                }
            }
            
            // ÈªòËÆ§emoji
            return type === 'income' ? 'üí∞' : 'üí∏';
        }

        // ==================== ÂàùÂßãÂåñ ====================
        
        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ËÆæÁΩÆÈªòËÆ§Êó•Êúü‰∏∫‰ªäÂ§©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            
            // ËÆæÁΩÆÊü•ËØ¢Êó•ÊúüÈªòËÆ§ËåÉÂõ¥ÔºàÊúÄËøë30Â§©Ôºâ
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            startDateInput.value = thirtyDaysAgo.toISOString().split('T')[0];
            endDateInput.value = today;
            
            // ËÆæÁΩÆÂàÜÊûêÊó•ÊúüÈªòËÆ§ËåÉÂõ¥ÔºàÊúÄËøë90Â§©Ôºâ
            const ninetyDaysAgo = new Date();
            ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);
            analysisStartDateInput.value = ninetyDaysAgo.toISOString().split('T')[0];
            analysisEndDateInput.value = today;
            
            // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÊï∞ÊçÆ
            loadData();
            
            // ËÆæÁΩÆÈªòËÆ§Á±ªÂûã‰∏∫ÊîØÂá∫
            document.getElementById('type').value = 'expense';
            
            // Êõ¥Êñ∞È°πÁõÆÈÄâÊã©ÂàóË°®
            updateProjectSelect();
            
            // ËÆæÁΩÆÈªòËÆ§È°πÁõÆ‰∏∫ÂêÉÈ•≠Ôºàid‰∏∫4Ôºâ
            document.getElementById('project').value = 4;
            
            // Êõ¥Êñ∞È°πÁõÆÊòæÁ§∫ÂàóË°®
            updateProjectList();
            
            // Êõ¥Êñ∞Êü•ËØ¢È°πÁõÆÈÄâÊã©ÂàóË°®
            updateMultiselectOptions();
            
            // Êõ¥Êñ∞ËÆ∞ÂΩïË°®Ê†º
            updateRecordsTable();
            
            // Êõ¥Êñ∞ÊÄªÈáëÈ¢ù
            updateTotalAmount();
            
            // Êõ¥Êñ∞ÂàÜÈ°µ‰ø°ÊÅØ
            updatePaginationInfo();
            
            // Êõ¥Êñ∞ÂàÜÊûêÂõæË°®È°πÁõÆÈÄâÊã©
            updateAnalysisProjectSelects();
            
            // ÂàùÂßãÂåñÂàÜÊûêÂõæË°®
            initAnalysisCharts();
            
            // ‰∫ã‰ª∂ÁõëÂê¨Âô®
            accountForm.addEventListener('submit', addRecord);
            projectForm.addEventListener('submit', saveProject);
            addProjectBtn.addEventListener('click', openProjectModal);
            exportBtn.addEventListener('click', () => exportDataAs(exportFormatSelect.value));
            statisticsBtn.addEventListener('click', showStatistics);
            batchDeleteBtn.addEventListener('click', batchDeleteSelected);
            clearBtn.addEventListener('click', clearRecords);
            resetBtn.addEventListener('click', resetForm);
            cancelProjectBtn.addEventListener('click', closeProjectModal);
            closeModalBtn.addEventListener('click', closeProjectModal);
            searchBtn.addEventListener('click', applyFilter);
            resetSearchBtn.addEventListener('click', resetFilter);
            quickAddBtn.addEventListener('click', scrollToForm);
            quickExportBtn.addEventListener('click', () => exportDataAs(exportFormatSelect.value));
            showShortcutsBtn.addEventListener('click', toggleShortcuts);
            
            // ÂàÜÈ°µ‰∫ã‰ª∂ÁõëÂê¨Âô®
            pageSizeSelect.addEventListener('change', changePageSize);
            firstPageBtn.addEventListener('click', () => changePage(1));
            prevPageBtn.addEventListener('click', goToPrevPage);
            nextPageBtn.addEventListener('click', goToNextPage);
            lastPageBtn.addEventListener('click', goToLastPage);
            
            // Â§öÈÄâ‰∏ãÊãâÊ°Ü‰∫ã‰ª∂ÁõëÂê¨Âô®
            multiselectInput.addEventListener('click', toggleMultiselectDropdown);
            multiselectSearch.addEventListener('input', filterMultiselectOptions);
            
            // ÂØºÂÖ•‰∫ã‰ª∂ÁõëÂê¨Âô®
            importFileInput.addEventListener('change', handleFileSelect);
            downloadTemplateBtn.addEventListener('click', downloadTemplate);
            importBtn.addEventListener('click', importRecords);
            
            // ÂàùÂßãÂåñÁßªÂä®Á´ØÊ†áÁ≠æ‰∫ã‰ª∂
            initMobileTabEvents();
            
            // Âø´ÈÄüÊìç‰ΩúÊåâÈíÆ‰∫ã‰ª∂
            quickIncomeBtn.addEventListener('click', () => quickAddRecord('income', 'Â∑•ËµÑ', 0));
            quickExpenseBtn.addEventListener('click', () => quickAddRecord('expense', 'Êó•Áî®ÂìÅ', 0));
            quickFoodBtn.addEventListener('click', () => quickAddRecord('expense', 'ÂêÉÈ•≠', 0));
            addIncomeProjectBtn.addEventListener('click', () => quickAddProject('income'));
            addExpenseProjectBtn.addEventListener('click', () => quickAddProject('expense'));
            
            // ÂàÜÊûê‰∫ã‰ª∂ÁõëÂê¨Âô®
            updateAnalysisBtn.addEventListener('click', updateAnalysisCharts);
            resetAnalysisBtn.addEventListener('click', resetAnalysisFilter);
            expenseGroupBySelect.addEventListener('change', updateAnalysisCharts);
            expenseTrendProjectSelect.addEventListener('change', updateAnalysisCharts);
            expenseTrendGroupSelect.addEventListener('change', updateAnalysisCharts);
            incomeTrendProjectSelect.addEventListener('change', updateAnalysisCharts);
            incomeTrendGroupSelect.addEventListener('change', updateAnalysisCharts);
            balanceTrendGroupSelect.addEventListener('change', updateAnalysisCharts);
            
            // ÁªüËÆ°‰∫ã‰ª∂ÁõëÂê¨Âô®
            closeStatsBtn.addEventListener('click', () => statisticsModal.style.display = 'none');
            
            // Ë°®Ê†ºË°åÁÇπÂáª‰∫ã‰ª∂ÔºàÁî®‰∫éÈÄâÊã©Ôºâ
            recordsTable.addEventListener('click', function(e) {
                if (e.target.closest('.delete-record')) {
                    return; // Âà†Èô§ÊåâÈíÆÂ∑≤ÊúâÂ§ÑÁêÜ
                }
                
                const row = e.target.closest('tr');
                if (row && !row.classList.contains('selected')) {
                    // ÁßªÈô§ÂÖ∂‰ªñË°åÁöÑÈÄâ‰∏≠Áä∂ÊÄÅ
                    document.querySelectorAll('tr.selected').forEach(r => {
                        r.classList.remove('selected');
                    });
                    // ÈÄâ‰∏≠ÂΩìÂâçË°å
                    row.classList.add('selected');
                }
            });
            
            // ÂàùÂßãÂåñÊãñÊîæÂäüËÉΩ
            initDragAndDrop();
            
            // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
            window.addEventListener('click', function(event) {
                if (event.target === projectModal) {
                    closeProjectModal();
                }
                if (event.target === statisticsModal) {
                    statisticsModal.style.display = 'none';
                }
                if (!multiselectInput.contains(event.target) && !multiselectDropdown.contains(event.target)) {
                    multiselectDropdown.classList.remove('active');
                }
            });
            
            // ÁõëÂê¨Á±ªÂûãÂèòÂåñÔºåÊõ¥Êñ∞È°πÁõÆÂàóË°®
            document.getElementById('type').addEventListener('change', updateProjectSelect);
            
            // ÈîÆÁõòÂø´Êç∑ÈîÆ
            document.addEventListener('keydown', handleKeydown);
            
            // ÁßªÂä®Á´ØÂàùÂßãÂåñ
            initMobileView();
            
            // ÊòæÁ§∫Ê¨¢Ëøé‰ø°ÊÅØ
            setTimeout(() => {
                if (records.length === 0) {
                    showNotification('Ê¨¢Ëøé‰ΩøÁî®ËÆ∞Ë¥¶Êú¨ÔºÅÂºÄÂßãËÆ∞ÂΩïÊÇ®ÁöÑÁ¨¨‰∏ÄÁ¨îÊî∂ÊîØÂêßÔºÅ', 'success');
                }
            }, 1000);
        });

        // ==================== ÂØºÂÖ•Áõ∏ÂÖ≥ÂáΩÊï∞ ====================

        // ÂØºÂÖ•Êñá‰ª∂Â§ÑÁêÜ
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™Â∑•‰ΩúË°®
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    
                    // Â∞ÜÂ∑•‰ΩúË°®ËΩ¨Êç¢‰∏∫JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {
                        header: 1,
                        raw: false,
                        defval: ''
                    });
                    
                    if (jsonData.length < 2) {
                        showNotification('Êñá‰ª∂ÂÜÖÂÆπ‰∏∫Á©∫ÊàñÊ†ºÂºè‰∏çÊ≠£Á°Æ', 'danger');
                        return;
                    }
                    
                    // Êü•ÊâæË°®Â§¥Ë°å
                    let headers = [];
                    let dataStartRow = 0;
                    
                    for (let i = 0; i < Math.min(5, jsonData.length); i++) {
                        const row = jsonData[i];
                        const headerText = row.map(cell => cell ? cell.toString().trim().toLowerCase() : '');
                        
                        // Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´È¢ÑÊúüÂàóÂêç
                        if (headerText.includes('Êó•Êúü') || headerText.includes('date') ||
                            headerText.includes('Á±ªÂûã') || headerText.includes('type')) {
                            headers = row;
                            dataStartRow = i + 1;
                            break;
                        }
                    }
                    
                    if (headers.length === 0) {
                        headers = jsonData[0];
                        dataStartRow = 1;
                    }
                    
                    // Á°ÆÂÆöÂêÑÂàóÁ¥¢Âºï
                    const getColumnIndex = (keywords) => {
                        for (const keyword of keywords) {
                            const index = headers.findIndex(h => 
                                h && h.toString().toLowerCase().includes(keyword)
                            );
                            if (index !== -1) return index;
                        }
                        return -1;
                    };
                    
                    const dateIndex = getColumnIndex(['Êó•Êúü', 'date']);
                    const typeIndex = getColumnIndex(['Á±ªÂûã', 'type']);
                    const projectIndex = getColumnIndex(['È°πÁõÆ', 'project', 'category']);
                    const amountIndex = getColumnIndex(['ÈáëÈ¢ù', 'amount', 'money']);
                    const noteIndex = getColumnIndex(['Â§áÊ≥®', 'note', 'memo']);
                    
                    // È™åËØÅÂøÖË¶ÅÂàó
                    if (dateIndex === -1 || typeIndex === -1 || projectIndex === -1 || amountIndex === -1) {
                        showNotification('Êñá‰ª∂Áº∫Â∞ëÂøÖË¶ÅÁöÑÂàóÔºöÊó•Êúü„ÄÅÁ±ªÂûã„ÄÅÈ°πÁõÆ„ÄÅÈáëÈ¢ù', 'danger');
                        return;
                    }
                    
                    importData = [];
                    let successCount = 0;
                    let errorCount = 0;
                    
                    for (let i = dataStartRow; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row.length < Math.max(dateIndex, typeIndex, projectIndex, amountIndex) + 1) {
                            errorCount++;
                            continue;
                        }
                        
                        // Ëé∑ÂèñÂçïÂÖÉÊ†ºÂÄº
                        let rawDate = row[dateIndex];
                        let rawType = row[typeIndex];
                        let rawProjectName = row[projectIndex];
                        let rawAmount = row[amountIndex];
                        let rawNote = noteIndex !== -1 ? (row[noteIndex] || '') : '';
                        
                        // Â§ÑÁêÜÊó•Êúü
                        let formattedDate = '';
                        if (rawDate) {
                            formattedDate = formatExcelDate(rawDate);
                        }
                        
                        if (!formattedDate) {
                            showNotification(`Á¨¨ ${i+1} Ë°åÊó•ÊúüÊ†ºÂºè‰∏çÊ≠£Á°Æ: "${rawDate}"`, 'danger');
                            errorCount++;
                            continue;
                        }
                        
                        // Â§ÑÁêÜÁ±ªÂûã
                        const type = parseType(rawType);
                        if (!type) {
                            showNotification(`Á¨¨ ${i+1} Ë°åÁ±ªÂûã‰∏çÊ≠£Á°Æ: "${rawType}"ÔºåÂ∫î‰∏∫"Êî∂ÂÖ•"Êàñ"ÊîØÂá∫"`, 'danger');
                            errorCount++;
                            continue;
                        }
                        
                        // Â§ÑÁêÜÈ°πÁõÆ
                        const projectName = rawProjectName ? rawProjectName.toString().trim() : '';
                        if (!projectName) {
                            showNotification(`Á¨¨ ${i+1} Ë°åÈ°πÁõÆÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫`, 'danger');
                            errorCount++;
                            continue;
                        }
                        
                        // Êü•ÊâæÈ°πÁõÆ
                        let project = projects.find(p => p.name === projectName);
                        
                        // Â¶ÇÊûúÈ°πÁõÆ‰∏çÂ≠òÂú®ÔºåÂ∞ùËØïÂàõÂª∫
                        if (!project) {
                            // Ê†πÊçÆÁ±ªÂûãÂàõÂª∫Êñ∞È°πÁõÆ
                            const newProject = {
                                id: Math.max(...projects.map(p => p.id), 0) + 1,
                                name: projectName,
                                type: type,
                                emoji: getDefaultEmoji(projectName, type)
                            };
                            projects.push(newProject);
                            project = newProject;
                            showNotification(`Ëá™Âä®ÂàõÂª∫Êñ∞È°πÁõÆ: ${projectName}`, 'warning');
                        }
                        
                        // Ê£ÄÊü•È°πÁõÆÁ±ªÂûãÊòØÂê¶ÂåπÈÖç
                        if (project.type !== type) {
                            showNotification(`Á¨¨ ${i+1} Ë°åÈ°πÁõÆ"${projectName}"Á±ªÂûã‰∏çÂåπÈÖçÔºåÂ∫î‰∏∫${type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫'}È°πÁõÆ`, 'danger');
                            errorCount++;
                            continue;
                        }
                        
                        // Â§ÑÁêÜÈáëÈ¢ù
                        const amount = parseAmount(rawAmount);
                        if (isNaN(amount) || amount <= 0) {
                            showNotification(`Á¨¨ ${i+1} Ë°åÈáëÈ¢ù‰∏çÊ≠£Á°Æ: "${rawAmount}"`, 'danger');
                            errorCount++;
                            continue;
                        }
                        
                        // Ê∑ªÂä†Âà∞ÂØºÂÖ•Êï∞ÊçÆ
                        importData.push({
                            id: Date.now() + i,
                            date: formattedDate,
                            type: type,
                            projectId: project.id,
                            projectName: project.name,
                            projectEmoji: project.emoji,
                            amount: type === 'income' ? amount : -amount,
                            note: rawNote ? rawNote.toString().trim() : ''
                        });
                        
                        successCount++;
                    }
                    
                    if (importData.length > 0) {
                        showImportPreview();
                        importBtn.disabled = false;
                        
                        if (errorCount > 0) {
                            showNotification(`ÊàêÂäüËß£Êûê ${successCount} Êù°ËÆ∞ÂΩïÔºåË∑≥Ëøá ${errorCount} Êù°Êó†ÊïàËÆ∞ÂΩï`, 'warning');
                        } else {
                            showNotification(`ÊàêÂäüËß£Êûê ${successCount} Êù°ËÆ∞ÂΩïÔºåÁÇπÂáª"ÂØºÂÖ•Êï∞ÊçÆ"ÊåâÈíÆÂÆåÊàêÂØºÂÖ•`, 'success');
                        }
                    } else {
                        showNotification('Ê≤°ÊúâÊâæÂà∞ÊúâÊïàÁöÑËÆ∞ÂΩïÊï∞ÊçÆ', 'danger');
                        importBtn.disabled = true;
                        importPreview.style.display = 'none';
                    }
                } catch (error) {
                    console.error('ÂØºÂÖ•ÈîôËØØ:', error);
                    showNotification(`Êñá‰ª∂ËØªÂèñÂ§±Ë¥•: ${error.message}`, 'danger');
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        // ÊòæÁ§∫ÂØºÂÖ•È¢ÑËßà
        function showImportPreview() {
            importPreviewBody.innerHTML = '';
            
            const previewData = importData.slice(0, 5);
            
            previewData.forEach(record => {
                const row = importPreviewBody.insertRow();
                
                const dateCell = row.insertCell(0);
                dateCell.textContent = record.date;
                
                const typeCell = row.insertCell(1);
                typeCell.textContent = record.type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫';
                typeCell.className = record.type === 'income' ? 'income' : 'expense';
                
                const projectCell = row.insertCell(2);
                projectCell.innerHTML = `<span class="emoji">${record.projectEmoji || 'üìÅ'}</span> ${record.projectName}`;
                
                const amountCell = row.insertCell(3);
                amountCell.textContent = `¬•${Math.abs(record.amount).toFixed(2)}`;
                amountCell.className = record.type === 'income' ? 'income' : 'expense';
                
                const noteCell = row.insertCell(4);
                noteCell.textContent = record.note || '-';
            });
            
            if (importData.length > 5) {
                const infoRow = importPreviewBody.insertRow();
                const infoCell = infoRow.insertCell(0);
                infoCell.colSpan = 5;
                infoCell.textContent = `... ËøòÊúâ ${importData.length - 5} Êù°ËÆ∞ÂΩï`;
                infoCell.style.textAlign = 'center';
                infoCell.style.fontStyle = 'italic';
                infoCell.style.color = '#999';
            }
            
            importPreview.style.display = 'block';
        }
        
        // ÂØºÂÖ•ËÆ∞ÂΩï
        function importRecords() {
            if (importData.length === 0) {
                showNotification('Ê≤°ÊúâÂèØÂØºÂÖ•ÁöÑÊï∞ÊçÆ', 'danger');
                return;
            }
            
            // ÂêàÂπ∂Êï∞ÊçÆÂπ∂ÊéíÂ∫èÔºàÊúÄÊñ∞ÁöÑÂú®ÂâçÈù¢Ôºâ
            records = [...importData, ...records].sort((a, b) => {
                return new Date(b.date) - new Date(a.date);
            });
            
            saveData();
            
            updateRecordsTable();
            updateTotalAmount();
            updateProjectList();
            updateMultiselectOptions();
            updateAnalysisProjectSelects();
            
            if (currentMobileTab === 'analysis') {
                updateAnalysisCharts();
            }
            
            // ÈáçÁΩÆÂØºÂÖ•Áä∂ÊÄÅ
            importFileInput.value = '';
            importBtn.disabled = true;
            importPreview.style.display = 'none';
            
            // ‰øùÂ≠òÊñ∞ÂàõÂª∫ÁöÑÈ°πÁõÆ
            saveData();
            
            showNotification(`ÊàêÂäüÂØºÂÖ• ${importData.length} Êù°ËÆ∞ÂΩïÔºÅ`, 'success');
            
            // Ê∏ÖÁ©∫ÂØºÂÖ•Êï∞ÊçÆ
            importData = [];
        }
        
        // ‰∏ãËΩΩÊ®°Êùø
        function downloadTemplate() {
            const templateData = [
                ['Êó•Êúü', 'Á±ªÂûã', 'È°πÁõÆ', 'ÈáëÈ¢ù', 'Â§áÊ≥®'],
                ['2025-01-01', 'Êî∂ÂÖ•', 'Â∑•ËµÑ', '5000', '‰∏ÄÊúàÂ∑•ËµÑ'],
                ['2025-01-02', 'ÊîØÂá∫', 'ÂêÉÈ•≠', '50', 'ÂçàÈ§ê'],
                ['2025-01-03', 'ÊîØÂá∫', 'Ë°£Êúç', '200', 'Êñ∞Ë°£Êúç'],
                ['2025-01-04', 'Êî∂ÂÖ•', 'Â•ñÈáë', '1000', 'Âπ¥ÁªàÂ•ñ'],
                ['2025-01-05', 'ÊîØÂá∫', '‰∫§ÈÄö', '80', 'Âú∞ÈìÅÂÖÖÂÄº']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(templateData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Ë¥¶Êú¨ËÆ∞ÂΩïÊ®°Êùø");
            
            // ËÆæÁΩÆÂàóÂÆΩ
            ws['!cols'] = [
                { wch: 12 },  // Êó•ÊúüÂàó
                { wch: 8 },   // Á±ªÂûãÂàó
                { wch: 12 },  // È°πÁõÆÂàó
                { wch: 10 },  // ÈáëÈ¢ùÂàó
                { wch: 20 }   // Â§áÊ≥®Âàó
            ];
            
            XLSX.writeFile(wb, "Ë¥¶Êú¨ËÆ∞ÂΩïÊ®°Êùø.xlsx");
            
            showNotification('Ê®°Êùø‰∏ãËΩΩÊàêÂäüÔºÅËØ∑‰ΩøÁî®Ê≠§Ê®°ÊùøÊ†ºÂºèÂØºÂÖ•Êï∞ÊçÆ', 'success');
        }

        // ==================== ÂÖ∂‰ªñÂäüËÉΩÂáΩÊï∞ ====================

        // ÈîÆÁõòÂø´Êç∑ÈîÆÂ§ÑÁêÜ
        function handleKeydown(e) {
            // Ctrl+S Êàñ Cmd+S ‰øùÂ≠òËÆ∞ÂΩï
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                if (currentMobileTab === 'form') {
                    accountForm.dispatchEvent(new Event('submit'));
                }
            }
            
            // Esc ÈáçÁΩÆË°®Âçï
            if (e.key === 'Escape') {
                e.preventDefault();
                if (currentMobileTab === 'form') {
                    resetForm();
                }
            }
            
            // Ctrl+F Êàñ Cmd+F ÊêúÁ¥¢ÁÑ¶ÁÇπ
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                if (currentMobileTab === 'records') {
                    multiselectSearch.focus();
                }
            }
            
            // Ctrl+E Êàñ Cmd+E Âø´ÈÄüÂØºÂá∫
            if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                e.preventDefault();
                exportDataAs(exportFormatSelect.value);
            }
            
            // Del Âà†Èô§ÈÄâ‰∏≠ËÆ∞ÂΩï
            if (e.key === 'Delete' && currentMobileTab === 'records') {
                e.preventDefault();
                const selectedRow = document.querySelector('tr.selected');
                if (selectedRow) {
                    const deleteBtn = selectedRow.querySelector('.delete-record');
                    if (deleteBtn) {
                        deleteRecord(parseInt(deleteBtn.dataset.id));
                    }
                }
            }
            
            // Ctrl+B ÊâπÈáèÂà†Èô§
            if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
                e.preventDefault();
                batchDeleteSelected();
            }
            
            // Ctrl+T ÊòæÁ§∫ÁªüËÆ°
            if ((e.ctrlKey || e.metaKey) && e.key === 't') {
                e.preventDefault();
                showStatistics();
            }
        }

        // ÂàáÊç¢Âø´Êç∑ÈîÆÊèêÁ§∫ÊòæÁ§∫
        function toggleShortcuts() {
            const shortcuts = document.querySelector('.keyboard-shortcuts');
            shortcuts.classList.toggle('show');
            showNotification(shortcuts.classList.contains('show') ? 'Âø´Êç∑ÈîÆÊèêÁ§∫Â∑≤ÊòæÁ§∫' : 'Âø´Êç∑ÈîÆÊèêÁ§∫Â∑≤ÈöêËóè', 'success');
        }

        // ÁßªÂä®Á´ØÊ†áÁ≠æ‰∫ã‰ª∂ÂàùÂßãÂåñ
        function initMobileTabEvents() {
            mobileTabs.forEach(tab => {
                let touchStartTime = 0;
                let touchStartX = 0;
                let touchStartY = 0;
                let isTouchMoved = false;
                
                tab.addEventListener('touchstart', function(e) {
                    touchStartTime = Date.now();
                    touchStartX = e.touches[0].clientX;
                    touchStartY = e.touches[0].clientY;
                    isTouchMoved = false;
                    
                    this.classList.add('touching');
                    
                    e.preventDefault();
                }, { passive: false });
                
                tab.addEventListener('touchmove', function(e) {
                    if (isTouchMoved) return;
                    
                    const touchX = e.touches[0].clientX;
                    const touchY = e.touches[0].clientY;
                    
                    const deltaX = Math.abs(touchX - touchStartX);
                    const deltaY = Math.abs(touchY - touchStartY);
                    
                    if (deltaX > 8 || deltaY > 8) {
                        isTouchMoved = true;
                        this.classList.remove('touching');
                    }
                }, { passive: true });
                
                tab.addEventListener('touchend', function(e) {
                    const touchEndTime = Date.now();
                    const timeDiff = touchEndTime - touchStartTime;
                    
                    this.classList.remove('touching');
                    
                    if (timeDiff >= 50 && timeDiff <= 500 && !isTouchMoved) {
                        const tabId = this.getAttribute('data-tab');
                        switchMobileTab(tabId);
                        
                        this.classList.add('clicked');
                        setTimeout(() => {
                            this.classList.remove('clicked');
                        }, 200);
                    }
                }, { passive: true });
                
                tab.addEventListener('click', function(e) {
                    if (window.innerWidth > 767) {
                        const tabId = this.getAttribute('data-tab');
                        switchMobileTab(tabId);
                    } else {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                });
            });
        }

        // ÁßªÂä®Á´ØËßÜÂõæÂàùÂßãÂåñ
        function initMobileView() {
            const isMobile = window.innerWidth <= 767;
            
            if (isMobile) {
                switchMobileTab('form');
                document.querySelector('.floating-elements').style.display = 'none';
                
                const tableContainer = document.querySelector('.table-container');
                if (tableContainer) {
                    const containerWidth = document.querySelector('.container').offsetWidth;
                    tableContainer.style.width = `${containerWidth}px`;
                }
            }
        }

        // ÂàáÊç¢ÁßªÂä®Á´ØÊ†áÁ≠æ
        function switchMobileTab(tabId) {
            if (currentMobileTab === tabId) return;
            
            currentMobileTab = tabId;
            
            mobileTabs.forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            const tabs = [formTab, recordsTab, analysisTab, projectsTab];
            tabs.forEach(tab => {
                if (tab.id === `${tabId}Tab`) {
                    tab.classList.add('active');
                    if (tabId === 'analysis') {
                        updateAnalysisCharts();
                    }
                } else {
                    tab.classList.remove('active');
                }
            });
        }

        // Êõ¥Êñ∞ÂàÜÊûêÂõæË°®È°πÁõÆÈÄâÊã©
        function updateAnalysisProjectSelects() {
            expenseTrendProjectSelect.innerHTML = '<option value="all">ÂÖ®ÈÉ®È°πÁõÆ</option>';
            projects.filter(p => p.type === 'expense').forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = `${project.emoji || 'üìÅ'} ${project.name}`;
                expenseTrendProjectSelect.appendChild(option);
            });
            
            incomeTrendProjectSelect.innerHTML = '<option value="all">ÂÖ®ÈÉ®È°πÁõÆ</option>';
            projects.filter(p => p.type === 'income').forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = `${project.emoji || 'üìÅ'} ${project.name}`;
                incomeTrendProjectSelect.appendChild(option);
            });
        }

        // ÂàùÂßãÂåñÂàÜÊûêÂõæË°®
        function initAnalysisCharts() {
            if (expensePieChart) expensePieChart.destroy();
            if (expenseTrendChart) expenseTrendChart.destroy();
            if (incomeTrendChart) incomeTrendChart.destroy();
            if (balanceTrendChart) balanceTrendChart.destroy();
            
            const expensePieCtx = document.getElementById('expensePieChart').getContext('2d');
            const expenseTrendCtx = document.getElementById('expenseTrendChart').getContext('2d');
            const incomeTrendCtx = document.getElementById('incomeTrendChart').getContext('2d');
            const balanceTrendCtx = document.getElementById('balanceTrendChart').getContext('2d');
            
            expensePieChart = new Chart(expensePieCtx, {
                type: 'pie',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                padding: 10
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    label += `¬•${value.toFixed(2)} (${percentage}%)`;
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
            
            expenseTrendChart = new Chart(expenseTrendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ÊîØÂá∫',
                        data: [],
                        borderColor: '#FF6B6B',
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '¬•' + value;
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'ÊîØÂá∫: ¬•' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
            
            incomeTrendChart = new Chart(incomeTrendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Êî∂ÂÖ•',
                        data: [],
                        borderColor: '#2E8B57',
                        backgroundColor: 'rgba(46, 139, 87, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '¬•' + value;
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Êî∂ÂÖ•: ¬•' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
            
            balanceTrendChart = new Chart(balanceTrendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Êî∂ÂÖ•',
                            data: [],
                            borderColor: '#2E8B57',
                            backgroundColor: 'rgba(46, 139, 87, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'ÊîØÂá∫',
                            data: [],
                            borderColor: '#FF6B6B',
                            backgroundColor: 'rgba(255, 107, 107, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'ÂáÄÊî∂ÂÖ•',
                            data: [],
                            borderColor: '#FF8DC7',
                            backgroundColor: 'rgba(255, 141, 199, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '¬•' + value;
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ¬•' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Êõ¥Êñ∞ÂàÜÊûêÂõæË°®
        function updateAnalysisCharts() {
            const startDate = analysisStartDateInput.value;
            const endDate = analysisEndDateInput.value;
            
            if (!startDate || !endDate) {
                showNotification('ËØ∑ÈÄâÊã©ÂàÜÊûêÊó∂Èó¥ËåÉÂõ¥', 'danger');
                return;
            }
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            if (start > end) {
                showNotification('ÂºÄÂßãÊó•Êúü‰∏çËÉΩÊôö‰∫éÁªìÊùüÊó•Êúü', 'danger');
                return;
            }
            
            let filteredRecords = records.filter(record => {
                const recordDate = new Date(record.date);
                return recordDate >= start && recordDate <= end;
            });
            
            if (filteredRecords.length === 0) {
                showNotification('Âú®ÈÄâÂÆöÊó∂Èó¥ËåÉÂõ¥ÂÜÖÊ≤°ÊúâËÆ∞ÂΩï', 'warning');
                return;
            }
            
            updateExpensePieChart(filteredRecords);
            updateExpenseTrendChart(filteredRecords);
            updateIncomeTrendChart(filteredRecords);
            updateBalanceTrendChart(filteredRecords);
            
            showNotification('ÂàÜÊûêÂõæË°®Â∑≤Êõ¥Êñ∞', 'success');
        }

        // Êõ¥Êñ∞ÊîØÂá∫È•ºÂõæ
        function updateExpensePieChart(filteredRecords) {
            const expenseRecords = filteredRecords.filter(record => record.type === 'expense');
            
            if (expenseRecords.length === 0) {
                document.getElementById('noExpenseData').style.display = 'block';
                document.getElementById('expenseSummary').style.display = 'none';
                expensePieChart.data.labels = [];
                expensePieChart.data.datasets[0].data = [];
                expensePieChart.update();
                return;
            }
            
            document.getElementById('noExpenseData').style.display = 'none';
            document.getElementById('expenseSummary').style.display = 'flex';
            
            const groupBy = expenseGroupBySelect.value;
            let labels = [];
            let data = [];
            let colors = [];
            
            if (groupBy === 'project') {
                const projectMap = {};
                
                expenseRecords.forEach(record => {
                    const projectName = record.projectName;
                    const amount = Math.abs(record.amount);
                    
                    if (!projectMap[projectName]) {
                        projectMap[projectName] = 0;
                    }
                    projectMap[projectName] += amount;
                });
                
                const sortedProjects = Object.entries(projectMap)
                    .sort((a, b) => b[1] - a[1]);
                
                sortedProjects.forEach(([projectName, amount], index) => {
                    labels.push(projectName);
                    data.push(amount);
                    colors.push(getColorForIndex(index));
                });
                
                const totalExpense = data.reduce((sum, val) => sum + val, 0);
                document.getElementById('totalExpenseAmount').textContent = `¬•${totalExpense.toFixed(2)}`;
                document.getElementById('expenseProjectCount').textContent = labels.length;
                
            } else if (groupBy === 'month') {
                const monthMap = {};
                
                expenseRecords.forEach(record => {
                    const date = new Date(record.date);
                    const monthKey = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                    const monthLabel = `${date.getFullYear()}Âπ¥${date.getMonth() + 1}Êúà`;
                    const amount = Math.abs(record.amount);
                    
                    if (!monthMap[monthKey]) {
                        monthMap[monthKey] = {
                            label: monthLabel,
                            amount: 0
                        };
                    }
                    monthMap[monthKey].amount += amount;
                });
                
                const sortedMonths = Object.values(monthMap)
                    .sort((a, b) => {
                        const aDate = new Date(a.label.replace('Âπ¥', '-').replace('Êúà', ''));
                        const bDate = new Date(b.label.replace('Âπ¥', '-').replace('Êúà', ''));
                        return aDate - bDate;
                    });
                
                sortedMonths.forEach((month, index) => {
                    labels.push(month.label);
                    data.push(month.amount);
                    colors.push(getColorForIndex(index));
                });
                
                const totalExpense = data.reduce((sum, val) => sum + val, 0);
                document.getElementById('totalExpenseAmount').textContent = `¬•${totalExpense.toFixed(2)}`;
                document.getElementById('expenseProjectCount').textContent = labels.length;
            }
            
            expensePieChart.data.labels = labels;
            expensePieChart.data.datasets[0].data = data;
            expensePieChart.data.datasets[0].backgroundColor = colors;
            expensePieChart.update();
        }

        // Êõ¥Êñ∞ÊîØÂá∫Ë∂ãÂäøÂõæ
        function updateExpenseTrendChart(filteredRecords) {
            let expenseRecords = filteredRecords.filter(record => record.type === 'expense');
            
            const selectedProject = expenseTrendProjectSelect.value;
            if (selectedProject !== 'all') {
                expenseRecords = expenseRecords.filter(record => record.projectId === parseInt(selectedProject));
            }
            
            if (expenseRecords.length === 0) {
                document.getElementById('noExpenseTrendData').style.display = 'block';
                document.getElementById('expenseTrendSummary').style.display = 'none';
                expenseTrendChart.data.labels = [];
                expenseTrendChart.data.datasets[0].data = [];
                expenseTrendChart.update();
                return;
            }
            
            document.getElementById('noExpenseTrendData').style.display = 'none';
            document.getElementById('expenseTrendSummary').style.display = 'flex';
            
            const groupBy = expenseTrendGroupSelect.value;
            const { labels, data } = groupRecordsByTime(expenseRecords, groupBy);
            
            const totalExpense = data.reduce((sum, val) => sum + val, 0);
            const avgExpense = totalExpense / data.length;
            const maxExpense = Math.max(...data);
            
            document.getElementById('avgExpenseAmount').textContent = `¬•${avgExpense.toFixed(2)}`;
            document.getElementById('maxExpenseAmount').textContent = `¬•${maxExpense.toFixed(2)}`;
            
            expenseTrendChart.data.labels = labels;
            expenseTrendChart.data.datasets[0].data = data;
            expenseTrendChart.update();
        }

        // Êõ¥Êñ∞Êî∂ÂÖ•Ë∂ãÂäøÂõæ
        function updateIncomeTrendChart(filteredRecords) {
            let incomeRecords = filteredRecords.filter(record => record.type === 'income');
            
            const selectedProject = incomeTrendProjectSelect.value;
            if (selectedProject !== 'all') {
                incomeRecords = incomeRecords.filter(record => record.projectId === parseInt(selectedProject));
            }
            
            if (incomeRecords.length === 0) {
                document.getElementById('noIncomeTrendData').style.display = 'block';
                document.getElementById('incomeTrendSummary').style.display = 'none';
                incomeTrendChart.data.labels = [];
                incomeTrendChart.data.datasets[0].data = [];
                incomeTrendChart.update();
                return;
            }
            
            document.getElementById('noIncomeTrendData').style.display = 'none';
            document.getElementById('incomeTrendSummary').style.display = 'flex';
            
            const groupBy = incomeTrendGroupSelect.value;
            const { labels, data } = groupRecordsByTime(incomeRecords, groupBy);
            
            const totalIncome = data.reduce((sum, val) => sum + val, 0);
            const avgIncome = totalIncome / data.length;
            const maxIncome = Math.max(...data);
            
            document.getElementById('avgIncomeAmount').textContent = `¬•${avgIncome.toFixed(2)}`;
            document.getElementById('maxIncomeAmount').textContent = `¬•${maxIncome.toFixed(2)}`;
            
            incomeTrendChart.data.labels = labels;
            incomeTrendChart.data.datasets[0].data = data;
            incomeTrendChart.update();
        }

        // Êõ¥Êñ∞Êî∂ÊîØÂØπÊØîË∂ãÂäøÂõæ
        function updateBalanceTrendChart(filteredRecords) {
            const incomeRecords = filteredRecords.filter(record => record.type === 'income');
            const expenseRecords = filteredRecords.filter(record => record.type === 'expense');
            
            if (incomeRecords.length === 0 && expenseRecords.length === 0) {
                document.getElementById('noBalanceTrendData').style.display = 'block';
                document.getElementById('balanceTrendSummary').style.display = 'none';
                balanceTrendChart.data.labels = [];
                balanceTrendChart.data.datasets[0].data = [];
                balanceTrendChart.data.datasets[1].data = [];
                balanceTrendChart.data.datasets[2].data = [];
                balanceTrendChart.update();
                return;
            }
            
            document.getElementById('noBalanceTrendData').style.display = 'none';
            document.getElementById('balanceTrendSummary').style.display = 'flex';
            
            const groupBy = balanceTrendGroupSelect.value;
            
            const incomeData = groupRecordsByTime(incomeRecords, groupBy);
            const expenseData = groupRecordsByTime(expenseRecords, groupBy);
            
            let labels = [];
            if (incomeData.labels.length > 0) {
                labels = incomeData.labels;
            } else {
                labels = expenseData.labels;
            }
            
            const incomeValues = alignDataToLabels(incomeData.data, incomeData.labels, labels);
            const expenseValues = alignDataToLabels(expenseData.data, expenseData.labels, labels);
            
            const netValues = incomeValues.map((income, index) => {
                const expense = expenseValues[index] || 0;
                return income - expense;
            });
            
            const totalIncome = incomeValues.reduce((sum, val) => sum + val, 0);
            const totalExpense = expenseValues.reduce((sum, val) => sum + val, 0);
            const netIncome = totalIncome - totalExpense;
            
            document.getElementById('totalIncomeAmount').textContent = `¬•${totalIncome.toFixed(2)}`;
            document.getElementById('totalExpenseTrendAmount').textContent = `¬•${totalExpense.toFixed(2)}`;
            document.getElementById('netIncomeAmount').textContent = `¬•${netIncome.toFixed(2)}`;
            
            balanceTrendChart.data.labels = labels;
            balanceTrendChart.data.datasets[0].data = incomeValues;
            balanceTrendChart.data.datasets[1].data = expenseValues;
            balanceTrendChart.data.datasets[2].data = netValues;
            balanceTrendChart.update();
        }

        // ÊåâÊó∂Èó¥ÂàÜÁªÑËÆ∞ÂΩï
        function groupRecordsByTime(records, groupBy) {
            const groupedData = {};
            const labels = [];
            const data = [];
            
            records.forEach(record => {
                const date = new Date(record.date);
                let key, label;
                
                if (groupBy === 'day') {
                    key = date.toISOString().split('T')[0];
                    label = `${date.getMonth() + 1}/${date.getDate()}`;
                } else if (groupBy === 'week') {
                    const weekStart = new Date(date);
                    weekStart.setDate(date.getDate() - date.getDay());
                    key = `${weekStart.getFullYear()}-W${Math.ceil((date.getDate() + 6 - date.getDay()) / 7)}`;
                    label = `${date.getMonth() + 1}ÊúàÁ¨¨${Math.ceil((date.getDate() + 6 - date.getDay()) / 7)}Âë®`;
                } else if (groupBy === 'month') {
                    key = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                    label = `${date.getFullYear()}Âπ¥${date.getMonth() + 1}Êúà`;
                }
                
                if (!groupedData[key]) {
                    groupedData[key] = {
                        label: label,
                        amount: 0
                    };
                }
                
                groupedData[key].amount += Math.abs(record.amount);
            });
            
            const sortedKeys = Object.keys(groupedData).sort();
            
            sortedKeys.forEach(key => {
                labels.push(groupedData[key].label);
                data.push(groupedData[key].amount);
            });
            
            return { labels, data };
        }

        // Â∞ÜÊï∞ÊçÆÂØπÈΩêÂà∞Ê†áÁ≠æ
        function alignDataToLabels(data, sourceLabels, targetLabels) {
            const result = [];
            
            targetLabels.forEach(label => {
                const index = sourceLabels.indexOf(label);
                if (index !== -1) {
                    result.push(data[index]);
                } else {
                    result.push(0);
                }
            });
            
            return result;
        }

        // Ëé∑ÂèñÈ¢úËâ≤
        function getColorForIndex(index) {
            const colors = [
                '#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0', '#118AB2',
                '#EF476F', '#7B68EE', '#FFA07A', '#20B2AA', '#FF8DC7',
                '#A3D8FF', '#FFD59E', '#A8E6CF', '#FFAAA5', '#C1E3FF'
            ];
            return colors[index % colors.length];
        }

        // ÈáçÁΩÆÂàÜÊûêÁ≠õÈÄâÊù°‰ª∂
        function resetAnalysisFilter() {
            const ninetyDaysAgo = new Date();
            ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);
            const today = new Date().toISOString().split('T')[0];
            
            analysisStartDateInput.value = ninetyDaysAgo.toISOString().split('T')[0];
            analysisEndDateInput.value = today;
            
            updateAnalysisCharts();
        }

        // Âø´ÈÄüÊ∑ªÂä†ËÆ∞ÂΩï
        function quickAddRecord(type, defaultProject, defaultAmount) {
            document.getElementById('type').value = type;
            updateProjectSelect();
            
            const project = projects.find(p => p.name === defaultProject && p.type === type);
            if (project) {
                document.getElementById('project').value = project.id;
            }
            
            document.getElementById('amount').value = '';
            document.getElementById('amount').focus();
            
            if (window.innerWidth <= 767) {
                switchMobileTab('form');
            }
            
            scrollToForm();
            
            showNotification(`Â∑≤ÂàáÊç¢Âà∞${type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫'}Ê®°ÂºèÔºåËØ∑ËæìÂÖ•ÈáëÈ¢ù`, 'success');
        }

        // Âø´ÈÄüÊ∑ªÂä†È°πÁõÆ
        function quickAddProject(type) {
            openProjectModal();
            document.getElementById('projectType').value = type;
            
            if (type === 'income') {
                document.getElementById('projectName').value = 'ÂÖ∂‰ªñÊî∂ÂÖ•';
            } else {
                document.getElementById('projectName').value = 'ÂÖ∂‰ªñÊîØÂá∫';
            }
            
            document.getElementById('projectName').focus();
        }

        // ÊªöÂä®Âà∞Ë°®ÂçïÂå∫Âüü
        function scrollToForm() {
            if (window.innerWidth <= 767) {
                switchMobileTab('form');
            } else {
                document.querySelector('.form-section').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            }
        }

        // Âä†ËΩΩÊú¨Âú∞Â≠òÂÇ®ÁöÑÊï∞ÊçÆ
        function loadData() {
            try {
                const savedProjects = localStorage.getItem('accountProjects');
                const savedRecords = localStorage.getItem('accountRecords');
                
                if (savedProjects) {
                    projects = JSON.parse(savedProjects);
                }
                
                if (savedRecords) {
                    records = JSON.parse(savedRecords);
                }
                
                // ÂàõÂª∫Â§á‰ªΩ
                const backupKey = `accountBackup_${new Date().toISOString().slice(0,10)}`;
                const backupData = {
                    projects,
                    records,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem(backupKey, JSON.stringify(backupData));
                
                // Ê∏ÖÁêÜÊóßÁöÑÂ§á‰ªΩÔºà‰øùÁïôÊúÄËøë7Â§©Ôºâ
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('accountBackup_')) {
                        const dateStr = key.replace('accountBackup_', '');
                        const backupDate = new Date(dateStr);
                        if (backupDate < oneWeekAgo) {
                            localStorage.removeItem(key);
                        }
                    }
                });
            } catch (error) {
                console.error('Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:', error);
                showNotification('Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§Êï∞ÊçÆ', 'danger');
            }
        }

        // ‰øùÂ≠òÊï∞ÊçÆÂà∞Êú¨Âú∞Â≠òÂÇ®
        function saveData() {
            try {
                localStorage.setItem('accountProjects', JSON.stringify(projects));
                localStorage.setItem('accountRecords', JSON.stringify(records));
            } catch (error) {
                console.error('‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•:', error);
                showNotification('‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Â≠òÂÇ®Á©∫Èó¥', 'danger');
            }
        }

        // Êõ¥Êñ∞È°πÁõÆÈÄâÊã©‰∏ãÊãâÂàóË°®
        function updateProjectSelect() {
            const type = document.getElementById('type').value;
            projectSelect.innerHTML = '';
            
            const filteredProjects = projects.filter(project => project.type === type);
            
            const foodProject = filteredProjects.find(p => p.id === 4);
            
            filteredProjects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = `${project.emoji || 'üìÅ'} ${project.name}`;
                projectSelect.appendChild(option);
            });
            
            if (foodProject && type === 'expense') {
                document.getElementById('project').value = 4;
            }
        }

        // Êõ¥Êñ∞Â§öÈÄâ‰∏ãÊãâÊ°ÜÈÄâÈ°π
        function updateMultiselectOptions() {
            multiselectOptions.innerHTML = '';
            
            projects.forEach(project => {
                const option = document.createElement('div');
                option.className = 'multiselect-option';
                option.dataset.id = project.id;
                option.innerHTML = `
                    <span class="emoji">${project.emoji || 'üìÅ'}</span>
                    <span>${project.name}</span>
                    <span style="margin-left: auto; font-size: 0.8rem; color: #999;">${project.type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫'}</span>
                `;
                
                option.addEventListener('click', () => toggleProjectSelection(project.id));
                
                if (currentFilter.projects.includes(project.id)) {
                    option.classList.add('selected');
                }
                
                multiselectOptions.appendChild(option);
            });
            
            updateMultiselectSelected();
        }

        // ÂàáÊç¢È°πÁõÆÈÄâÊã©Áä∂ÊÄÅ
        function toggleProjectSelection(projectId) {
            const index = currentFilter.projects.indexOf(projectId);
            
            if (index === -1) {
                currentFilter.projects.push(projectId);
            } else {
                currentFilter.projects.splice(index, 1);
            }
            
            updateMultiselectOptions();
        }

        // Êõ¥Êñ∞Â∑≤ÈÄâÈ°πÁõÆÊòæÁ§∫
        function updateMultiselectSelected() {
            multiselectSelected.innerHTML = '';
            
            if (currentFilter.projects.length === 0) {
                multiselectInput.textContent = 'ÈÄâÊã©È°πÁõÆ...';
                return;
            }
            
            multiselectInput.textContent = `Â∑≤ÈÄâÊã© ${currentFilter.projects.length} ‰∏™È°πÁõÆ`;
            
            currentFilter.projects.forEach(projectId => {
                const project = projects.find(p => p.id === projectId);
                if (project) {
                    const tag = document.createElement('div');
                    tag.className = 'selected-tag';
                    tag.innerHTML = `
                        <span class="emoji">${project.emoji || 'üìÅ'}</span>
                        <span>${project.name}</span>
                        <span class="remove" data-id="${project.id}">√ó</span>
                    `;
                    
                    tag.querySelector('.remove').addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleProjectSelection(project.id);
                    });
                    
                    multiselectSelected.appendChild(tag);
                }
            });
        }

        // ÂàáÊç¢Â§öÈÄâ‰∏ãÊãâÊ°ÜÊòæÁ§∫Áä∂ÊÄÅ
        function toggleMultiselectDropdown() {
            multiselectDropdown.classList.toggle('active');
            if (multiselectDropdown.classList.contains('active')) {
                multiselectSearch.focus();
            }
        }

        // ËøáÊª§Â§öÈÄâ‰∏ãÊãâÊ°ÜÈÄâÈ°π
        function filterMultiselectOptions() {
            const searchTerm = multiselectSearch.value.toLowerCase();
            const options = multiselectOptions.querySelectorAll('.multiselect-option');
            
            options.forEach(option => {
                const text = option.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    option.style.display = 'flex';
                } else {
                    option.style.display = 'none';
                }
            });
        }

        // Êõ¥Êñ∞È°πÁõÆÊòæÁ§∫ÂàóË°®
        function updateProjectList() {
            projectList.innerHTML = '';
            
            if (projects.length === 0) {
                projectList.innerHTML = '<div class="empty-state"><p>ÊöÇÊó†È°πÁõÆÔºåËØ∑Ê∑ªÂä†</p></div>';
                return;
            }
            
            const foodProject = projects.find(p => p.id === 4);
            if (foodProject) {
                const projectItem = document.createElement('div');
                projectItem.className = `project-item ${foodProject.type}`;
                projectItem.style.order = '-1';
                projectItem.innerHTML = `
                    <span class="emoji">${foodProject.emoji || 'üìÅ'}</span>
                    <span>${foodProject.name}</span>
                    <div class="actions">
                        <button class="btn btn-secondary edit-project" data-id="${foodProject.id}"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger delete-project" data-id="${foodProject.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                projectList.appendChild(projectItem);
            }
            
            projects.forEach(project => {
                if (project.id === 4) return;
                
                const projectItem = document.createElement('div');
                projectItem.className = `project-item ${project.type}`;
                projectItem.innerHTML = `
                    <span class="emoji">${project.emoji || 'üìÅ'}</span>
                    <span>${project.name}</span>
                    <div class="actions">
                        <button class="btn btn-secondary edit-project" data-id="${project.id}"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger delete-project" data-id="${project.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                projectList.appendChild(projectItem);
            });
            
            document.querySelectorAll('.edit-project').forEach(button => {
                button.addEventListener('click', function() {
                    const projectId = parseInt(this.getAttribute('data-id'));
                    editProject(projectId);
                });
            });
            
            document.querySelectorAll('.delete-project').forEach(button => {
                button.addEventListener('click', function() {
                    const projectId = parseInt(this.getAttribute('data-id'));
                    deleteProject(projectId);
                });
            });
        }

        // ÂàùÂßãÂåñÊãñÊîæÂäüËÉΩ
        function initDragAndDrop() {
            const tableRows = recordsTable.querySelectorAll('tr');
            
            tableRows.forEach(row => {
                row.setAttribute('draggable', 'true');
                
                row.addEventListener('dragstart', function(e) {
                    dragSource = this;
                    this.classList.add('dragging');
                });
                
                row.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('drag-over');
                });
                
                row.addEventListener('dragleave', function() {
                    this.classList.remove('drag-over');
                });
                
                row.addEventListener('drop', function(e) {
                    e.preventDefault();
                    if (dragSource && dragSource !== this) {
                        const rows = Array.from(recordsTable.children);
                        const sourceIndex = rows.indexOf(dragSource);
                        const targetIndex = rows.indexOf(this);
                        
                        if (sourceIndex < targetIndex) {
                            recordsTable.insertBefore(dragSource, this.nextSibling);
                        } else {
                            recordsTable.insertBefore(dragSource, this);
                        }
                    }
                    this.classList.remove('drag-over');
                });
                
                row.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                    recordsTable.querySelectorAll('tr').forEach(r => {
                        r.classList.remove('drag-over');
                    });
                    dragSource = null;
                });
            });
        }

        // Ê∑ªÂä†Êñ∞ËÆ∞ÂΩï
        function addRecord(e) {
            e.preventDefault();
            
            const date = document.getElementById('date').value;
            const type = document.getElementById('type').value;
            const projectId = parseInt(document.getElementById('project').value);
            let amount = parseFloat(document.getElementById('amount').value);
            const note = document.getElementById('note').value;
            
            if (isNaN(amount) || amount <= 0) {
                showNotification('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÈáëÈ¢ù', 'danger');
                document.getElementById('amount').focus();
                return;
            }
            
            if (type === 'expense') {
                amount = -Math.abs(amount);
            }
            
            const project = projects.find(p => p.id === projectId);
            const projectName = project ? project.name : 'Êú™Áü•';
            const projectEmoji = project ? project.emoji : 'üìÅ';
            
            const newRecord = {
                id: Date.now(),
                date,
                type,
                projectId,
                projectName,
                projectEmoji,
                amount,
                note
            };
            
            records.unshift(newRecord);
            saveData();
            updateRecordsTable();
            updateTotalAmount();
            resetForm();
            
            if (currentMobileTab === 'analysis') {
                updateAnalysisCharts();
            }
            
            showNotification(`ÊàêÂäüÊ∑ªÂä†${type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫'}ËÆ∞ÂΩïÔºÅ`, 'success');
            
            if (window.innerWidth <= 767) {
                setTimeout(() => switchMobileTab('records'), 500);
            }
        }

        // ÊòæÁ§∫ÈÄöÁü•
        function showNotification(message, type) {
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-circle' : 'info-circle'}"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Êõ¥Êñ∞ËÆ∞ÂΩïË°®Ê†º
        function updateRecordsTable() {
            recordsTable.innerHTML = '';
            
            let filteredRecords = applyFilterToRecords(records);
            
            totalPages = Math.ceil(filteredRecords.length / pageSize);
            if (currentPage > totalPages) {
                currentPage = totalPages || 1;
            }
            
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const currentPageRecords = filteredRecords.slice(startIndex, endIndex);
            
            if (currentPageRecords.length === 0) {
                const emptyState = document.createElement('tr');
                emptyState.innerHTML = `
                    <td colspan="6">
                        <div class="empty-state">
                            <i class="fas fa-receipt"></i>
                            <p>ÊöÇÊó†ËÆ∞ÂΩï</p>
                            <p>ÁÇπÂáª"Ê∑ªÂä†ËÆ∞ÂΩï"ÂºÄÂßãËÆ∞Ë¥¶ÂêßÔºÅ</p>
                        </div>
                    </td>
                `;
                recordsTable.appendChild(emptyState);
                return;
            }
            
            currentPageRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            currentPageRecords.forEach(record => {
                const row = recordsTable.insertRow();
                
                const dateCell = row.insertCell(0);
                const dateObj = new Date(record.date);
                const month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
                const day = dateObj.getDate().toString().padStart(2, '0');
                dateCell.textContent = `${month}-${day}`;
                dateCell.title = record.date;
                
                const typeCell = row.insertCell(1);
                typeCell.innerHTML = `
                    <span class="type-indicator ${record.type === 'income' ? 'type-income' : 'type-expense'}"></span>
                    ${record.type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫'}
                `;
                
                const projectCell = row.insertCell(2);
                projectCell.innerHTML = `<span class="emoji">${record.projectEmoji || 'üìÅ'}</span> ${record.projectName}`;
                
                const amountCell = row.insertCell(3);
                amountCell.textContent = `¬•${Math.abs(record.amount).toFixed(2)}`;
                amountCell.className = record.type === 'income' ? 'income' : 'expense';
                
                const noteCell = row.insertCell(4);
                noteCell.textContent = record.note || '-';
                noteCell.title = record.note || '';
                
                const actionCell = row.insertCell(5);
                actionCell.innerHTML = `<button class="btn btn-danger delete-record" data-id="${record.id}"><i class="fas fa-trash"></i></button>`;
            });
            
            document.querySelectorAll('.delete-record').forEach(button => {
                button.addEventListener('click', function() {
                    const recordId = parseInt(this.getAttribute('data-id'));
                    deleteRecord(recordId);
                });
            });
            
            updateSearchResultsInfo(filteredRecords.length);
            updatePaginationInfo();
            initDragAndDrop();
        }

        // Â∫îÁî®Á≠õÈÄâÊù°‰ª∂Âà∞ËÆ∞ÂΩï
        function applyFilterToRecords(records) {
            let filtered = [...records];
            
            if (currentFilter.startDate) {
                filtered = filtered.filter(record => {
                    const recordDate = new Date(record.date);
                    const startDate = new Date(currentFilter.startDate);
                    return recordDate >= startDate;
                });
            }
            
            if (currentFilter.endDate) {
                filtered = filtered.filter(record => {
                    const recordDate = new Date(record.date);
                    const endDate = new Date(currentFilter.endDate);
                    // ËÆæÁΩÆÁªìÊùüÊó•Êúü‰∏∫ÂΩìÂ§©ÁªìÊùüÊó∂Èó¥Ôºà23:59:59Ôºâ
                    endDate.setHours(23, 59, 59, 999);
                    return recordDate <= endDate;
                });
            }
            
            if (currentFilter.projects.length > 0) {
                filtered = filtered.filter(record => currentFilter.projects.includes(record.projectId));
            }
            
            return filtered;
        }

        // Êõ¥Êñ∞ÊêúÁ¥¢ÁªìÊûú‰ø°ÊÅØ
        function updateSearchResultsInfo(count) {
            let infoText = `ÊòæÁ§∫ <span class="record-count">${count}</span> Êù°ËÆ∞ÂΩï`;
            
            if (currentFilter.startDate || currentFilter.endDate || currentFilter.projects.length > 0) {
                infoText += "ÔºàÂ∑≤Â∫îÁî®Á≠õÈÄâÊù°‰ª∂Ôºâ";
            } else {
                infoText += "ÔºàÂÖ®ÈÉ®ËÆ∞ÂΩïÔºâ";
            }
            
            searchResultsInfo.innerHTML = infoText;
        }

        // Âà†Èô§ËÆ∞ÂΩï
        function deleteRecord(recordId) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ËÆ∞ÂΩïÂêóÔºü')) {
                records = records.filter(record => record.id !== recordId);
                saveData();
                updateRecordsTable();
                updateTotalAmount();
                
                if (currentMobileTab === 'analysis') {
                    updateAnalysisCharts();
                }
                
                showNotification('ËÆ∞ÂΩïÂ∑≤Âà†Èô§ÔºÅ', 'success');
            }
        }

        // ÊâπÈáèÂà†Èô§ÈÄâ‰∏≠ËÆ∞ÂΩï
        function batchDeleteSelected() {
            const selectedRecords = [];
            document.querySelectorAll('tr.selected').forEach(row => {
                const deleteBtn = row.querySelector('.delete-record');
                if (deleteBtn) {
                    selectedRecords.push(parseInt(deleteBtn.dataset.id));
                }
            });
            
            if (selectedRecords.length === 0) {
                showNotification('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑËÆ∞ÂΩï', 'danger');
                return;
            }
            
            if (confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${selectedRecords.length} Êù°ËÆ∞ÂΩïÂêóÔºü`)) {
                records = records.filter(record => !selectedRecords.includes(record.id));
                saveData();
                updateRecordsTable();
                updateTotalAmount();
                updateAnalysisCharts();
                showNotification(`Â∑≤Âà†Èô§ ${selectedRecords.length} Êù°ËÆ∞ÂΩï`, 'success');
            }
        }

        // Êõ¥Êñ∞ÊÄªÈáëÈ¢ù
        function updateTotalAmount() {
            const total = records.reduce((sum, record) => sum + record.amount, 0);
            totalAmountElement.textContent = `¬•${total.toFixed(2)}`;
            
            if (total >= 0) {
                totalAmountElement.style.color = '#2E8B57';
            } else {
                totalAmountElement.style.color = '#FF6B6B';
            }
        }

        // ÈáçÁΩÆË°®Âçï
        function resetForm() {
            accountForm.reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            document.getElementById('type').value = 'expense';
            updateProjectSelect();
            document.getElementById('project').value = 4;
            
            document.getElementById('date').focus();
        }

        // ÊâìÂºÄÈ°πÁõÆÊ®°ÊÄÅÊ°Ü
        function openProjectModal() {
            editingProjectId = null;
            document.getElementById('projectName').value = '';
            document.getElementById('projectType').value = 'expense';
            projectModal.style.display = 'flex';
            
            setTimeout(() => {
                document.getElementById('projectName').focus();
            }, 100);
        }

        // ÂÖ≥Èó≠È°πÁõÆÊ®°ÊÄÅÊ°Ü
        function closeProjectModal() {
            projectModal.style.display = 'none';
        }

        // ÁºñËæëÈ°πÁõÆ
        function editProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (project) {
                editingProjectId = projectId;
                document.getElementById('projectName').value = project.name;
                document.getElementById('projectType').value = project.type;
                projectModal.style.display = 'flex';
                
                setTimeout(() => {
                    document.getElementById('projectName').focus();
                }, 100);
            }
        }

        // ‰øùÂ≠òÈ°πÁõÆ
        function saveProject(e) {
            e.preventDefault();
            
            const name = document.getElementById('projectName').value.trim();
            const type = document.getElementById('projectType').value;
            
            if (!name) {
                showNotification('ËØ∑ËæìÂÖ•È°πÁõÆÂêçÁß∞', 'danger');
                return;
            }
            
            const existingProject = projects.find(p => 
                p.name.toLowerCase() === name.toLowerCase() && 
                p.id !== editingProjectId
            );
            
            if (existingProject) {
                showNotification('È°πÁõÆÂêçÁß∞Â∑≤Â≠òÂú®', 'danger');
                return;
            }
            
            if (editingProjectId) {
                const projectIndex = projects.findIndex(p => p.id === editingProjectId);
                if (projectIndex !== -1) {
                    projects[projectIndex].name = name;
                    projects[projectIndex].type = type;
                }
                showNotification('È°πÁõÆÂ∑≤Êõ¥Êñ∞ÔºÅ', 'success');
            } else {
                const newId = projects.length > 0 ? Math.max(...projects.map(p => p.id)) + 1 : 1;
                projects.push({
                    id: newId,
                    name,
                    type,
                    emoji: type === 'income' ? 'üí∞' : 'üí∏'
                });
                showNotification('È°πÁõÆÂ∑≤Ê∑ªÂä†ÔºÅ', 'success');
            }
            
            saveData();
            updateProjectSelect();
            updateProjectList();
            updateMultiselectOptions();
            updateAnalysisProjectSelects();
            closeProjectModal();
        }

        // Âà†Èô§È°πÁõÆ
        function deleteProject(projectId) {
            const recordsUsingProject = records.filter(record => record.projectId === projectId);
            
            if (recordsUsingProject.length > 0) {
                showNotification('Êó†Ê≥ïÂà†Èô§ËØ•È°πÁõÆÔºåÂõ†‰∏∫ÊúâËÆ∞ÂΩïÊ≠£Âú®‰ΩøÁî®ÂÆÉ„ÄÇËØ∑ÂÖàÂà†Èô§Áõ∏ÂÖ≥ËÆ∞ÂΩï„ÄÇ', 'danger');
                return;
            }
            
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™È°πÁõÆÂêóÔºü')) {
                projects = projects.filter(project => project.id !== projectId);
                saveData();
                updateProjectSelect();
                updateProjectList();
                updateMultiselectOptions();
                updateAnalysisProjectSelects();
                showNotification('È°πÁõÆÂ∑≤Âà†Èô§ÔºÅ', 'success');
            }
        }

        // Â∫îÁî®Á≠õÈÄâÊù°‰ª∂
        function applyFilter() {
            currentFilter.startDate = startDateInput.value;
            currentFilter.endDate = endDateInput.value;
            
            currentPage = 1;
            
            updateRecordsTable();
        }

        // ÈáçÁΩÆÁ≠õÈÄâÊù°‰ª∂
        function resetFilter() {
            startDateInput.value = '';
            endDateInput.value = '';
            currentFilter = {
                startDate: null,
                endDate: null,
                projects: []
            };
            
            currentPage = 1;
            
            updateMultiselectOptions();
            updateRecordsTable();
        }

        // ÂØºÂá∫Êï∞ÊçÆ
        function exportDataAs(format) {
            if (records.length === 0) {
                showNotification('Ê≤°ÊúâÊï∞ÊçÆÂèØÂØºÂá∫', 'danger');
                return;
            }
            
            let dataToExport = applyFilterToRecords(records);
            
            if (format === 'xlsx') {
                const exportData = [
                    ['Êó•Êúü', 'Á±ªÂûã', 'È°πÁõÆ', 'ÈáëÈ¢ù', 'Â§áÊ≥®']
                ];
                
                dataToExport.forEach(record => {
                    exportData.push([
                        record.date,
                        record.type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫',
                        record.projectName,
                        record.amount.toFixed(2),
                        record.note || ''
                    ]);
                });
                
                const ws = XLSX.utils.aoa_to_sheet(exportData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Ë¥¶Êú¨ËÆ∞ÂΩï");
                
                const today = new Date().toISOString().split('T')[0];
                XLSX.writeFile(wb, `Ë¥¶Êú¨ËÆ∞ÂΩï_${today}.xlsx`);
            } else if (format === 'json') {
                const exportData = {
                    projects,
                    records: dataToExport,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `Ë¥¶Êú¨ËÆ∞ÂΩï_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            } else if (format === 'csv') {
                let csvContent = "Êó•Êúü,Á±ªÂûã,È°πÁõÆ,ÈáëÈ¢ù,Â§áÊ≥®\n";
                dataToExport.forEach(record => {
                    csvContent += `${record.date},${record.type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫'},${record.projectName},${record.amount.toFixed(2)},"${record.note || ''}"\n`;
                });
                
                const dataBlob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `Ë¥¶Êú¨ËÆ∞ÂΩï_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }
            
            showNotification(`Êï∞ÊçÆÂ∑≤ÂØºÂá∫‰∏∫${format.toUpperCase()}Ê†ºÂºè`, 'success');
        }

        // Ê∏ÖÁ©∫ËÆ∞ÂΩï
        function clearRecords() {
            if (records.length === 0) {
                showNotification('Ê≤°ÊúâËÆ∞ÂΩïÂèØÊ∏ÖÁ©∫', 'danger');
                return;
            }
            
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâËÆ∞ÂΩïÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ')) {
                records = [];
                saveData();
                updateRecordsTable();
                updateTotalAmount();
                
                if (currentMobileTab === 'analysis') {
                    updateAnalysisCharts();
                }
                
                showNotification('ÊâÄÊúâËÆ∞ÂΩïÂ∑≤Ê∏ÖÁ©∫ÔºÅ', 'success');
            }
        }

        // ÊòæÁ§∫ÁªüËÆ°‰ø°ÊÅØ
        function showStatistics() {
            const stats = {
                totalRecords: records.length,
                totalIncome: records.filter(r => r.type === 'income').reduce((sum, r) => sum + r.amount, 0),
                totalExpense: Math.abs(records.filter(r => r.type === 'expense').reduce((sum, r) => sum + r.amount, 0)),
                incomeRecords: records.filter(r => r.type === 'income').length,
                expenseRecords: records.filter(r => r.type === 'expense').length,
                firstRecord: records.length > 0 ? new Date(Math.min(...records.map(r => new Date(r.date).getTime()))).toISOString().split('T')[0] : 'Êó†',
                lastRecord: records.length > 0 ? new Date(Math.max(...records.map(r => new Date(r.date).getTime()))).toISOString().split('T')[0] : 'Êó†'
            };
            
            const netIncome = stats.totalIncome - stats.totalExpense;
            
            statisticsGrid.innerHTML = `
                <div class="stat-item">
                    <div class="stat-label">ÊÄªËÆ∞ÂΩïÊï∞</div>
                    <div class="stat-value">${stats.totalRecords} Êù°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Êî∂ÂÖ•ËÆ∞ÂΩï</div>
                    <div class="stat-value">${stats.incomeRecords} Êù°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ÊîØÂá∫ËÆ∞ÂΩï</div>
                    <div class="stat-value">${stats.expenseRecords} Êù°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ÊÄªÊî∂ÂÖ•</div>
                    <div class="stat-value income">¬•${stats.totalIncome.toFixed(2)}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ÊÄªÊîØÂá∫</div>
                    <div class="stat-value expense">¬•${stats.totalExpense.toFixed(2)}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ÂáÄÊî∂ÂÖ•</div>
                    <div class="stat-value ${netIncome >= 0 ? 'income' : 'expense'}">
                        ¬•${netIncome.toFixed(2)}
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ÊúÄÊó©ËÆ∞ÂΩï</div>
                    <div class="stat-value">${stats.firstRecord}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ÊúÄËøëËÆ∞ÂΩï</div>
                    <div class="stat-value">${stats.lastRecord}</div>
                </div>
            `;
            
            statisticsModal.style.display = 'flex';
        }

        // ÂàÜÈ°µÁõ∏ÂÖ≥ÂáΩÊï∞
        function changePageSize() {
            pageSize = parseInt(pageSizeSelect.value);
            currentPage = 1;
            updateRecordsTable();
        }
        
        function changePage(page) {
            currentPage = page;
            updateRecordsTable();
        }
        
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                updateRecordsTable();
            }
        }
        
        function goToNextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                updateRecordsTable();
            }
        }
        
        function goToLastPage() {
            currentPage = totalPages;
            updateRecordsTable();
        }
        
        function updatePaginationInfo() {
            const filteredRecords = applyFilterToRecords(records);
            const totalRecords = filteredRecords.length;
            
            paginationInfo.innerHTML = `Á¨¨ ${currentPage} È°µÔºåÂÖ± ${totalPages} È°µÔºåÊØèÈ°µ ${pageSize} Êù°ËÆ∞ÂΩï`;
            currentPageIndicator.textContent = currentPage;
            
            firstPageBtn.disabled = currentPage === 1;
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
            lastPageBtn.disabled = currentPage === totalPages || totalPages === 0;
        }

        // Á™óÂè£Â§ßÂ∞èÂèòÂåñÊó∂ÈáçÊñ∞ÂàùÂßãÂåñÁßªÂä®Á´ØËßÜÂõæ
        window.addEventListener('resize', initMobileView);
        
        // PWAÂÆâË£ÖÊèêÁ§∫ÔºàÂèØÈÄâÔºâ
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });
    </script>
</body>
</html>